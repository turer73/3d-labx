---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Header from "../../../components/Header.astro";
import { getApiBase, getLanguage, type Language } from "../../../lib/api";

export const prerender = false;

const lang = getLanguage(Astro.request);
const API_BASE = getApiBase(Astro.request);

// Ã‡eviriler
const translations: Record<Language, {
  pageTitle: string;
  pageDesc: string;
  breadcrumbCommunity: string;
  breadcrumbFails: string;
  title: string;
  subtitle: string;
  shareFail: string;
  motivationTitle: string;
  motivationDesc: string;
  sortLabel: string;
  sortLatest: string;
  sortPopular: string;
  typeLabel: string;
  typeAll: string;
  typeSpaghetti: string;
  typeLayerShift: string;
  typeWarping: string;
  typeStringing: string;
  typeAdhesion: string;
  typeClog: string;
  typeOther: string;
  failCount: string;
  solved: string;
  viewDetails: string;
  meTooBadge: string;
  comments: string;
  noFails: string;
  noFailsDesc: string;
  prev: string;
  next: string;
}> = {
  tr: {
    pageTitle: "BaÅŸarÄ±sÄ±zlÄ±k Galerisi - 3D BaskÄ± HatalarÄ± - 3D-labX",
    pageDesc: "3D baskÄ± baÅŸarÄ±sÄ±zlÄ±klarÄ±nÄ± paylaÅŸ, Ã§Ã¶zÃ¼m Ã¶nerilerini keÅŸfet. Hatalardan Ã¶ÄŸren, topluluktan destek al.",
    breadcrumbCommunity: "Topluluk",
    breadcrumbFails: "BaÅŸarÄ±sÄ±zlÄ±k Galerisi",
    title: "ğŸ”¥ BaÅŸarÄ±sÄ±zlÄ±k Galerisi",
    subtitle: "Hatalardan Ã¶ÄŸrenmek, en bÃ¼yÃ¼k ustalÄ±ktÄ±r!",
    shareFail: "BaÅŸarÄ±sÄ±zlÄ±k PaylaÅŸ",
    motivationTitle: "Hata yapmak utanÄ±lacak bir ÅŸey deÄŸil!",
    motivationDesc: "Her usta bir zamanlar Ã§Ä±raktÄ±. BaÅŸarÄ±sÄ±zlÄ±klarÄ±nÄ± paylaÅŸarak hem kendin Ã¶ÄŸren, hem baÅŸkalarÄ±na yardÄ±mcÄ± ol.",
    sortLabel: "SÄ±rala:",
    sortLatest: "En Yeni",
    sortPopular: "PopÃ¼ler",
    typeLabel: "Hata Tipi:",
    typeAll: "TÃ¼mÃ¼",
    typeSpaghetti: "Spagetti",
    typeLayerShift: "Katman KaymasÄ±",
    typeWarping: "Warping",
    typeStringing: "Stringing",
    typeAdhesion: "YapÄ±ÅŸma",
    typeClog: "TÄ±kanma",
    typeOther: "DiÄŸer",
    failCount: "baÅŸarÄ±sÄ±zlÄ±k",
    solved: "Ã‡Ã¶zÃ¼ldÃ¼",
    viewDetails: "DetaylarÄ± GÃ¶r",
    meTooBadge: "Bu bana da oldu",
    comments: "Yorum",
    noFails: "HenÃ¼z baÅŸarÄ±sÄ±zlÄ±k paylaÅŸÄ±lmamÄ±ÅŸ",
    noFailsDesc: "Ä°lk cesur paylaÅŸÄ±mcÄ± sen ol!",
    prev: "Ã–nceki",
    next: "Sonraki"
  },
  en: {
    pageTitle: "Fail Gallery - 3D Printing Fails - 3D-labX",
    pageDesc: "Share your 3D printing fails, discover solutions. Learn from mistakes, get support from the community.",
    breadcrumbCommunity: "Community",
    breadcrumbFails: "Fail Gallery",
    title: "ğŸ”¥ Fail Gallery",
    subtitle: "Learning from mistakes is the greatest mastery!",
    shareFail: "Share Fail",
    motivationTitle: "Making mistakes is nothing to be ashamed of!",
    motivationDesc: "Every master was once a beginner. Share your fails to learn and help others.",
    sortLabel: "Sort:",
    sortLatest: "Latest",
    sortPopular: "Popular",
    typeLabel: "Fail Type:",
    typeAll: "All",
    typeSpaghetti: "Spaghetti",
    typeLayerShift: "Layer Shift",
    typeWarping: "Warping",
    typeStringing: "Stringing",
    typeAdhesion: "Adhesion",
    typeClog: "Clog",
    typeOther: "Other",
    failCount: "fails",
    solved: "Solved",
    viewDetails: "View Details",
    meTooBadge: "Me too",
    comments: "Comments",
    noFails: "No fails shared yet",
    noFailsDesc: "Be the first brave one to share!",
    prev: "Previous",
    next: "Next"
  },
  de: {
    pageTitle: "Fehlergalerie - 3D-Druckfehler - 3D-labX",
    pageDesc: "Teilen Sie Ihre 3D-Druckfehler, entdecken Sie LÃ¶sungen. Lernen Sie aus Fehlern, erhalten Sie UnterstÃ¼tzung von der Community.",
    breadcrumbCommunity: "Community",
    breadcrumbFails: "Fehlergalerie",
    title: "ğŸ”¥ Fehlergalerie",
    subtitle: "Aus Fehlern zu lernen ist die grÃ¶ÃŸte Meisterschaft!",
    shareFail: "Fehler teilen",
    motivationTitle: "Fehler zu machen ist nichts BeschÃ¤mendes!",
    motivationDesc: "Jeder Meister war einmal ein AnfÃ¤nger. Teilen Sie Ihre Fehler, um zu lernen und anderen zu helfen.",
    sortLabel: "Sortieren:",
    sortLatest: "Neueste",
    sortPopular: "Beliebt",
    typeLabel: "Fehlertyp:",
    typeAll: "Alle",
    typeSpaghetti: "Spaghetti",
    typeLayerShift: "Schichtversatz",
    typeWarping: "Warping",
    typeStringing: "Stringing",
    typeAdhesion: "Haftung",
    typeClog: "Verstopfung",
    typeOther: "Andere",
    failCount: "Fehler",
    solved: "GelÃ¶st",
    viewDetails: "Details ansehen",
    meTooBadge: "Mir auch",
    comments: "Kommentare",
    noFails: "Noch keine Fehler geteilt",
    noFailsDesc: "Sei der Erste, der mutig teilt!",
    prev: "ZurÃ¼ck",
    next: "Weiter"
  }
};

const t = translations[lang];

// Fail type labels based on language
const failTypeLabels: Record<Language, Record<string, string>> = {
  tr: {
    'spaghetti': 'Spagetti',
    'layer_shift': 'Katman KaymasÄ±',
    'warping': 'Warping',
    'stringing': 'Stringing',
    'adhesion': 'YapÄ±ÅŸma Sorunu',
    'clog': 'TÄ±kanma',
    'other': 'DiÄŸer'
  },
  en: {
    'spaghetti': 'Spaghetti',
    'layer_shift': 'Layer Shift',
    'warping': 'Warping',
    'stringing': 'Stringing',
    'adhesion': 'Adhesion Issue',
    'clog': 'Clog',
    'other': 'Other'
  },
  de: {
    'spaghetti': 'Spaghetti',
    'layer_shift': 'Schichtversatz',
    'warping': 'Warping',
    'stringing': 'Stringing',
    'adhesion': 'Haftungsproblem',
    'clog': 'Verstopfung',
    'other': 'Andere'
  }
};

const url = new URL(Astro.request.url);
const currentPage = Math.max(1, parseInt(url.searchParams.get("page") || "1", 10));
const sort = url.searchParams.get("sort") || "latest";
const failType = url.searchParams.get("type") || "";

let fails: any[] = [];
let pagination: any = null;
let failTypes: any[] = [];

// BaÅŸarÄ±sÄ±zlÄ±k tÃ¼rleri
try {
  const typesRes = await fetch(`${API_BASE}/api/fails/types`);
  if (typesRes.ok) {
    const data = await typesRes.json();
    failTypes = data.types || [];
  }
} catch (e) {
  console.error("Fail types yÃ¼klenemedi:", e);
}

// BaÅŸarÄ±sÄ±zlÄ±klarÄ± Ã§ek
try {
  const sortParam = sort === "popular" ? "popular" : "latest";
  let apiUrl = `${API_BASE}/api/fails?page=${currentPage}&limit=12&sort=${sortParam}`;
  if (failType) apiUrl += `&type=${failType}`;

  const res = await fetch(apiUrl);
  if (res.ok) {
    const data = await res.json();
    fails = data.fails || [];
    pagination = data.pagination;
  }
} catch (e) {
  console.error("BaÅŸarÄ±sÄ±zlÄ±klar yÃ¼klenemedi:", e);
}

// Ä°lk gÃ¶rseli al
function getFirstImage(images: string): string | null {
  try {
    const arr = JSON.parse(images || '[]');
    return arr[0] || null;
  } catch {
    return null;
  }
}

// AÃ§Ä±klama kÄ±salt
function truncate(text: string, length: number = 100): string {
  if (!text) return '';
  return text.length > length ? text.substring(0, length) + '...' : text;
}

// Fail type emoji
function getFailEmoji(type: string): string {
  const emojis: Record<string, string> = {
    'spaghetti': 'ğŸ',
    'layer_shift': 'ğŸ“Š',
    'warping': 'ğŸŒŠ',
    'stringing': 'ğŸ•¸ï¸',
    'adhesion': 'ğŸ’¨',
    'clog': 'ğŸ”§',
    'other': 'â“'
  };
  return emojis[type] || 'ğŸ”¥';
}

// Fail type label
function getFailLabel(type: string): string {
  return failTypeLabels[lang][type] || type;
}
---

<BaseLayout
  title={t.pageTitle}
  description={t.pageDesc}
>
  <Header />

  <main class="fails-page">
    <div class="container">
      <div class="page-header">
        <div class="header-left">
          <nav class="breadcrumb">
            <a href="/topluluk">{t.breadcrumbCommunity}</a>
            <span>/</span>
            <span>{t.breadcrumbFails}</span>
          </nav>
          <h1>{t.title}</h1>
          <p>{t.subtitle}</p>
        </div>
        <div class="header-right">
          <a href="/topluluk/basarisizliklar/paylas" class="btn btn-primary" id="newFailBtn">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
            {t.shareFail}
          </a>
        </div>
      </div>

      <!-- Motivasyon Kutusu -->
      <div class="motivation-box">
        <div class="motivation-icon">ğŸ’ª</div>
        <div class="motivation-content">
          <h3>{t.motivationTitle}</h3>
          <p>{t.motivationDesc}</p>
        </div>
      </div>

      <!-- Filtreler -->
      <div class="filters-bar">
        <div class="filter-group">
          <span class="filter-label">{t.sortLabel}</span>
          <div class="filter-options">
            <a href={`?sort=latest${failType ? `&type=${failType}` : ''}`} class={sort === "latest" ? "active" : ""}>{t.sortLatest}</a>
            <a href={`?sort=popular${failType ? `&type=${failType}` : ''}`} class={sort === "popular" ? "active" : ""}>{t.sortPopular}</a>
          </div>
        </div>

        <div class="filter-group">
          <span class="filter-label">{t.typeLabel}</span>
          <div class="filter-options">
            <a href={`?sort=${sort}`} class={!failType ? "active" : ""}>{t.typeAll}</a>
            <a href={`?sort=${sort}&type=spaghetti`} class={failType === "spaghetti" ? "active" : ""}>ğŸ {t.typeSpaghetti}</a>
            <a href={`?sort=${sort}&type=layer_shift`} class={failType === "layer_shift" ? "active" : ""}>ğŸ“Š {t.typeLayerShift}</a>
            <a href={`?sort=${sort}&type=warping`} class={failType === "warping" ? "active" : ""}>ğŸŒŠ {t.typeWarping}</a>
            <a href={`?sort=${sort}&type=stringing`} class={failType === "stringing" ? "active" : ""}>ğŸ•¸ï¸ {t.typeStringing}</a>
            <a href={`?sort=${sort}&type=adhesion`} class={failType === "adhesion" ? "active" : ""}>ğŸ’¨ {t.typeAdhesion}</a>
            <a href={`?sort=${sort}&type=clog`} class={failType === "clog" ? "active" : ""}>ğŸ”§ {t.typeClog}</a>
          </div>
        </div>

        {pagination && <span class="total-count">{pagination.total} {t.failCount}</span>}
      </div>

      <!-- BaÅŸarÄ±sÄ±zlÄ±klar Grid -->
      <div class="fails-grid">
        {fails.length > 0 ? fails.map((fail) => {
          const firstImage = getFirstImage(fail.images);
          return (
            <a href={`/topluluk/basarisizliklar/${fail.slug}`} class={`fail-card ${fail.is_solved ? 'solved' : ''}`}>
              <div class="fail-image">
                {firstImage ? (
                  <img src={firstImage} alt={fail.title} loading="lazy" />
                ) : (
                  <div class="no-image gradient-bg">
                    <span class="fail-emoji">{getFailEmoji(fail.fail_type)}</span>
                  </div>
                )}
                <span class="type-badge">{getFailEmoji(fail.fail_type)} {getFailLabel(fail.fail_type)}</span>
                {fail.is_solved === 1 && <span class="solved-badge">âœ… {t.solved}</span>}
                <div class="image-overlay">
                  <span class="view-btn">{t.viewDetails}</span>
                </div>
              </div>
              <div class="fail-info">
                <h3>{fail.title}</h3>
                {fail.description && <p class="fail-excerpt">{truncate(fail.description, 80)}</p>}

                <div class="fail-tags">
                  {fail.printer_model && <span class="tag printer">{fail.printer_model}</span>}
                  {fail.filament_type && <span class="tag filament">{fail.filament_type}</span>}
                </div>

                <div class="fail-meta">
                  <div class="author">
                    {fail.avatar_url ? (
                      <img src={fail.avatar_url} alt={fail.username} class="author-avatar" />
                    ) : (
                      <div class="avatar-placeholder">{fail.username?.charAt(0).toUpperCase()}</div>
                    )}
                    <span>@{fail.username}</span>
                  </div>
                  <div class="stats">
                    <span title={t.meTooBadge}>ğŸ™‹ {fail.helpful_count || 0}</span>
                    <span title={t.comments}>ğŸ’¬ {fail.comment_count || 0}</span>
                  </div>
                </div>
              </div>
            </a>
          );
        }) : (
          <div class="empty-state">
            <div class="empty-icon">ğŸ”¥</div>
            <h3>{t.noFails}</h3>
            <p>{t.noFailsDesc}</p>
            <a href="/topluluk/basarisizliklar/paylas" class="btn btn-primary">{t.shareFail}</a>
          </div>
        )}
      </div>

      <!-- Sayfalama -->
      {pagination && pagination.totalPages > 1 && (
        <nav class="pagination">
          <a href={`?page=${currentPage - 1}&sort=${sort}${failType ? `&type=${failType}` : ''}`} class={`page-btn ${!pagination.hasPrev ? 'disabled' : ''}`}>
            â† {t.prev}
          </a>
          <span class="page-info">{pagination.page} / {pagination.totalPages}</span>
          <a href={`?page=${currentPage + 1}&sort=${sort}${failType ? `&type=${failType}` : ''}`} class={`page-btn ${!pagination.hasNext ? 'disabled' : ''}`}>
            {t.next} â†’
          </a>
        </nav>
      )}
    </div>
  </main>
</BaseLayout>

<style>
  .fails-page {
    padding-top: 140px;
    padding-bottom: 64px;
    min-height: 100vh;
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
    gap: 20px;
    flex-wrap: wrap;
  }

  .breadcrumb {
    display: flex;
    gap: 8px;
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 8px;
  }

  .breadcrumb a { color: #F97316; text-decoration: none; }

  .page-header h1 { margin: 0 0 8px; font-size: 1.8rem; }
  .page-header p { margin: 0; color: var(--text-muted); }

  .btn-primary {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    background: linear-gradient(135deg, #F97316 0%, #EA580C 100%);
    color: white;
    border-radius: 12px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(249, 115, 22, 0.4);
  }

  /* Motivasyon Kutusu */
  .motivation-box {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 20px 24px;
    background: linear-gradient(135deg, rgba(249, 115, 22, 0.1), rgba(234, 88, 12, 0.05));
    border: 1px solid rgba(249, 115, 22, 0.2);
    border-radius: 16px;
    margin-bottom: 24px;
  }

  .motivation-icon {
    font-size: 2.5rem;
    flex-shrink: 0;
  }

  .motivation-content h3 {
    margin: 0 0 4px;
    font-size: 1rem;
    color: #F97316;
  }

  .motivation-content p {
    margin: 0;
    font-size: 0.9rem;
    color: var(--text-muted);
  }

  .filters-bar {
    display: flex;
    align-items: center;
    gap: 24px;
    padding: 16px 20px;
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 16px;
    margin-bottom: 24px;
    flex-wrap: wrap;
  }

  .filter-group {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .filter-label {
    font-size: 0.85rem;
    color: var(--text-muted);
    font-weight: 500;
  }

  .filter-options {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }

  .filter-options a {
    padding: 6px 12px;
    font-size: 0.85rem;
    color: var(--text-muted);
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.2s ease;
    border: 1px solid transparent;
  }

  .filter-options a:hover {
    background: var(--bg-main);
    color: var(--text-main);
  }

  .filter-options a.active {
    background: #F97316;
    color: white;
  }

  .total-count {
    margin-left: auto;
    font-size: 0.85rem;
    color: var(--text-muted);
    padding: 6px 12px;
    background: var(--bg-main);
    border-radius: 8px;
  }

  .fails-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 24px;
  }

  .fail-card {
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 20px;
    overflow: hidden;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .fail-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
    border-color: #F97316;
  }

  .fail-card.solved {
    border-color: rgba(16, 185, 129, 0.5);
  }

  .fail-image {
    aspect-ratio: 4/3;
    position: relative;
    overflow: hidden;
    background: var(--bg-main);
  }

  .fail-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease;
  }

  .fail-card:hover .fail-image img { transform: scale(1.08); }

  .no-image {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-light);
  }

  .no-image.gradient-bg {
    background: linear-gradient(135deg, #7c2d12 0%, #9a3412 50%, #c2410c 100%);
    position: relative;
  }

  .no-image.gradient-bg::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
      radial-gradient(circle at 20% 30%, rgba(249, 115, 22, 0.3) 0%, transparent 50%),
      radial-gradient(circle at 80% 70%, rgba(251, 146, 60, 0.2) 0%, transparent 50%);
  }

  .fail-emoji {
    font-size: 4rem;
    z-index: 1;
  }

  .type-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    padding: 6px 12px;
    background: rgba(0, 0, 0, 0.8);
    color: #FB923C;
    font-size: 0.75rem;
    font-weight: 600;
    border-radius: 8px;
    backdrop-filter: blur(4px);
  }

  .solved-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 6px 12px;
    background: rgba(16, 185, 129, 0.9);
    color: white;
    font-size: 0.75rem;
    font-weight: 600;
    border-radius: 8px;
  }

  .image-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .fail-card:hover .image-overlay { opacity: 1; }

  .view-btn {
    padding: 12px 24px;
    background: white;
    color: #1a1a1a;
    font-weight: 600;
    font-size: 0.9rem;
    border-radius: 12px;
  }

  .fail-info { padding: 20px; }

  .fail-info h3 {
    margin: 0 0 8px;
    font-size: 1.1rem;
    color: var(--text-main);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .fail-excerpt {
    font-size: 0.85rem;
    color: var(--text-muted);
    line-height: 1.5;
    margin: 0 0 12px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .fail-tags {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 16px;
  }

  .tag {
    padding: 4px 10px;
    background: var(--bg-main);
    border: 1px solid var(--border-soft);
    border-radius: 6px;
    font-size: 0.75rem;
    color: var(--text-muted);
  }

  .tag.filament {
    background: rgba(249, 115, 22, 0.1);
    border-color: rgba(249, 115, 22, 0.3);
    color: #F97316;
  }

  .tag.printer {
    background: rgba(59, 130, 246, 0.1);
    border-color: rgba(59, 130, 246, 0.3);
    color: #3B82F6;
  }

  .fail-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .author {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    color: var(--text-muted);
  }

  .author-avatar, .avatar-placeholder {
    width: 28px;
    height: 28px;
    border-radius: 8px;
    object-fit: cover;
  }

  .avatar-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #F97316, #EA580C);
    color: white;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .stats {
    display: flex;
    gap: 12px;
    font-size: 0.85rem;
    color: var(--text-muted);
  }

  .empty-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 80px 20px;
    background: var(--bg-card);
    border: 2px dashed var(--border-soft);
    border-radius: 20px;
  }

  .empty-icon { font-size: 4rem; margin-bottom: 20px; }
  .empty-state h3 { margin: 0 0 8px; font-size: 1.3rem; }
  .empty-state p { color: var(--text-muted); margin-bottom: 24px; }

  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 16px;
    margin-top: 40px;
  }

  .page-btn {
    padding: 12px 24px;
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 12px;
    color: var(--text-main);
    text-decoration: none;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  .page-btn:hover:not(.disabled) { border-color: #F97316; color: #F97316; }
  .page-btn.disabled { opacity: 0.5; pointer-events: none; }
  .page-info { color: var(--text-muted); font-size: 0.9rem; }

  @media (max-width: 768px) {
    .fails-page { padding-top: 120px; }
    .page-header { flex-direction: column; }
    .motivation-box { flex-direction: column; text-align: center; }
    .filters-bar {
      flex-direction: column;
      align-items: flex-start;
      gap: 16px;
    }
    .filter-group { flex-wrap: wrap; }
    .total-count { margin-left: 0; }
    .fails-grid { grid-template-columns: 1fr; }
  }
</style>
