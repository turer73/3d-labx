---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Header from "../../components/Header.astro";
import { getApiBase, getLanguage, type Language } from "../../lib/api";

export const prerender = false;

const lang = getLanguage(Astro.request);
const API_BASE = getApiBase(Astro.request);

// √áeviriler
const translations: Record<Language, {
  pageTitle: string;
  pageDesc: string;
  badge: string;
  heroTitle: string;
  heroDesc: string;
  topics: string;
  messages: string;
  projects: string;
  quickAccess: string;
  askQuestion: string;
  shareProject: string;
  shareFail: string;
  makerMap: string;
  iAlsoPrinted: string;
  communityProjects: string;
  failGallery: string;
  learnFromMistakes: string;
  makerMapTitle: string;
  makersInTurkey: string;
  makersInGermany: string;
  makersNearYou: string;
  recentTopics: string;
  viewAll: string;
  noTopicsYet: string;
  openFirstTopic: string;
  featuredProjects: string;
  noProjectsYet: string;
  shareFirstProject: string;
  communityRules: string;
  rule1: string;
  rule2: string;
  rule3: string;
  rule4: string;
  storeName: string;
  storeDesc: string;
  topic: string;
  message: string;
  justNow: string;
  minutesAgo: string;
  hoursAgo: string;
  daysAgo: string;
}> = {
  tr: {
    pageTitle: "Topluluk - 3D-labX | Forum, Projeler, Tartƒ±≈ümalar",
    pageDesc: "3D baskƒ± topluluƒüuna katƒ±lƒ±n. Sorularƒ±nƒ±zƒ± sorun, projelerinizi payla≈üƒ±n, diƒüer makerlarla tanƒ±≈üƒ±n.",
    badge: "Topluluk",
    heroTitle: "3D Baskƒ± Topluluƒüu",
    heroDesc: "Sorularƒ±nƒ± sor, projelerini payla≈ü, makerlarla tanƒ±≈ü",
    topics: "Konu",
    messages: "Mesaj",
    projects: "Proje",
    quickAccess: "Hƒ±zlƒ± Eri≈üim",
    askQuestion: "Soru Sor",
    shareProject: "Proje Payla≈ü",
    shareFail: "Hata Payla≈ü",
    makerMap: "Maker Haritasƒ±",
    iAlsoPrinted: "Ben de Bastƒ±m",
    communityProjects: "Topluluk projeleri",
    failGallery: "Ba≈üarƒ±sƒ±zlƒ±k Galerisi",
    learnFromMistakes: "Hatalardan √∂ƒüren",
    makerMapTitle: "Maker Haritasƒ±",
    makersInTurkey: "T√ºrkiye'deki makerlar",
    makersInGermany: "Almanya'daki makerlar",
    makersNearYou: "Makers near you",
    recentTopics: "Son Konular",
    viewAll: "T√ºm√º ‚Üí",
    noTopicsYet: "Hen√ºz konu yok",
    openFirstTopic: "ƒ∞lk Konuyu A√ß",
    featuredProjects: "√ñne √áƒ±kan Projeler",
    noProjectsYet: "Hen√ºz proje payla≈üƒ±lmamƒ±≈ü",
    shareFirstProject: "ƒ∞lk Projeyi Payla≈ü",
    communityRules: "üìã Topluluk Kurallarƒ±",
    rule1: "Saygƒ±lƒ± ve yapƒ±cƒ± olun",
    rule2: "Spam ve reklam yapmayƒ±n",
    rule3: "Doƒüru kategori kullanƒ±n",
    rule4: "Sorularƒ±nƒ±zƒ± detaylƒ± anlatƒ±n",
    storeName: "3D-labX Maƒüaza",
    storeDesc: "3D baskƒ± √ºr√ºnlerini ke≈üfet!",
    topic: "konu",
    message: "mesaj",
    justNow: "Az √∂nce",
    minutesAgo: "dk √∂nce",
    hoursAgo: "sa √∂nce",
    daysAgo: "g √∂nce"
  },
  en: {
    pageTitle: "Community - 3D-labX | Forum, Projects, Discussions",
    pageDesc: "Join the 3D printing community. Ask questions, share your projects, meet other makers.",
    badge: "Community",
    heroTitle: "3D Printing Community",
    heroDesc: "Ask questions, share projects, meet makers",
    topics: "Topics",
    messages: "Messages",
    projects: "Projects",
    quickAccess: "Quick Access",
    askQuestion: "Ask Question",
    shareProject: "Share Project",
    shareFail: "Share Fail",
    makerMap: "Maker Map",
    iAlsoPrinted: "I Also Printed",
    communityProjects: "Community projects",
    failGallery: "Fail Gallery",
    learnFromMistakes: "Learn from mistakes",
    makerMapTitle: "Maker Map",
    makersInTurkey: "Makers in Turkey",
    makersInGermany: "Makers in Germany",
    makersNearYou: "Makers near you",
    recentTopics: "Recent Topics",
    viewAll: "View All ‚Üí",
    noTopicsYet: "No topics yet",
    openFirstTopic: "Open First Topic",
    featuredProjects: "Featured Projects",
    noProjectsYet: "No projects shared yet",
    shareFirstProject: "Share First Project",
    communityRules: "üìã Community Rules",
    rule1: "Be respectful and constructive",
    rule2: "No spam or advertising",
    rule3: "Use the correct category",
    rule4: "Describe your questions in detail",
    storeName: "3D-labX Store",
    storeDesc: "Discover 3D printing products!",
    topic: "topics",
    message: "messages",
    justNow: "Just now",
    minutesAgo: "min ago",
    hoursAgo: "hr ago",
    daysAgo: "d ago"
  },
  de: {
    pageTitle: "Community - 3D-labX | Forum, Projekte, Diskussionen",
    pageDesc: "Werden Sie Teil der 3D-Druck-Community. Stellen Sie Fragen, teilen Sie Ihre Projekte, lernen Sie andere Maker kennen.",
    badge: "Community",
    heroTitle: "3D-Druck Community",
    heroDesc: "Fragen stellen, Projekte teilen, Maker kennenlernen",
    topics: "Themen",
    messages: "Nachrichten",
    projects: "Projekte",
    quickAccess: "Schnellzugriff",
    askQuestion: "Frage stellen",
    shareProject: "Projekt teilen",
    shareFail: "Fehler teilen",
    makerMap: "Maker-Karte",
    iAlsoPrinted: "Ich habe auch gedruckt",
    communityProjects: "Community-Projekte",
    failGallery: "Fehlergalerie",
    learnFromMistakes: "Aus Fehlern lernen",
    makerMapTitle: "Maker-Karte",
    makersInTurkey: "Maker in der T√ºrkei",
    makersInGermany: "Maker in Deutschland",
    makersNearYou: "Maker in deiner N√§he",
    recentTopics: "Neueste Themen",
    viewAll: "Alle ansehen ‚Üí",
    noTopicsYet: "Noch keine Themen",
    openFirstTopic: "Erstes Thema er√∂ffnen",
    featuredProjects: "Ausgew√§hlte Projekte",
    noProjectsYet: "Noch keine Projekte geteilt",
    shareFirstProject: "Erstes Projekt teilen",
    communityRules: "üìã Community-Regeln",
    rule1: "Seien Sie respektvoll und konstruktiv",
    rule2: "Kein Spam oder Werbung",
    rule3: "Verwenden Sie die richtige Kategorie",
    rule4: "Beschreiben Sie Ihre Fragen detailliert",
    storeName: "3D-labX Shop",
    storeDesc: "Entdecken Sie 3D-Druck-Produkte!",
    topic: "Themen",
    message: "Nachrichten",
    justNow: "Gerade eben",
    minutesAgo: "Min. her",
    hoursAgo: "Std. her",
    daysAgo: "T. her"
  }
};

const t = translations[lang];

// Maker haritasƒ± a√ßƒ±klamasƒ± dile g√∂re
const makerMapDesc = lang === 'tr' ? t.makersInTurkey : lang === 'de' ? t.makersInGermany : t.makersNearYou;

// Kategori isimlerini dile g√∂re getir
function getCatName(cat: any) {
  if (lang === 'en' && cat.name_en) return cat.name_en;
  if (lang === 'de' && cat.name_de) return cat.name_de;
  return cat.name;
}
function getCatDesc(cat: any) {
  if (lang === 'en' && cat.description_en) return cat.description_en;
  if (lang === 'de' && cat.description_de) return cat.description_de;
  return cat.description;
}

// Forum kategorilerini, son konularƒ± ve projeleri √ßek
let categories: any[] = [];
let recentThreads: any[] = [];
let featuredProjects: any[] = [];
let error: string | null = null;

try {
  const [catRes, threadsRes, projectsRes] = await Promise.all([
    fetch(`${API_BASE}/api/forum/categories`),
    fetch(`${API_BASE}/api/forum/categories/sorular/threads?limit=5`),
    fetch(`${API_BASE}/api/projects?limit=6&sort=popular`)
  ]);

  if (catRes.ok) {
    const catData = await catRes.json();
    categories = catData.categories || [];
  }

  if (threadsRes.ok) {
    const threadsData = await threadsRes.json();
    recentThreads = threadsData.threads || [];
  }

  if (projectsRes.ok) {
    const projectsData = await projectsRes.json();
    featuredProjects = projectsData.projects || [];
  }
} catch (e) {
  error = e instanceof Error ? e.message : "Bilinmeyen hata";
}

// ƒ∞statistikler
const totalThreads = categories.reduce((sum: number, c: any) => sum + (c.thread_count || 0), 0);
const totalPosts = categories.reduce((sum: number, c: any) => sum + (c.post_count || 0), 0);
const projectCount = featuredProjects.length || 0;

// Tarih formatlama (dile g√∂re)
const dateLocale = lang === 'tr' ? 'tr-TR' : lang === 'de' ? 'de-DE' : 'en-US';
function formatDate(dateStr: string) {
  const date = new Date(dateStr);
  const now = new Date();
  const diff = now.getTime() - date.getTime();
  const minutes = Math.floor(diff / 60000);
  const hours = Math.floor(diff / 3600000);
  const days = Math.floor(diff / 86400000);

  if (minutes < 1) return t.justNow;
  if (minutes < 60) return `${minutes}${t.minutesAgo}`;
  if (hours < 24) return `${hours}${t.hoursAgo}`;
  if (days < 7) return `${days}${t.daysAgo}`;
  return date.toLocaleDateString(dateLocale, { day: 'numeric', month: 'short' });
}
---

<BaseLayout
  title={t.pageTitle}
  description={t.pageDesc}
>
  <Header />

  <main class="community-page">
    <div class="container">
      <!-- Bento Grid Layout -->
      <div class="bento-grid">

        <!-- Hero Card - Large -->
        <div class="bento-card hero-card">
          <div class="hero-bg"></div>
          <div class="hero-content">
            <div class="hero-badge">
              <span class="badge-dot"></span>
              {t.badge}
            </div>
            <h1>{t.heroTitle}</h1>
            <p>{t.heroDesc}</p>
            <div class="hero-stats">
              <div class="mini-stat">
                <span class="stat-num">{totalThreads}</span>
                <span class="stat-text">{t.topics}</span>
              </div>
              <div class="mini-stat">
                <span class="stat-num">{totalPosts}</span>
                <span class="stat-text">{t.messages}</span>
              </div>
              <div class="mini-stat">
                <span class="stat-num">{projectCount}</span>
                <span class="stat-text">{t.projects}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions Card -->
        <div class="bento-card actions-card">
          <h3>{t.quickAccess}</h3>
          <div class="quick-actions">
            <a href="/topluluk/forum/yeni" class="quick-action ask">
              <span class="action-icon">‚ùì</span>
              <span class="action-text">{t.askQuestion}</span>
            </a>
            <a href="/topluluk/projeler/paylas" class="quick-action share">
              <span class="action-icon">üé®</span>
              <span class="action-text">{t.shareProject}</span>
            </a>
            <a href="/topluluk/basarisizliklar/paylas" class="quick-action fail">
              <span class="action-icon">üî•</span>
              <span class="action-text">{t.shareFail}</span>
            </a>
            <a href="/topluluk/harita" class="quick-action map">
              <span class="action-icon">üó∫Ô∏è</span>
              <span class="action-text">{t.makerMap}</span>
            </a>
          </div>
        </div>

        <!-- New Features Cards -->
        <a href="/topluluk/projeler" class="bento-card feature-card projects-feature">
          <div class="feature-icon">üé®</div>
          <div class="feature-content">
            <h3>{t.iAlsoPrinted}</h3>
            <p>{t.communityProjects}</p>
          </div>
          <div class="feature-arrow">‚Üí</div>
        </a>

        <a href="/topluluk/basarisizliklar" class="bento-card feature-card fails-feature">
          <div class="feature-icon">üî•</div>
          <div class="feature-content">
            <h3>{t.failGallery}</h3>
            <p>{t.learnFromMistakes}</p>
          </div>
          <div class="feature-arrow">‚Üí</div>
        </a>

        <a href="/topluluk/harita" class="bento-card feature-card map-feature">
          <div class="feature-icon">üó∫Ô∏è</div>
          <div class="feature-content">
            <h3>{t.makerMapTitle}</h3>
            <p>{makerMapDesc}</p>
          </div>
          <div class="feature-arrow">‚Üí</div>
        </a>

        <!-- Categories Grid -->
        {categories.map((cat, index) => (
          <a href={`/topluluk/forum/${cat.slug}`} class={`bento-card category-card cat-${index + 1}`} style={`--cat-color: ${cat.color || '#F97316'}`}>
            <div class="cat-icon">{cat.icon}</div>
            <div class="cat-content">
              <h3>{getCatName(cat)}</h3>
              <p>{getCatDesc(cat)}</p>
            </div>
            <div class="cat-footer">
              <span class="cat-stat">{cat.thread_count} {t.topic}</span>
              <span class="cat-stat">{cat.post_count} {t.message}</span>
            </div>
            <div class="cat-arrow">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
            </div>
          </a>
        ))}

        <!-- Recent Threads Card - Wide -->
        <div class="bento-card threads-card">
          <div class="card-header">
            <h3>
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
              {t.recentTopics}
            </h3>
            <a href="/topluluk/forum" class="see-all">{t.viewAll}</a>
          </div>
          <div class="threads-list">
            {recentThreads.length > 0 ? recentThreads.map((thread) => (
              <a href={`/topluluk/forum/konu/${thread.slug}`} class="thread-item">
                <div class="thread-avatar">
                  {thread.avatar_url ? (
                    <img src={thread.avatar_url} alt={thread.username} />
                  ) : (
                    <span class="avatar-letter">{thread.username?.charAt(0).toUpperCase()}</span>
                  )}
                </div>
                <div class="thread-content">
                  <h4>{thread.title}</h4>
                  <div class="thread-meta">
                    <span class="thread-author">@{thread.username}</span>
                    <span class="thread-time">{formatDate(thread.created_at)}</span>
                  </div>
                </div>
                <div class="thread-stats">
                  {thread.is_solved === 1 && <span class="solved-badge">‚úì</span>}
                  <span class="reply-count">{thread.reply_count} üí¨</span>
                </div>
              </a>
            )) : (
              <div class="empty-state">
                <p>{t.noTopicsYet}</p>
                <a href="/topluluk/forum/yeni" class="btn-small">{t.openFirstTopic}</a>
              </div>
            )}
          </div>
        </div>

        <!-- Projects Showcase Card - Wide -->
        <div class="bento-card projects-card">
          <div class="card-header">
            <h3>
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
              {t.featuredProjects}
            </h3>
            <a href="/topluluk/projeler" class="see-all">{t.viewAll}</a>
          </div>
          <div class="projects-grid">
            {featuredProjects.length > 0 ? featuredProjects.slice(0, 6).map((project, i) => (
              <a href={`/topluluk/projeler/${project.slug}`} class="project-item">
                <div class="project-thumb" style={`--hue: ${(i * 60) % 360}`}>
                  <span class="project-emoji">{project.filament_type === 'TPU' ? 'ü¶ñ' : project.filament_type === 'ABS' ? 'üé≠' : project.filament_type === 'PETG' ? '‚öôÔ∏è' : 'üé®'}</span>
                  {project.is_featured === 1 && <span class="pinned-badge">‚≠ê</span>}
                </div>
                <div class="project-info">
                  <h4>{project.title}</h4>
                  <span class="project-meta">@{project.username} ‚Ä¢ {project.like_count || 0}‚ù§Ô∏è</span>
                </div>
              </a>
            )) : (
              <div class="empty-state full">
                <p>{t.noProjectsYet}</p>
                <a href="/topluluk/projeler/paylas" class="btn-small">{t.shareFirstProject}</a>
              </div>
            )}
          </div>
        </div>

        <!-- Community Rules Card -->
        <div class="bento-card rules-card">
          <h3>{t.communityRules}</h3>
          <ul class="rules-list">
            <li>
              <span class="rule-icon">‚úì</span>
              <span>{t.rule1}</span>
            </li>
            <li>
              <span class="rule-icon">‚úì</span>
              <span>{t.rule2}</span>
            </li>
            <li>
              <span class="rule-icon">‚úì</span>
              <span>{t.rule3}</span>
            </li>
            <li>
              <span class="rule-icon">‚úì</span>
              <span>{t.rule4}</span>
            </li>
          </ul>
        </div>

        <!-- Store Promo Card -->
        <a href="https://magaza.3d-labx.com" target="_blank" class="bento-card store-card">
          <div class="store-icon">üõí</div>
          <div class="store-content">
            <h3>{t.storeName}</h3>
            <p>{t.storeDesc}</p>
          </div>
          <div class="store-arrow">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="7" y1="17" x2="17" y2="7"/><polyline points="7 7 17 7 17 17"/></svg>
          </div>
        </a>

      </div>
    </div>
  </main>
</BaseLayout>

<style>
  .community-page {
    padding: 100px 0 60px;
    min-height: 100vh;
  }

  .container {
    max-width: 1300px;
    margin: 0 auto;
    padding: 0 20px;
  }

  /* Bento Grid */
  .bento-grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 16px;
    grid-auto-rows: minmax(80px, auto);
  }

  .bento-card {
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 20px;
    padding: 24px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .bento-card:hover {
    border-color: rgba(249, 115, 22, 0.3);
  }

  /* Hero Card */
  .hero-card {
    grid-column: span 8;
    grid-row: span 2;
    display: flex;
    flex-direction: column;
    justify-content: center;
    position: relative;
    min-height: 280px;
  }

  .hero-bg {
    position: absolute;
    inset: 0;
    background:
      linear-gradient(135deg, rgba(249, 115, 22, 0.15) 0%, rgba(139, 92, 246, 0.1) 50%, rgba(6, 182, 212, 0.1) 100%);
    z-index: 0;
  }

  .hero-bg::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -20%;
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(249, 115, 22, 0.2) 0%, transparent 70%);
    border-radius: 50%;
  }

  .hero-content {
    position: relative;
    z-index: 1;
  }

  .hero-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 14px;
    background: rgba(249, 115, 22, 0.15);
    border: 1px solid rgba(249, 115, 22, 0.3);
    border-radius: 20px;
    color: #F97316;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 16px;
  }

  .badge-dot {
    width: 8px;
    height: 8px;
    background: #F97316;
    border-radius: 50%;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .hero-content h1 {
    font-size: 2.5rem;
    font-weight: 800;
    margin: 0 0 12px;
    background: linear-gradient(135deg, var(--text-main) 0%, var(--text-muted) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .hero-content p {
    font-size: 1.1rem;
    color: var(--text-muted);
    margin: 0 0 24px;
  }

  .hero-stats {
    display: flex;
    gap: 32px;
  }

  .mini-stat {
    display: flex;
    flex-direction: column;
  }

  .stat-num {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--text-main);
    line-height: 1;
  }

  .stat-text {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin-top: 4px;
  }

  /* Actions Card */
  .actions-card {
    grid-column: span 4;
    grid-row: span 2;
  }

  .actions-card h3 {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-muted);
    margin: 0 0 16px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .quick-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .quick-action {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 20px 16px;
    background: var(--bg-soft);
    border-radius: 16px;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .quick-action:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  }

  .quick-action.ask:hover { background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.1)); }
  .quick-action.share:hover { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1)); }
  .quick-action.fail:hover { background: linear-gradient(135deg, rgba(249, 115, 22, 0.2), rgba(249, 115, 22, 0.1)); }
  .quick-action.map:hover { background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.1)); }

  .action-icon {
    font-size: 1.8rem;
  }

  .action-text {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-main);
  }

  /* Category Cards */
  .category-card {
    grid-column: span 3;
    display: flex;
    flex-direction: column;
    text-decoration: none;
    cursor: pointer;
  }

  .category-card:hover {
    border-color: var(--cat-color);
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
  }

  .category-card:hover .cat-arrow {
    transform: translateX(4px);
    opacity: 1;
  }

  .cat-icon {
    font-size: 2.2rem;
    margin-bottom: 12px;
  }

  .cat-content h3 {
    font-size: 1.1rem;
    font-weight: 700;
    margin: 0 0 6px;
    color: var(--text-main);
  }

  .cat-content p {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin: 0;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .cat-footer {
    display: flex;
    gap: 12px;
    margin-top: auto;
    padding-top: 16px;
  }

  .cat-stat {
    font-size: 0.75rem;
    color: var(--text-muted);
    background: var(--bg-soft);
    padding: 4px 10px;
    border-radius: 8px;
  }

  .cat-arrow {
    position: absolute;
    top: 24px;
    right: 24px;
    color: var(--text-muted);
    opacity: 0;
    transition: all 0.3s ease;
  }

  /* Feature Cards */
  .feature-card {
    grid-column: span 4;
    display: flex;
    align-items: center;
    gap: 16px;
    text-decoration: none;
    cursor: pointer;
  }

  .feature-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
  }

  .feature-card:hover .feature-arrow {
    transform: translateX(4px);
    opacity: 1;
  }

  .feature-icon {
    font-size: 2.2rem;
    flex-shrink: 0;
  }

  .feature-content {
    flex: 1;
    min-width: 0;
  }

  .feature-content h3 {
    font-size: 1rem;
    font-weight: 700;
    margin: 0 0 4px;
    color: var(--text-main);
  }

  .feature-content p {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin: 0;
  }

  .feature-arrow {
    font-size: 1.2rem;
    color: var(--text-muted);
    opacity: 0;
    transition: all 0.3s ease;
  }

  .projects-feature {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));
    border-color: rgba(16, 185, 129, 0.2);
  }

  .projects-feature:hover {
    border-color: #10B981;
  }

  .projects-feature .feature-content h3 {
    color: #10B981;
  }

  .fails-feature {
    background: linear-gradient(135deg, rgba(249, 115, 22, 0.1), rgba(234, 88, 12, 0.05));
    border-color: rgba(249, 115, 22, 0.2);
  }

  .fails-feature:hover {
    border-color: #F97316;
  }

  .fails-feature .feature-content h3 {
    color: #F97316;
  }

  .map-feature {
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(124, 58, 237, 0.05));
    border-color: rgba(139, 92, 246, 0.2);
  }

  .map-feature:hover {
    border-color: #8B5CF6;
  }

  .map-feature .feature-content h3 {
    color: #8B5CF6;
  }

  /* Threads Card */
  .threads-card {
    grid-column: span 7;
    grid-row: span 2;
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .card-header h3 {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1rem;
    font-weight: 700;
    margin: 0;
    color: var(--text-main);
  }

  .see-all {
    font-size: 0.85rem;
    color: #F97316;
    text-decoration: none;
    font-weight: 500;
  }

  .see-all:hover {
    text-decoration: underline;
  }

  .threads-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .thread-item {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 14px;
    background: var(--bg-soft);
    border-radius: 14px;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .thread-item:hover {
    background: var(--bg-main);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .thread-avatar {
    width: 44px;
    height: 44px;
    border-radius: 12px;
    overflow: hidden;
    flex-shrink: 0;
    background: linear-gradient(135deg, #F97316, #EA580C);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .thread-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .avatar-letter {
    color: white;
    font-weight: 700;
    font-size: 1.1rem;
  }

  .thread-content {
    flex: 1;
    min-width: 0;
  }

  .thread-content h4 {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text-main);
    margin: 0 0 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .thread-meta {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.8rem;
    color: var(--text-muted);
  }

  .thread-author {
    font-weight: 500;
  }

  .thread-stats {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-shrink: 0;
  }

  .solved-badge {
    width: 24px;
    height: 24px;
    background: rgba(34, 197, 94, 0.15);
    color: #22C55E;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 700;
  }

  .reply-count {
    font-size: 0.8rem;
    color: var(--text-muted);
  }

  /* Projects Card */
  .projects-card {
    grid-column: span 5;
    grid-row: span 2;
  }

  .projects-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }

  .project-item {
    display: flex;
    flex-direction: column;
    text-decoration: none;
    border-radius: 14px;
    overflow: hidden;
    background: var(--bg-soft);
    transition: all 0.3s ease;
  }

  .project-item:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  }

  .project-thumb {
    aspect-ratio: 4/3;
    background: linear-gradient(135deg,
      hsl(var(--hue, 30), 80%, 20%),
      hsl(calc(var(--hue, 30) + 30), 70%, 15%)
    );
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .project-emoji {
    font-size: 2rem;
  }

  .pinned-badge {
    position: absolute;
    top: 8px;
    left: 8px;
    font-size: 0.9rem;
  }

  .project-info {
    padding: 12px;
  }

  .project-info h4 {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-main);
    margin: 0 0 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .project-meta {
    font-size: 0.75rem;
    color: var(--text-muted);
  }

  /* Rules Card */
  .rules-card {
    grid-column: span 4;
  }

  .rules-card h3 {
    font-size: 1rem;
    font-weight: 700;
    margin: 0 0 16px;
    color: var(--text-main);
  }

  .rules-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .rules-list li {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 0;
    border-bottom: 1px solid var(--border-soft);
    font-size: 0.85rem;
    color: var(--text-muted);
  }

  .rules-list li:last-child {
    border-bottom: none;
  }

  .rule-icon {
    width: 24px;
    height: 24px;
    background: rgba(34, 197, 94, 0.1);
    color: #22C55E;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 700;
    flex-shrink: 0;
  }

  /* Store Card */
  .store-card {
    grid-column: span 4;
    display: flex;
    align-items: center;
    gap: 16px;
    text-decoration: none;
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.05));
    border: 1px solid rgba(34, 197, 94, 0.2);
  }

  .store-card:hover {
    border-color: #22C55E;
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(34, 197, 94, 0.15);
  }

  .store-icon {
    font-size: 2.5rem;
  }

  .store-content {
    flex: 1;
  }

  .store-content h3 {
    font-size: 1.1rem;
    font-weight: 700;
    color: #22C55E;
    margin: 0 0 4px;
  }

  .store-content p {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin: 0;
  }

  .store-arrow {
    color: #22C55E;
    opacity: 0.7;
    transition: all 0.3s ease;
  }

  .store-card:hover .store-arrow {
    opacity: 1;
    transform: translate(4px, -4px);
  }

  /* Empty States */
  .empty-state {
    text-align: center;
    padding: 30px;
    color: var(--text-muted);
  }

  .empty-state.full {
    grid-column: span 2;
  }

  .empty-state p {
    margin: 0 0 12px;
  }

  .btn-small {
    display: inline-flex;
    padding: 8px 16px;
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 8px;
    color: var(--text-main);
    font-size: 0.8rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .btn-small:hover {
    border-color: #F97316;
    color: #F97316;
  }

  /* Responsive */
  @media (max-width: 1100px) {
    .hero-card {
      grid-column: span 12;
    }

    .actions-card {
      grid-column: span 12;
      grid-row: span 1;
    }

    .quick-actions {
      grid-template-columns: repeat(4, 1fr);
    }

    .category-card {
      grid-column: span 6;
    }

    .threads-card,
    .projects-card {
      grid-column: span 12;
    }

    .rules-card,
    .store-card {
      grid-column: span 6;
    }
  }

  @media (max-width: 768px) {
    .community-page {
      padding: 90px 0 40px;
    }

    .bento-grid {
      gap: 12px;
    }

    .bento-card {
      padding: 20px;
    }

    .hero-content h1 {
      font-size: 1.8rem;
    }

    .hero-stats {
      gap: 20px;
    }

    .stat-num {
      font-size: 1.4rem;
    }

    .quick-actions {
      grid-template-columns: repeat(2, 1fr);
    }

    .category-card {
      grid-column: span 6;
    }

    .rules-card,
    .store-card {
      grid-column: span 12;
    }

    .projects-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 540px) {
    .community-page {
      padding: 80px 0 30px;
    }

    .container {
      padding: 0 12px;
    }

    .bento-card {
      padding: 16px;
      border-radius: 16px;
    }

    .hero-content h1 {
      font-size: 1.5rem;
    }

    .hero-content p {
      font-size: 0.9rem;
    }

    .category-card {
      grid-column: span 12;
    }

    .projects-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .quick-action {
      padding: 16px 12px;
    }

    .action-icon {
      font-size: 1.5rem;
    }

    .action-text {
      font-size: 0.75rem;
    }
  }
</style>
