---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Header from "../../components/Header.astro";
import { getLanguage, getBaseUrl } from "../../lib/api";
import { getTranslations, type Language } from "../../lib/translations";

const lang = getLanguage(Astro.request) as Language;
const t = getTranslations(lang);
const baseUrl = getBaseUrl(lang);

// Title & description based on language
const titles: Record<Language, string> = {
  tr: "Cura Slicer Ä°nteraktif Rehber | 3D-labX",
  en: "Cura Slicer Interactive Guide | 3D-labX",
  de: "Cura Slicer Interaktive Anleitung | 3D-labX"
};
const descriptions: Record<Language, string> = {
  tr: "Cura Slicer ayarlarÄ±nÄ± interaktif simÃ¼lasyonlarla Ã¶ÄŸrenin. Katman yÃ¼ksekliÄŸi, infill, sÄ±caklÄ±k ve hata Ã§Ã¶zÃ¼mleri iÃ§in kapsamlÄ± rehber.",
  en: "Learn Cura Slicer settings with interactive simulations. Comprehensive guide for layer height, infill, temperature and troubleshooting.",
  de: "Lernen Sie Cura Slicer Einstellungen mit interaktiven Simulationen. Umfassende Anleitung fÃ¼r SchichthÃ¶he, FÃ¼llung, Temperatur und Fehlerbehebung."
};

const title = titles[lang];
const description = descriptions[lang];
const canonicalUrl = `${baseUrl}/rehberler/cura-slicer-interaktif-rehber`;

// Breadcrumb Schema
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": t.interactiveGuide.home, "item": baseUrl },
    { "@type": "ListItem", "position": 2, "name": t.interactiveGuide.guides, "item": `${baseUrl}/rehberler` },
    { "@type": "ListItem", "position": 3, "name": `${t.interactiveGuide.curaSlicer} ${t.interactiveGuide.masterClass}`, "item": canonicalUrl }
  ]
};

// Article Schema
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "headline": `${t.interactiveGuide.curaSlicer} ${t.interactiveGuide.masterClass}`,
  "description": description,
  "url": canonicalUrl,
  "datePublished": "2024-06-01",
  "dateModified": new Date().toISOString().split('T')[0],
  "author": { "@type": "Organization", "name": "3D-labX", "url": baseUrl },
  "publisher": { "@type": "Organization", "name": "3D-labX", "url": baseUrl }
};

// Descriptions for interactive guide page (localized)
const pageDescriptions: Record<Language, string> = {
  tr: "VolÃ¼metrik akÄ±ÅŸ limitlerinden termal dinamiklere; 3D baskÄ±nÄ±n bilimsel temellerini interaktif simÃ¼lasyonlarla Ã¶ÄŸrenin.",
  en: "From volumetric flow limits to thermal dynamics; learn the scientific fundamentals of 3D printing with interactive simulations.",
  de: "Von volumetrischen Flussgrenzen bis zu thermischen Dynamiken; lernen Sie die wissenschaftlichen Grundlagen des 3D-Drucks mit interaktiven Simulationen."
};
---

<BaseLayout title={title} description={description}>
  <Header />

  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
  <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />

  <!-- Header spacer for fixed positioning -->
  <div class="header-spacer"></div>

  <main class="cura-page">
    <div class="container">
      <!-- Breadcrumb -->
      <nav class="breadcrumb">
        <a href="/">{t.interactiveGuide.home}</a>
        <span>/</span>
        <a href="/rehberler">{t.interactiveGuide.guides}</a>
        <span>/</span>
        <span>{t.interactiveGuide.curaSlicer}</span>
      </nav>

      <!-- Header -->
      <header class="page-header">
        <div class="version-badge">{t.interactiveGuide.versionBadge}</div>
        <h1 class="page-title">{t.interactiveGuide.curaSlicer} <span>{t.interactiveGuide.masterClass}</span></h1>
        <p class="page-desc">
          {pageDescriptions[lang]}
        </p>
      </header>

      <!-- Navigation Tabs -->
      <nav class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('quality')" id="btn-quality">
          {t.interactiveGuide.tab1FlowQuality}
        </button>
        <button class="nav-tab" onclick="switchTab('strength')" id="btn-strength">
          {t.interactiveGuide.tab2StructuralMechanics}
        </button>
        <button class="nav-tab" onclick="switchTab('material')" id="btn-material">
          {t.interactiveGuide.tab3MaterialTroubleshooting}
        </button>
      </nav>

      <!-- Main Content -->
      <div class="main-card">

        <!-- TAB 1: QUALITY & FLOW -->
        <section id="tab-quality" class="tab-content">
          <div class="section-grid">
            <!-- Left Column: Controls -->
            <div class="controls-column">
              <h2 class="section-title">
                <span class="icon">âš™ï¸</span>
                {t.interactiveGuide.fluidDynamics}
              </h2>
              <p class="section-desc">
                {t.interactiveGuide.fluidDynamicsDesc}
              </p>

              <!-- Nozzle Selection -->
              <div class="control-panel">
                <div class="control-label">
                  <span class="label-text">{t.interactiveGuide.nozzleDiameter}</span>
                </div>
                <div class="btn-group">
                  <button class="btn-option" onclick="setNozzle(0.2)" data-nozzle="0.2">0.2mm</button>
                  <button class="btn-option active" onclick="setNozzle(0.4)" data-nozzle="0.4">0.4mm</button>
                  <button class="btn-option" onclick="setNozzle(0.6)" data-nozzle="0.6">0.6mm</button>
                  <button class="btn-option" onclick="setNozzle(0.8)" data-nozzle="0.8">0.8mm</button>
                </div>
              </div>

              <!-- Print Speed -->
              <div class="control-panel">
                <div class="control-label">
                  <span class="label-text">{t.interactiveGuide.printSpeed}</span>
                  <span class="control-value" id="speedDisplay">60 mm/s</span>
                </div>
                <input type="range" id="speedInput" min="20" max="150" step="5" value="60">
                <div class="range-labels">
                  <span>20 mm/s</span>
                  <span>150 mm/s</span>
                </div>
              </div>

              <!-- Layer Height -->
              <div class="control-panel">
                <div class="control-label">
                  <span class="label-text">{t.interactiveGuide.layerHeight}</span>
                  <span class="control-value" id="layerDisplay">0.20 mm</span>
                </div>
                <input type="range" id="layerInput" min="0.08" max="0.32" step="0.04" value="0.20">
                <div class="range-labels">
                  <span id="minLayerLabel">0.08mm ({t.interactiveGuide.detail})</span>
                  <span id="maxLayerLabel">0.32mm ({t.interactiveGuide.speed})</span>
                </div>
              </div>

              <!-- Calculated Metrics -->
              <div class="control-panel">
                <div class="control-label">
                  <span class="label-text">{t.interactiveGuide.lineWidth}</span>
                  <span class="control-value" id="lineWidthDisplay">0.44 mm</span>
                </div>
              </div>

              <div class="control-panel">
                <div class="control-label">
                  <span class="label-text">{t.interactiveGuide.volumetricFlow}</span>
                  <span class="control-value" id="flowRateDisplay">5.28 mmÂ³/s</span>
                </div>
                <div class="flow-bar-container">
                  <div class="flow-bar-bg">
                    <div class="flow-bar" id="flowBar" style="width: 35%"></div>
                  </div>
                  <p class="flow-status" id="flowStatus" data-safe={t.interactiveGuide.flowSafe} data-high={t.interactiveGuide.flowHigh} data-critical={t.interactiveGuide.flowCritical}>{t.interactiveGuide.flowSafe}</p>
                </div>
              </div>
            </div>

            <!-- Right Column: Visualizer -->
            <div class="visualizer-column">
              <div class="visualizer-panel">
                <div class="visualizer-header">
                  <span class="visualizer-title">{t.interactiveGuide.zOffsetSimulation}</span>
                  <span class="visualizer-badge" id="resolutionBadge" data-balanced={t.interactiveGuide.balanced} data-highres={t.interactiveGuide.highResolution} data-fast={t.interactiveGuide.fastCoarse}>{t.interactiveGuide.balanced}</span>
                </div>
                <div class="visualizer-body">
                  <canvas id="layerCanvas"></canvas>
                  <div class="z-offset-control">
                    <div class="z-offset-labels">
                      <span>{t.interactiveGuide.far} (+)</span>
                      <span>{t.interactiveGuide.near} (-)</span>
                    </div>
                    <input type="range" id="zOffsetInput" min="-0.15" max="0.15" step="0.01" value="0">
                    <div class="z-offset-value" id="zOffsetDisplay">{t.interactiveGuide.offset}: 0.00mm</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tips -->
          <div class="tips-grid">
            <div class="tip-card">
              <h4>{t.interactiveGuide.firstLayerTip}</h4>
              <p>{t.interactiveGuide.firstLayerTipDesc}</p>
            </div>
            <div class="tip-card">
              <h4>{t.interactiveGuide.goldenRuleTip}</h4>
              <p>{t.interactiveGuide.goldenRuleTipDesc}</p>
            </div>
            <div class="tip-card">
              <h4>{t.interactiveGuide.flowLimitTip}</h4>
              <p>{t.interactiveGuide.flowLimitTipDesc}</p>
            </div>
          </div>
        </section>

        <!-- TAB 2: STRUCTURAL MECHANICS -->
        <section id="tab-strength" class="tab-content hidden">
          <div class="section-grid">
            <!-- Left Column: Controls -->
            <div class="controls-column">
              <h2 class="section-title">
                <span class="icon">ğŸ—ï¸</span>
                {t.interactiveGuide.structuralMechanics}
              </h2>
              <p class="section-desc">
                {t.interactiveGuide.structuralMechanicsDesc}
              </p>

              <!-- Wall Count -->
              <div class="control-panel">
                <div class="control-label">
                  <span class="label-text">{t.interactiveGuide.wallCount}</span>
                  <span class="control-value" id="wallThicknessDisplay">1.2 mm</span>
                </div>
                <div class="btn-group">
                  <button class="btn-option" onclick="setWalls(2)">2</button>
                  <button class="btn-option active" onclick="setWalls(3)">3</button>
                  <button class="btn-option" onclick="setWalls(4)">4</button>
                  <button class="btn-option" onclick="setWalls(5)">5+</button>
                </div>
                <p class="control-note">* {t.interactiveGuide.wallNote}</p>
              </div>

              <!-- Infill Density -->
              <div class="control-panel">
                <div class="control-label">
                  <span class="label-text">{t.interactiveGuide.infillDensity}</span>
                  <span class="control-value" id="infillDisplay">20%</span>
                </div>
                <input type="range" id="infillInput" min="0" max="100" step="5" value="20">
                <div class="range-labels">
                  <span>0% ({t.interactiveGuide.empty})</span>
                  <span>100% ({t.interactiveGuide.solid})</span>
                </div>
              </div>

              <!-- Pattern Selection -->
              <div class="control-panel">
                <div class="control-label">
                  <span class="label-text">{t.interactiveGuide.patternGeometry}</span>
                </div>
                <div class="select-wrapper">
                  <select class="select-dropdown" id="patternSelect" onchange="updatePattern()">
                    <option value="grid">{t.interactiveGuide.patternGrid}</option>
                    <option value="triangles">{t.interactiveGuide.patternTriangles}</option>
                    <option value="gyroid">{t.interactiveGuide.patternGyroid}</option>
                  </select>
                </div>
              </div>

              <!-- Metrics -->
              <div class="metrics-grid">
                <div class="metric-card">
                  <div class="metric-label">{t.interactiveGuide.estimatedLoadCapacity}</div>
                  <div class="metric-value" id="strengthDisplay">~25 kg</div>
                </div>
                <div class="metric-card">
                  <div class="metric-label">{t.interactiveGuide.materialCost}</div>
                  <div class="metric-value success" id="costDisplay" data-low={t.interactiveGuide.costLow} data-medium={t.interactiveGuide.costMedium} data-high={t.interactiveGuide.costHigh}>{t.interactiveGuide.costLow}</div>
                </div>
              </div>
            </div>

            <!-- Right Column: Visualizer -->
            <div class="visualizer-column">
              <div class="visualizer-panel">
                <div class="visualizer-header">
                  <span class="visualizer-title">{t.interactiveGuide.crossSectionAnalysis}</span>
                  <span class="visualizer-badge" id="patternBadge">GRID</span>
                </div>
                <div class="visualizer-body">
                  <canvas id="strengthCanvas"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Tips -->
          <div class="tips-grid">
            <div class="tip-card">
              <h4>{t.interactiveGuide.functionalPartsTip}</h4>
              <p>{t.interactiveGuide.functionalPartsTipDesc}</p>
            </div>
            <div class="tip-card">
              <h4>{t.interactiveGuide.decorativePartsTip}</h4>
              <p>{t.interactiveGuide.decorativePartsTipDesc}</p>
            </div>
            <div class="tip-card">
              <h4>{t.interactiveGuide.gyroidAdvantageTip}</h4>
              <p>{t.interactiveGuide.gyroidAdvantageTipDesc}</p>
            </div>
          </div>
        </section>

        <!-- TAB 3: MATERIAL & TROUBLESHOOTING -->
        <section id="tab-material" class="tab-content hidden">
          <div class="section-grid">
            <!-- Left Column: Temperature -->
            <div class="controls-column">
              <h2 class="section-title">
                <span class="icon">ğŸ”¥</span>
                {t.interactiveGuide.thermalAdhesionAnalysis}
              </h2>
              <p class="section-desc">
                {t.interactiveGuide.thermalAdhesionDesc}
              </p>

              <div class="control-panel chart-panel">
                <div class="chart-container">
                  <canvas id="tempChart"></canvas>
                </div>
              </div>

              <div class="fan-physics-box">
                <div class="control-label">
                  <span class="label-text">{t.interactiveGuide.fanSpeed}</span>
                  <span class="control-value" id="fanDisplay">100%</span>
                </div>
                <input type="range" id="fanInput" min="0" max="100" step="5" value="100">
                <p class="fan-physics-text" id="fanText">
                  {t.interactiveGuide.fanSpeedPLA}
                </p>
              </div>
            </div>

            <!-- Right Column: Troubleshooting -->
            <div class="controls-column">
              <h2 class="section-title">
                <span class="icon">ğŸ› ï¸</span>
                {t.interactiveGuide.troubleshootingCenter}
              </h2>
              <p class="section-desc">
                {t.interactiveGuide.troubleshootingCenterDesc}
              </p>

              <div class="control-panel">
                <div class="select-wrapper">
                  <select class="select-dropdown" id="troubleSelect" onchange="solveTrouble()">
                    <option value="" selected disabled>{t.interactiveGuide.selectProblem}</option>
                    <option value="stringing">ğŸ•·ï¸ {t.interactiveGuide.stringing}</option>
                    <option value="blobs">ğŸ«§ {t.interactiveGuide.blobs}</option>
                    <option value="gaps">ğŸŒ‘ {t.interactiveGuide.underExtrusion}</option>
                    <option value="warp">ğŸ“ {t.interactiveGuide.warping}</option>
                    <option value="elephant">ğŸ˜ {t.interactiveGuide.elephantFoot}</option>
                    <option value="layer">â• {t.interactiveGuide.layerSeparation}</option>
                  </select>
                </div>
              </div>

              <div class="solution-box hidden" id="solutionBox">
                <h3 class="solution-title" id="solTitle"></h3>
                <p class="solution-desc" id="solDesc"></p>
                <div class="solution-settings" id="solSettings"></div>
                <div class="solution-tip" id="solTip"></div>
              </div>

              <div class="solution-placeholder" id="solutionPlaceholder">
                {t.interactiveGuide.solutionPlaceholder}
              </div>
            </div>
          </div>

          <!-- Tips -->
          <div class="tips-grid">
            <div class="tip-card">
              <h4>{t.interactiveGuide.plaSettingsTip}</h4>
              <p>{t.interactiveGuide.plaSettingsTipDesc}</p>
            </div>
            <div class="tip-card">
              <h4>{t.interactiveGuide.petgSettingsTip}</h4>
              <p>{t.interactiveGuide.petgSettingsTipDesc}</p>
            </div>
            <div class="tip-card">
              <h4>{t.interactiveGuide.absSettingsTip}</h4>
              <p>{t.interactiveGuide.absSettingsTipDesc}</p>
            </div>
          </div>
        </section>
      </div>

      <!-- Footer -->
      <footer class="page-footer">
        <p>{t.interactiveGuide.curaSlicer} | {t.interactiveGuide.versionBadge}</p>
        <a href="/rehberler" class="back-link">
          {t.interactiveGuide.backToGuides}
        </a>
      </footer>
    </div>
  </main>
</BaseLayout>

<!-- Chart.js CDN -->
<script is:inline src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Language data for JavaScript -->
<script define:vars={{ lang }}>
  window.curaI18n = {
    lang: lang,
    // UI Labels (from translations)
    labels: {
      tr: {
        highResolution: "YÃ¼ksek Ã‡Ã¶zÃ¼nÃ¼rlÃ¼k",
        balanced: "Dengeli",
        fastCoarse: "HÄ±zlÄ± & Kaba",
        flowSafe: "GÃ¼venli",
        flowHigh: "YÃ¼ksek",
        flowCritical: "Kritik!",
        costLow: "DÃ¼ÅŸÃ¼k",
        costMedium: "Orta",
        costHigh: "YÃ¼ksek",
        detail: "Detay",
        speed: "HÄ±z",
        offset: "Offset"
      },
      en: {
        highResolution: "High Resolution",
        balanced: "Balanced",
        fastCoarse: "Fast & Coarse",
        flowSafe: "Safe",
        flowHigh: "High",
        flowCritical: "Critical!",
        costLow: "Low",
        costMedium: "Medium",
        costHigh: "High",
        detail: "Detail",
        speed: "Speed",
        offset: "Offset"
      },
      de: {
        highResolution: "Hohe AuflÃ¶sung",
        balanced: "Ausgewogen",
        fastCoarse: "Schnell & Grob",
        flowSafe: "Sicher",
        flowHigh: "Hoch",
        flowCritical: "Kritisch!",
        costLow: "Niedrig",
        costMedium: "Mittel",
        costHigh: "Hoch",
        detail: "Detail",
        speed: "Geschwindigkeit",
        offset: "Offset"
      }
    },
    // Fan text
    fanText: {
      tr: {
        abs: "ABS/ASA iÃ§in ideal. Katmanlar mÃ¼kemmel yapÄ±ÅŸÄ±r, ancak kÃ¶prÃ¼leme (bridging) zorlaÅŸÄ±r.",
        petg: "PETG iÃ§in Ã¶nerilir. Katman yapÄ±ÅŸmasÄ± korunur, stringing azalÄ±r.",
        medium: "Orta soÄŸutma. Ã‡oÄŸu filament iÃ§in dengeli bir seÃ§im.",
        pla: "PLA iÃ§in ideal. MÃ¼kemmel detay, kÃ¶prÃ¼leme ve overhang performansÄ±."
      },
      en: {
        abs: "Ideal for ABS/ASA. Layers adhere perfectly, but bridging becomes difficult.",
        petg: "Recommended for PETG. Layer adhesion is maintained, stringing reduced.",
        medium: "Medium cooling. A balanced choice for most filaments.",
        pla: "Ideal for PLA. Excellent detail, bridging and overhang performance."
      },
      de: {
        abs: "Ideal fÃ¼r ABS/ASA. Schichten haften perfekt, aber Bridging wird schwierig.",
        petg: "Empfohlen fÃ¼r PETG. Schichthaftung bleibt erhalten, Stringing wird reduziert.",
        medium: "Mittlere KÃ¼hlung. Eine ausgewogene Wahl fÃ¼r die meisten Filamente.",
        pla: "Ideal fÃ¼r PLA. Ausgezeichnete Details, Bridging und Ãœberhang-Leistung."
      }
    },
    // Chart labels
    chartLabels: {
      tr: { label: "Katman YapÄ±ÅŸmasÄ±", axis: "PLA Nozzle SÄ±caklÄ±ÄŸÄ±", excellent: "MÃ¼kemmel yapÄ±ÅŸma", good: "Ä°yi yapÄ±ÅŸma", medium: "Orta yapÄ±ÅŸma", weak: "ZayÄ±f yapÄ±ÅŸma" },
      en: { label: "Layer Adhesion", axis: "PLA Nozzle Temperature", excellent: "Excellent adhesion", good: "Good adhesion", medium: "Medium adhesion", weak: "Weak adhesion" },
      de: { label: "Schichthaftung", axis: "PLA DÃ¼sentemperatur", excellent: "Ausgezeichnete Haftung", good: "Gute Haftung", medium: "Mittlere Haftung", weak: "Schwache Haftung" }
    },
    // Flow messages
    flowMessages: {
      tr: { safe: "GÃ¼venli akÄ±ÅŸ aralÄ±ÄŸÄ±. Standart hotend iÃ§in idealdir.", high: "YÃ¼ksek akÄ±ÅŸ. SÄ±caklÄ±ÄŸÄ± +5-10Â°C artÄ±rmayÄ± deneyin.", critical: "Kritik! Standart hotend bu akÄ±ÅŸÄ± eritebilir. SÄ±caklÄ±ÄŸÄ± artÄ±rÄ±n veya hÄ±zÄ± azaltÄ±n." },
      en: { safe: "Safe flow range. Ideal for standard hotend.", high: "High flow. Try increasing temperature +5-10Â°C.", critical: "Critical! Standard hotend may struggle. Increase temp or reduce speed." },
      de: { safe: "Sicherer Flussbereich. Ideal fÃ¼r Standard-Hotend.", high: "Hoher Fluss. Versuchen Sie die Temperatur um +5-10Â°C zu erhÃ¶hen.", critical: "Kritisch! Standard-Hotend kÃ¶nnte Probleme haben. Temperatur erhÃ¶hen oder Geschwindigkeit reduzieren." }
    },
    // Troubleshooting data
    troubleData: {
      tr: {
        stringing: { title: "Ä°pliklenme (Stringing)", desc: "Nozzle hareket ederken erimiÅŸ filament sÄ±zÄ±yor ve ince iplikler bÄ±rakÄ±yor.", settings: [{ name: "Retraction Distance", value: "+1-2mm artÄ±rÄ±n" }, { name: "Retraction Speed", value: "40-50 mm/s" }, { name: "Nozzle SÄ±caklÄ±ÄŸÄ±", value: "-5 ile -10Â°C azaltÄ±n" }, { name: "Travel Speed", value: "150+ mm/s" }], tip: "Pro tip: Filament nemli olabilir. Kurutma iÅŸlemine tabi tutun." },
        blobs: { title: "Topaklar / Zits (Blobs)", desc: "YÃ¼zey Ã¼zerinde kÃ¼Ã§Ã¼k kabarcÄ±klar veya topaklar.", settings: [{ name: "Coasting", value: "Aktif edin (0.2-0.5mm)" }, { name: "Wipe", value: "Aktif edin" }, { name: "Z-Seam", value: "Sharpest Corner / Hide" }, { name: "Outer Wall Wipe", value: "0.2mm" }], tip: "Pro tip: Power Loss Recovery aktifse kapatmayÄ± deneyin." },
        gaps: { title: "Eksik EkstrÃ¼zyon (Under-extrusion)", desc: "Katmanlar arasÄ±nda boÅŸluklar, zayÄ±f dolgu veya ince duvarlar.", settings: [{ name: "Flow Rate", value: "%105-110 artÄ±rÄ±n" }, { name: "Nozzle SÄ±caklÄ±ÄŸÄ±", value: "+5-10Â°C artÄ±rÄ±n" }, { name: "Print Speed", value: "AzaltÄ±n" }, { name: "Nozzle", value: "Temizleyin veya deÄŸiÅŸtirin" }], tip: "Pro tip: Extruder diÅŸlilerini kontrol edin, E-steps kalibrasyonu yapÄ±n." },
        warp: { title: "KÃ¶ÅŸe KalkmasÄ± (Warping)", desc: "BaskÄ± tabladan kalkÄ±yor, Ã¶zellikle kÃ¶ÅŸelerde.", settings: [{ name: "Bed SÄ±caklÄ±ÄŸÄ±", value: "+5-10Â°C artÄ±rÄ±n" }, { name: "Brim", value: "Aktif edin (5-10mm)" }, { name: "Enclosure", value: "KapalÄ± ortam kullanÄ±n" }, { name: "Draft Shield", value: "Aktif edin (ABS iÃ§in)" }], tip: "Pro tip: Tabla temizliÄŸi kritik. IPA ile silin." },
        elephant: { title: "Fil AyaÄŸÄ± (Elephant Foot)", desc: "Ä°lk katmanlar dÄ±ÅŸarÄ±ya doÄŸru yayÄ±lmÄ±ÅŸ, taban normalden geniÅŸ.", settings: [{ name: "Initial Layer Exp.", value: "-0.1 to -0.2mm" }, { name: "Bed SÄ±caklÄ±ÄŸÄ±", value: "-5Â°C azaltÄ±n" }, { name: "Z-Offset", value: "HafifÃ§e artÄ±rÄ±n" }, { name: "Initial Layer Speed", value: "AzaltÄ±n" }], tip: "Pro tip: Z-offset Ã§ok yakÄ±n ayarlanmÄ±ÅŸ olabilir." },
        layer: { title: "Katman AyrÄ±lmasÄ± (Layer Separation)", desc: "Katmanlar birbirine yapÄ±ÅŸmÄ±yor, parÃ§alar zayÄ±f ve kolay kÄ±rÄ±lÄ±yor.", settings: [{ name: "Nozzle SÄ±caklÄ±ÄŸÄ±", value: "+10-15Â°C artÄ±rÄ±n" }, { name: "Print Speed", value: "AzaltÄ±n" }, { name: "Fan HÄ±zÄ±", value: "AzaltÄ±n (%50-70)" }, { name: "Layer Height", value: "AzaltÄ±n" }], tip: "Pro tip: SoÄŸuk ortamda basÄ±yorsanÄ±z enclosure kullanÄ±n." }
      },
      en: {
        stringing: { title: "Stringing", desc: "Molten filament leaks and leaves thin strings as the nozzle moves.", settings: [{ name: "Retraction Distance", value: "Increase +1-2mm" }, { name: "Retraction Speed", value: "40-50 mm/s" }, { name: "Nozzle Temp", value: "Reduce -5 to -10Â°C" }, { name: "Travel Speed", value: "150+ mm/s" }], tip: "Pro tip: Filament may be wet. Try drying it." },
        blobs: { title: "Blobs / Zits", desc: "Small bubbles or blobs on the surface.", settings: [{ name: "Coasting", value: "Enable (0.2-0.5mm)" }, { name: "Wipe", value: "Enable" }, { name: "Z-Seam", value: "Sharpest Corner / Hide" }, { name: "Outer Wall Wipe", value: "0.2mm" }], tip: "Pro tip: Try disabling Power Loss Recovery if enabled." },
        gaps: { title: "Under Extrusion", desc: "Gaps between layers, weak infill or thin walls.", settings: [{ name: "Flow Rate", value: "Increase to 105-110%" }, { name: "Nozzle Temp", value: "Increase +5-10Â°C" }, { name: "Print Speed", value: "Reduce" }, { name: "Nozzle", value: "Clean or replace" }], tip: "Pro tip: Check extruder gears, calibrate E-steps." },
        warp: { title: "Warping", desc: "Print lifts from bed, especially at corners.", settings: [{ name: "Bed Temp", value: "Increase +5-10Â°C" }, { name: "Brim", value: "Enable (5-10mm)" }, { name: "Enclosure", value: "Use enclosed chamber" }, { name: "Draft Shield", value: "Enable (for ABS)" }], tip: "Pro tip: Bed cleanliness is critical. Wipe with IPA." },
        elephant: { title: "Elephant Foot", desc: "First layers spread outward, base wider than normal.", settings: [{ name: "Initial Layer Exp.", value: "-0.1 to -0.2mm" }, { name: "Bed Temp", value: "Reduce -5Â°C" }, { name: "Z-Offset", value: "Slightly increase" }, { name: "Initial Layer Speed", value: "Reduce" }], tip: "Pro tip: Z-offset may be set too close." },
        layer: { title: "Layer Separation", desc: "Layers don't stick together, parts are weak and break easily.", settings: [{ name: "Nozzle Temp", value: "Increase +10-15Â°C" }, { name: "Print Speed", value: "Reduce" }, { name: "Fan Speed", value: "Reduce (50-70%)" }, { name: "Layer Height", value: "Reduce" }], tip: "Pro tip: Use enclosure if printing in cold environment." }
      },
      de: {
        stringing: { title: "FÃ¤denziehen (Stringing)", desc: "Geschmolzenes Filament tritt aus und hinterlÃ¤sst dÃ¼nne FÃ¤den bei DÃ¼senbewegung.", settings: [{ name: "Retraction Distance", value: "+1-2mm erhÃ¶hen" }, { name: "Retraction Speed", value: "40-50 mm/s" }, { name: "DÃ¼sentemperatur", value: "-5 bis -10Â°C reduzieren" }, { name: "Travel Speed", value: "150+ mm/s" }], tip: "Pro-Tipp: Filament kÃ¶nnte feucht sein. Versuchen Sie es zu trocknen." },
        blobs: { title: "Kleckse / Pickel (Blobs)", desc: "Kleine Blasen oder Kleckse auf der OberflÃ¤che.", settings: [{ name: "Coasting", value: "Aktivieren (0.2-0.5mm)" }, { name: "Wipe", value: "Aktivieren" }, { name: "Z-Seam", value: "Sharpest Corner / Hide" }, { name: "Outer Wall Wipe", value: "0.2mm" }], tip: "Pro-Tipp: Versuchen Sie Power Loss Recovery zu deaktivieren." },
        gaps: { title: "Unterextrusion", desc: "LÃ¼cken zwischen Schichten, schwache FÃ¼llung oder dÃ¼nne WÃ¤nde.", settings: [{ name: "Flow Rate", value: "Auf 105-110% erhÃ¶hen" }, { name: "DÃ¼sentemperatur", value: "+5-10Â°C erhÃ¶hen" }, { name: "Print Speed", value: "Reduzieren" }, { name: "Nozzle", value: "Reinigen oder ersetzen" }], tip: "Pro-Tipp: PrÃ¼fen Sie Extruder-ZahnrÃ¤der, kalibrieren Sie E-Steps." },
        warp: { title: "Verzug (Warping)", desc: "Druck lÃ¶st sich vom Bett, besonders an Ecken.", settings: [{ name: "Betttemperatur", value: "+5-10Â°C erhÃ¶hen" }, { name: "Brim", value: "Aktivieren (5-10mm)" }, { name: "Enclosure", value: "Geschlossenen Raum verwenden" }, { name: "Draft Shield", value: "Aktivieren (fÃ¼r ABS)" }], tip: "Pro-Tipp: Bettreinigung ist kritisch. Mit IPA abwischen." },
        elephant: { title: "ElefantenfuÃŸ", desc: "Erste Schichten breiten sich aus, Basis breiter als normal.", settings: [{ name: "Initial Layer Exp.", value: "-0.1 to -0.2mm" }, { name: "Betttemperatur", value: "-5Â°C reduzieren" }, { name: "Z-Offset", value: "Leicht erhÃ¶hen" }, { name: "Initial Layer Speed", value: "Reduzieren" }], tip: "Pro-Tipp: Z-Offset kÃ¶nnte zu nah eingestellt sein." },
        layer: { title: "SchichtablÃ¶sung", desc: "Schichten haften nicht zusammen, Teile sind schwach und brechen leicht.", settings: [{ name: "DÃ¼sentemperatur", value: "+10-15Â°C erhÃ¶hen" }, { name: "Print Speed", value: "Reduzieren" }, { name: "LÃ¼ftergeschwindigkeit", value: "Reduzieren (50-70%)" }, { name: "Layer Height", value: "Reduzieren" }], tip: "Pro-Tipp: Verwenden Sie ein GehÃ¤use bei kalter Umgebung." }
      }
    }
  };
</script>

<script is:inline>
  // ================================
  // I18N HELPER
  // ================================
  function getI18n() {
    const data = window.curaI18n;
    const lang = data.lang;
    return {
      ...data.labels[lang],
      fanText: data.fanText[lang],
      chartLabels: data.chartLabels[lang],
      flowMessages: data.flowMessages[lang],
      troubleData: data.troubleData[lang]
    };
  }

  // ================================
  // GLOBAL STATE
  // ================================
  let currentNozzle = 0.4;
  let currentSpeed = 60;
  let currentLayerHeight = 0.20;
  let currentWalls = 3;
  let currentInfill = 20;
  let currentPattern = 'grid';
  let zOffset = 0;
  let tempChart = null;
  let i18n = null;

  // ================================
  // TAB NAVIGATION
  // ================================
  function switchTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
    document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));

    document.getElementById('tab-' + tabId).classList.remove('hidden');
    document.getElementById('btn-' + tabId).classList.add('active');

    setTimeout(() => {
      if (tabId === 'quality') drawLayerSim();
      if (tabId === 'strength') drawStrengthPattern();
      if (tabId === 'material' && tempChart) tempChart.resize();
    }, 50);
  }

  // ================================
  // QUALITY TAB FUNCTIONS
  // ================================
  function setNozzle(size) {
    currentNozzle = size;
    document.querySelectorAll('[data-nozzle]').forEach(btn => {
      btn.classList.toggle('active', parseFloat(btn.dataset.nozzle) === size);
    });

    const minLayer = (size * 0.2).toFixed(2);
    const maxLayer = (size * 0.8).toFixed(2);
    const layerInput = document.getElementById('layerInput');
    layerInput.min = minLayer;
    layerInput.max = maxLayer;

    if (currentLayerHeight > parseFloat(maxLayer)) {
      currentLayerHeight = parseFloat(maxLayer);
      layerInput.value = currentLayerHeight;
    }
    if (currentLayerHeight < parseFloat(minLayer)) {
      currentLayerHeight = parseFloat(minLayer);
      layerInput.value = currentLayerHeight;
    }

    document.getElementById('minLayerLabel').textContent = minLayer + 'mm (' + i18n.detail + ')';
    document.getElementById('maxLayerLabel').textContent = maxLayer + 'mm (' + i18n.speed + ')';

    updateQualityMetrics();
    updateWallThickness();
  }

  function updateQualityMetrics() {
    const lineWidth = currentNozzle * 1.1;
    document.getElementById('lineWidthDisplay').textContent = lineWidth.toFixed(2) + ' mm';

    const flow = currentSpeed * lineWidth * currentLayerHeight;
    document.getElementById('flowRateDisplay').textContent = flow.toFixed(2) + ' mmÂ³/s';

    const maxFlow = 15;
    const percentage = Math.min((flow / maxFlow) * 100, 100);
    const flowBar = document.getElementById('flowBar');
    flowBar.style.width = percentage + '%';

    const flowStatus = document.getElementById('flowStatus');
    if (flow > 12) {
      flowBar.className = 'flow-bar danger';
      flowStatus.innerHTML = '<strong class="error">' + i18n.flowCritical + '</strong> ' + i18n.flowMessages.critical;
    } else if (flow > 9) {
      flowBar.className = 'flow-bar warning';
      flowStatus.innerHTML = '<strong class="warn">' + i18n.flowHigh + '</strong> ' + i18n.flowMessages.high;
    } else {
      flowBar.className = 'flow-bar';
      flowStatus.textContent = i18n.flowMessages.safe;
    }

    const ratio = currentLayerHeight / currentNozzle;
    const badge = document.getElementById('resolutionBadge');
    if (ratio <= 0.35) {
      badge.textContent = i18n.highResolution;
      badge.className = 'visualizer-badge success';
    } else if (ratio <= 0.6) {
      badge.textContent = i18n.balanced;
      badge.className = 'visualizer-badge';
    } else {
      badge.textContent = i18n.fastCoarse;
      badge.className = 'visualizer-badge warning';
    }

    drawLayerSim();
  }

  function drawLayerSim() {
    const canvas = document.getElementById('layerCanvas');
    if (!canvas) return;

    const container = canvas.parentElement;
    const rect = container.getBoundingClientRect();
    if (rect.width === 0 || rect.height === 0) return;

    const dpr = window.devicePixelRatio || 1;
    canvas.width = rect.width * dpr;
    canvas.height = (rect.height - 100) * dpr;
    canvas.style.width = rect.width + 'px';
    canvas.style.height = (rect.height - 100) + 'px';

    const ctx = canvas.getContext('2d');
    ctx.scale(dpr, dpr);
    ctx.clearRect(0, 0, rect.width, rect.height - 100);

    const w = rect.width;
    const h = rect.height - 100;
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

    ctx.fillStyle = isDark ? '#334155' : '#CBD5E1';
    ctx.fillRect(0, h - 8, w, 8);

    const scale = 50;
    const layerH = Math.max(3, currentLayerHeight * scale);
    const centerX = w / 2;
    const baseY = h - 12;
    const visualOffset = zOffset * scale * 4;
    const radius = Math.min(w, h) * 0.35;
    const layers = Math.floor(radius / layerH);

    const normalColor = isDark ? 'rgba(96, 165, 250, 0.5)' : 'rgba(37, 99, 235, 0.3)';
    const squishColor = isDark ? 'rgba(239, 68, 68, 0.5)' : 'rgba(239, 68, 68, 0.3)';
    const gapColor = isDark ? 'rgba(234, 179, 8, 0.5)' : 'rgba(234, 179, 8, 0.3)';
    const strokeColor = isDark ? '#60A5FA' : '#2563EB';

    ctx.strokeStyle = strokeColor;
    ctx.lineWidth = 1;

    for (let i = 0; i < layers; i++) {
      let y = baseY - (i * layerH) - visualOffset;
      let currentLayerH = layerH;
      let widthMod = 0;

      if (i === 0) {
        if (zOffset < 0) {
          currentLayerH = Math.max(2, layerH + visualOffset);
          y = baseY - currentLayerH;
          widthMod = Math.abs(visualOffset) * 2;
          ctx.fillStyle = squishColor;
        } else if (zOffset > 0) {
          ctx.fillStyle = gapColor;
        } else {
          ctx.fillStyle = normalColor;
        }
      } else {
        ctx.fillStyle = normalColor;
      }

      const hFromBase = i * layerH;
      if (hFromBase >= radius) break;

      const layerWidth = (Math.sqrt(radius * radius - hFromBase * hFromBase) * 2) + widthMod;
      const x = centerX - layerWidth / 2;

      ctx.beginPath();
      ctx.rect(x, y - currentLayerH, layerWidth, currentLayerH);
      ctx.fill();
      ctx.stroke();
    }
  }

  // ================================
  // STRENGTH TAB FUNCTIONS
  // ================================
  function setWalls(count) {
    currentWalls = count;
    document.querySelectorAll('#tab-strength .btn-option').forEach(btn => {
      const btnVal = parseInt(btn.textContent);
      btn.classList.toggle('active', btnVal === count || (count === 5 && btn.textContent.includes('5+')));
    });
    updateWallThickness();
    updateStrengthMetrics();
  }

  function updateWallThickness() {
    const thickness = (currentWalls * currentNozzle).toFixed(1);
    const display = document.getElementById('wallThicknessDisplay');
    if (display) display.textContent = thickness + ' mm';
  }

  function updatePattern() {
    currentPattern = document.getElementById('patternSelect').value;
    document.getElementById('patternBadge').textContent = currentPattern.toUpperCase();
    updateStrengthMetrics();
  }

  function updateStrengthMetrics() {
    const nozzleFactor = currentNozzle / 0.4;
    let strength = (currentWalls * 20 * nozzleFactor) + (currentInfill * 0.3);
    if (currentPattern === 'gyroid') strength *= 1.15;
    if (currentPattern === 'triangles') strength *= 1.1;

    const loadKg = Math.round((strength * 0.5) + 10);
    document.getElementById('strengthDisplay').textContent = '~' + loadKg + ' kg';

    const cost = (currentWalls * 5 * nozzleFactor) + (currentInfill * 0.7);
    const costDisplay = document.getElementById('costDisplay');
    if (cost < 35) {
      costDisplay.textContent = i18n.costLow;
      costDisplay.className = 'metric-value success';
    } else if (cost < 70) {
      costDisplay.textContent = i18n.costMedium;
      costDisplay.className = 'metric-value warning';
    } else {
      costDisplay.textContent = i18n.costHigh;
      costDisplay.className = 'metric-value error';
    }

    drawStrengthPattern();
  }

  function drawStrengthPattern() {
    const canvas = document.getElementById('strengthCanvas');
    if (!canvas) return;

    const container = canvas.parentElement;
    const rect = container.getBoundingClientRect();
    if (rect.width === 0 || rect.height === 0) return;

    const dpr = window.devicePixelRatio || 1;
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    canvas.style.width = rect.width + 'px';
    canvas.style.height = rect.height + 'px';

    const ctx = canvas.getContext('2d');
    ctx.scale(dpr, dpr);
    ctx.clearRect(0, 0, rect.width, rect.height);

    const w = rect.width;
    const h = rect.height;
    const padding = 30;
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    const wallThick = Math.max(4, currentWalls * currentNozzle * 5);

    ctx.lineWidth = wallThick;
    ctx.strokeStyle = isDark ? '#EF4444' : '#DC2626';
    ctx.strokeRect(padding, padding, w - padding * 2, h - padding * 2);

    ctx.save();
    ctx.beginPath();
    const inset = padding + wallThick / 2;
    ctx.rect(inset, inset, w - inset * 2, h - inset * 2);
    ctx.clip();

    ctx.lineWidth = Math.max(1, currentNozzle * 2);
    ctx.strokeStyle = isDark ? '#22C55E' : '#16A34A';

    let spacing = 100 - (currentInfill * 0.9);
    if (spacing < 8) spacing = 8;
    if (currentInfill === 0) spacing = 10000;

    if (currentPattern === 'grid') {
      for (let x = 0; x <= w; x += spacing) {
        ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, h); ctx.stroke();
      }
      for (let y = 0; y <= h; y += spacing) {
        ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(w, y); ctx.stroke();
      }
    } else if (currentPattern === 'triangles') {
      for (let x = -h; x <= w; x += spacing) {
        ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x + h, h); ctx.stroke();
      }
      for (let x = 0; x <= w + h; x += spacing) {
        ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x - h, h); ctx.stroke();
      }
      for (let y = 0; y <= h; y += spacing * 0.86) {
        ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(w, y); ctx.stroke();
      }
    } else if (currentPattern === 'gyroid') {
      ctx.beginPath();
      for (let y = 0; y < h; y += 4) {
        for (let x = 0; x < w; x += 4) {
          const val = Math.sin(x / spacing * Math.PI) + Math.cos(y / spacing * Math.PI);
          if (Math.abs(val) < 0.2) ctx.rect(x, y, 3, 3);
        }
      }
      ctx.fill();
    }
    ctx.restore();
  }

  // ================================
  // MATERIAL TAB FUNCTIONS
  // ================================
  function initTempChart() {
    const ctx = document.getElementById('tempChart');
    if (!ctx || tempChart) return;

    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 250);
    gradient.addColorStop(0, 'rgba(249, 115, 22, 0.4)');
    gradient.addColorStop(1, 'rgba(249, 115, 22, 0)');

    tempChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['185', '195', '200', '205', '210', '215', '220'],
        datasets: [{
          label: i18n.chartLabel,
          data: [30, 70, 90, 95, 85, 65, 40],
          borderColor: '#F97316',
          backgroundColor: gradient,
          fill: true,
          tension: 0.4,
          pointBackgroundColor: '#fff',
          pointBorderColor: '#F97316',
          pointRadius: 5,
          pointHoverRadius: 7
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: function(context) {
                const val = context.raw;
                if (val >= 90) return i18n.chartTooltips.excellent;
                if (val >= 70) return i18n.chartTooltips.good;
                if (val >= 50) return i18n.chartTooltips.medium;
                return i18n.chartTooltips.weak;
              }
            }
          }
        },
        scales: {
          y: { display: false, min: 0, max: 100 },
          x: {
            grid: { color: isDark ? '#334155' : '#E2E8F0' },
            ticks: {
              color: isDark ? '#94A3B8' : '#64748B',
              callback: function(value, index) {
                return this.getLabelForValue(value) + 'Â°C';
              }
            },
            title: {
              display: true,
              text: i18n.chartAxisLabel,
              color: isDark ? '#94A3B8' : '#64748B'
            }
          }
        }
      }
    });
  }

  function updateFanPhysics() {
    const value = document.getElementById('fanInput').value;
    document.getElementById('fanDisplay').textContent = value + '%';

    const text = document.getElementById('fanText');
    if (value == 0) {
      text.textContent = i18n.fanText.abs;
    } else if (value < 30) {
      text.textContent = i18n.fanText.petg;
    } else if (value < 70) {
      text.textContent = i18n.fanText.medium;
    } else {
      text.textContent = i18n.fanText.pla;
    }
  }

  // ================================
  // TROUBLESHOOTING (using i18n data)
  // ================================
  function solveTrouble() {
    const troubleData = i18n.troubleData;
    const value = document.getElementById('troubleSelect').value;
    const box = document.getElementById('solutionBox');
    const placeholder = document.getElementById('solutionPlaceholder');

    if (!value || !troubleData[value]) {
      box.classList.add('hidden');
      placeholder.style.display = 'block';
      return;
    }

    const data = troubleData[value];
    document.getElementById('solTitle').textContent = data.title;
    document.getElementById('solDesc').textContent = data.desc;
    document.getElementById('solTip').textContent = data.tip;

    const settingsHtml = data.settings.map(s =>
      `<div class="solution-setting">
        <span class="setting-name">${s.name}</span>
        <span class="setting-value">${s.value}</span>
      </div>`
    ).join('');
    document.getElementById('solSettings').innerHTML = settingsHtml;

    box.classList.remove('hidden');
    placeholder.style.display = 'none';
  }

  // ================================
  // EVENT LISTENERS
  // ================================
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize i18n
    i18n = getI18n();

    // Speed slider
    document.getElementById('speedInput').addEventListener('input', function() {
      currentSpeed = parseInt(this.value);
      document.getElementById('speedDisplay').textContent = currentSpeed + ' mm/s';
      updateQualityMetrics();
    });

    // Layer height slider
    document.getElementById('layerInput').addEventListener('input', function() {
      currentLayerHeight = parseFloat(this.value);
      document.getElementById('layerDisplay').textContent = currentLayerHeight.toFixed(2) + ' mm';
      updateQualityMetrics();
    });

    // Z-offset slider
    document.getElementById('zOffsetInput').addEventListener('input', function() {
      zOffset = parseFloat(this.value);
      const sign = zOffset > 0 ? '+' : '';
      document.getElementById('zOffsetDisplay').textContent = i18n.offset + ': ' + sign + zOffset.toFixed(2) + 'mm';
      drawLayerSim();
    });

    // Infill slider
    document.getElementById('infillInput').addEventListener('input', function() {
      currentInfill = parseInt(this.value);
      document.getElementById('infillDisplay').textContent = currentInfill + '%';
      updateStrengthMetrics();
    });

    // Fan slider
    document.getElementById('fanInput').addEventListener('input', updateFanPhysics);

    // Window resize
    window.addEventListener('resize', function() {
      drawLayerSim();
      drawStrengthPattern();
    });

    // Initial setup
    setNozzle(0.4);
    setWalls(3);
    updateQualityMetrics();
    updateStrengthMetrics();
    updateFanPhysics();
    initTempChart();

    setTimeout(() => {
      drawLayerSim();
      drawStrengthPattern();
    }, 100);
  });
</script>

<style>
  .header-spacer {
    height: 100px;
  }

  .cura-page {
    padding-top: 40px;
    padding-bottom: 60px;
    min-height: 100vh;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
  }

  /* Breadcrumb */
  .breadcrumb {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.875rem;
    color: var(--text-muted);
    margin-bottom: 24px;
  }

  .breadcrumb a {
    color: var(--text-muted);
    text-decoration: none;
    transition: color 0.2s;
  }

  .breadcrumb a:hover {
    color: var(--accent);
  }

  .breadcrumb span {
    color: var(--text-light);
  }

  /* Header */
  .page-header {
    text-align: center;
    margin-bottom: 32px;
  }

  .version-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 14px;
    background: rgba(37, 99, 235, 0.1);
    color: var(--accent);
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: 100px;
    margin-bottom: 16px;
    border: 1px solid rgba(37, 99, 235, 0.2);
  }

  .page-title {
    font-size: clamp(2rem, 5vw, 3rem);
    font-weight: 800;
    margin-bottom: 12px;
    letter-spacing: -0.02em;
    color: var(--text-main);
  }

  .page-title span {
    background: linear-gradient(135deg, #F97316, #EAB308);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .page-desc {
    color: var(--text-muted);
    font-size: 1rem;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* Navigation Tabs */
  .nav-tabs {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    margin-bottom: 32px;
  }

  .nav-tab {
    padding: 14px 24px;
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 16px;
    color: var(--text-muted);
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    flex: 1;
    min-width: 140px;
    max-width: 220px;
    text-align: center;
  }

  .nav-tab:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  .nav-tab.active {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
  }

  /* Main Card */
  .main-card {
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 24px;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    min-height: 600px;
  }

  .tab-content {
    padding: 32px;
    animation: fadeIn 0.4s ease;
  }

  .tab-content.hidden {
    display: none;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Section Grid */
  .section-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 32px;
  }

  @media (max-width: 900px) {
    .section-grid {
      grid-template-columns: 1fr;
    }
  }

  .section-title {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--text-main);
  }

  .section-title .icon {
    font-size: 1.5rem;
  }

  .section-desc {
    color: var(--text-muted);
    font-size: 0.9rem;
    margin-bottom: 24px;
    line-height: 1.6;
  }

  /* Control Panels */
  .control-panel {
    background: var(--bg-main);
    border: 1px solid var(--border-soft);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 16px;
  }

  .control-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }

  .label-text {
    font-size: 0.8rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
  }

  .control-value {
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--accent);
    background: rgba(37, 99, 235, 0.1);
    padding: 4px 12px;
    border-radius: 8px;
    font-family: 'JetBrains Mono', monospace;
  }

  .control-note {
    font-size: 0.75rem;
    color: var(--text-light);
    text-align: center;
    margin-top: 8px;
  }

  /* Range Sliders */
  input[type="range"] {
    -webkit-appearance: none;
    width: 100%;
    height: 6px;
    background: var(--border-soft);
    border-radius: 3px;
    outline: none;
    cursor: pointer;
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    background: var(--accent);
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(37, 99, 235, 0.4);
    transition: transform 0.15s;
  }

  input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.15);
  }

  .range-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.7rem;
    color: var(--text-light);
    margin-top: 8px;
    font-family: 'JetBrains Mono', monospace;
  }

  /* Button Groups */
  .btn-group {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
  }

  .btn-option {
    padding: 12px 8px;
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 10px;
    color: var(--text-muted);
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s;
  }

  .btn-option:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  .btn-option.active {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
  }

  /* Visualizer Panel */
  .visualizer-panel {
    background: var(--bg-main);
    border: 1px solid var(--border-soft);
    border-radius: 12px;
    overflow: hidden;
    height: 100%;
    min-height: 400px;
    display: flex;
    flex-direction: column;
  }

  .visualizer-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border-soft);
    background: var(--bg-card);
  }

  .visualizer-title {
    font-size: 0.85rem;
    font-weight: 700;
    color: var(--text-main);
  }

  .visualizer-badge {
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    padding: 4px 10px;
    border-radius: 6px;
    background: rgba(37, 99, 235, 0.1);
    color: var(--accent);
  }

  .visualizer-badge.success {
    background: rgba(16, 185, 129, 0.15);
    color: #10B981;
  }

  .visualizer-badge.warning {
    background: rgba(249, 115, 22, 0.15);
    color: #F97316;
  }

  .visualizer-body {
    flex: 1;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .visualizer-body canvas {
    max-width: 100%;
    max-height: 100%;
  }

  /* Z-Offset Control */
  .z-offset-control {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 12px;
    padding: 16px 24px;
    box-shadow: var(--shadow-md);
    min-width: 280px;
  }

  .z-offset-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.7rem;
    color: var(--text-light);
    margin-bottom: 8px;
  }

  .z-offset-value {
    text-align: center;
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--accent);
    margin-top: 8px;
  }

  /* Metrics Grid */
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-top: 16px;
  }

  .metric-card {
    background: var(--bg-main);
    border: 1px solid var(--border-soft);
    border-radius: 12px;
    padding: 16px;
  }

  .metric-label {
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-light);
    margin-bottom: 4px;
  }

  .metric-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-main);
  }

  .metric-value.success { color: #10B981; }
  .metric-value.warning { color: #F59E0B; }
  .metric-value.error { color: #EF4444; }

  /* Flow Bar */
  .flow-bar-container {
    margin-top: 12px;
  }

  .flow-bar-bg {
    width: 100%;
    height: 8px;
    background: var(--border-soft);
    border-radius: 4px;
    overflow: hidden;
  }

  .flow-bar {
    height: 100%;
    background: #10B981;
    border-radius: 4px;
    transition: width 0.3s ease, background 0.3s ease;
  }

  .flow-bar.warning { background: #F59E0B; }
  .flow-bar.danger { background: #EF4444; }

  .flow-status {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin-top: 8px;
    line-height: 1.5;
  }

  .flow-status .error { color: #EF4444; font-weight: 600; }
  .flow-status .warn { color: #F59E0B; font-weight: 600; }

  /* Tips Grid */
  .tips-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-top: 32px;
    padding-top: 24px;
    border-top: 1px solid var(--border-soft);
  }

  @media (max-width: 768px) {
    .tips-grid {
      grid-template-columns: 1fr;
    }
  }

  .tip-card {
    background: var(--bg-main);
    border: 1px solid var(--border-soft);
    border-radius: 12px;
    padding: 16px;
  }

  .tip-card h4 {
    font-size: 0.9rem;
    font-weight: 700;
    margin-bottom: 6px;
    color: var(--text-main);
  }

  .tip-card p {
    font-size: 0.8rem;
    color: var(--text-muted);
    line-height: 1.5;
    margin: 0;
  }

  /* Chart */
  .chart-panel {
    min-height: 280px;
  }

  .chart-container {
    position: relative;
    width: 100%;
    height: 250px;
  }

  /* Select Dropdown */
  .select-wrapper {
    position: relative;
  }

  .select-dropdown {
    width: 100%;
    padding: 14px 16px;
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 12px;
    color: var(--text-main);
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    outline: none;
    transition: border-color 0.15s;
    -webkit-appearance: none;
    appearance: none;
  }

  .select-dropdown:focus {
    border-color: var(--accent);
  }

  .select-wrapper::after {
    content: '';
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 5px solid var(--text-muted);
    pointer-events: none;
  }

  /* Solution Box */
  .solution-box {
    background: var(--bg-main);
    border: 1px solid var(--border-soft);
    border-radius: 12px;
    padding: 24px;
    margin-top: 16px;
  }

  .solution-box.hidden {
    display: none;
  }

  .solution-title {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 8px;
    color: var(--text-main);
  }

  .solution-desc {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-bottom: 16px;
    line-height: 1.6;
  }

  .solution-settings {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 16px;
  }

  .solution-setting {
    display: flex;
    justify-content: space-between;
    padding: 12px 16px;
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 10px;
  }

  .setting-name {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-muted);
  }

  .setting-value {
    font-size: 0.85rem;
    font-weight: 700;
    color: var(--accent);
    font-family: 'JetBrains Mono', monospace;
  }

  .solution-tip {
    padding: 12px 16px;
    background: rgba(249, 115, 22, 0.1);
    border: 1px solid rgba(249, 115, 22, 0.2);
    border-radius: 10px;
    font-size: 0.85rem;
    color: #F97316;
    line-height: 1.5;
  }

  .solution-placeholder {
    text-align: center;
    padding: 48px;
    color: var(--text-light);
    font-size: 0.9rem;
    background: var(--bg-main);
    border: 1px solid var(--border-soft);
    border-radius: 12px;
    margin-top: 16px;
  }

  /* Fan Physics Box */
  .fan-physics-box {
    background: rgba(37, 99, 235, 0.1);
    border: 1px solid rgba(37, 99, 235, 0.2);
    border-radius: 12px;
    padding: 20px;
  }

  .fan-physics-text {
    font-size: 0.85rem;
    color: var(--accent);
    font-style: italic;
    margin-top: 12px;
    line-height: 1.5;
  }

  /* Footer */
  .page-footer {
    text-align: center;
    margin-top: 40px;
    padding-top: 24px;
    border-top: 1px solid var(--border-soft);
  }

  .page-footer p {
    color: var(--text-light);
    font-size: 0.85rem;
    margin-bottom: 12px;
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: var(--accent);
    font-weight: 600;
    text-decoration: none;
    transition: color 0.15s;
  }

  .back-link:hover {
    color: var(--accent-hover);
  }

  /* Responsive */
  @media (max-width: 640px) {
    .cura-page {
      padding-top: 130px;
    }

    .tab-content {
      padding: 20px;
    }

    .nav-tab {
      padding: 12px 16px;
      font-size: 0.8rem;
      min-width: 100px;
    }

    .btn-group {
      grid-template-columns: repeat(2, 1fr);
    }

    .metrics-grid {
      grid-template-columns: 1fr;
    }

    .z-offset-control {
      min-width: 240px;
      padding: 12px 16px;
    }
  }
</style>
