---
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/Header.astro";
import { getApiBase } from "../lib/api";

export const prerender = false;

type Post = {
  id: number;
  title_tr: string;
  summary_tr: string;
  slug: string;
  category: string;
  image_url?: string;
  is_featured: number;
};

type CommunityProject = {
  id: number;
  title: string;
  slug: string;
  content: string;
  view_count: number;
  reply_count: number;
  like_count: number;
  created_at: string;
  username: string;
  display_name: string;
  avatar_url?: string;
  category_name: string;
  category_slug: string;
  category_icon: string;
  featured_type: 'admin' | 'auto';
};

const API_BASE = getApiBase(Astro.request);

let data: Record<string, Post[]> = {};
let communityProjects: CommunityProject[] = [];
let error: string | null = null;

try {
  const [homeRes, communityRes] = await Promise.all([
    fetch(`${API_BASE}/api/home`, { headers: { "Accept": "application/json" } }),
    fetch(`${API_BASE}/api/community/featured?limit=4`, { headers: { "Accept": "application/json" } })
  ]);

  if (!homeRes.ok) {
    throw new Error(`API hatasƒ±: ${homeRes.status}`);
  }

  data = await homeRes.json();

  if (communityRes.ok) {
    const communityData = await communityRes.json();
    communityProjects = communityData.projects || [];
  }
} catch (e) {
  error = e instanceof Error ? e.message : "Bilinmeyen hata";
  console.error("Ana sayfa hatasƒ±:", error);
}

const printPosts = data["3d-baski"] || [];
const rehberPosts = data["rehberler"] || [];
const incelemePosts = data["incelemeler"] || [];
const sorunPosts = data["sorun-cozumleri"] || [];

// Hero slider i√ßin 3D Baskƒ±, Rehberler, Sorun √á√∂z√ºmleri ve Topluluk Projesi
const communityHeroSlide = communityProjects[0] ? {
  id: communityProjects[0].id,
  title_tr: communityProjects[0].title,
  summary_tr: getExcerpt(communityProjects[0].content, 150),
  slug: communityProjects[0].slug,
  category: 'topluluk-projesi',
  image_url: null, // Topluluk projelerinde g√∂rsel yok, gradient kullanacaƒüƒ±z
  is_featured: 1,
  username: communityProjects[0].username,
  display_name: communityProjects[0].display_name
} : null;

const heroSlides = [
  printPosts[0],        // 3D Baskƒ±
  rehberPosts[0],       // Rehberler
  communityHeroSlide,   // Topluluk Projesi
  sorunPosts[0],        // Sorun √á√∂z√ºmleri
].filter(Boolean);

function getCategoryLabel(cat: string) {
  if (cat === "3d-baski") return "3D Baskƒ±";
  if (cat === "rehberler") return "Rehber";
  if (cat === "incelemeler") return "ƒ∞nceleme";
  if (cat === "sorun-cozumleri") return "Sorun √á√∂z√ºm√º";
  if (cat === "topluluk-projesi") return "Topluluk Projesi";
  return "3D Baskƒ±";
}

function getCategoryColor(cat: string) {
  if (cat === "3d-baski") return "orange";
  if (cat === "rehberler") return "cyan";
  if (cat === "incelemeler") return "purple";
  if (cat === "sorun-cozumleri") return "green";
  if (cat === "topluluk-projesi") return "pink";
  return "orange";
}

function getExcerpt(content: string, length: number = 120): string {
  return content.replace(/[#*|\[\]`\n]/g, ' ').replace(/\s+/g, ' ').trim().substring(0, length) + '...';
}
---

<BaseLayout
  title="3D-LABX - T√ºrkiye'nin 3D Baskƒ± Rehberi | Yazƒ±cƒ± Ayarlarƒ±, Sorun √á√∂z√ºmleri"
  description="3D yazƒ±cƒ± ayarlarƒ±, filament rehberleri, sorun √ß√∂z√ºmleri ve √ºr√ºn incelemeleri. T√ºrkiye'nin en kapsamlƒ± 3D baskƒ± kaynaƒüƒ±."
>
  <Header />

  <!-- HERO SLIDER SECTION -->
  <section class="hero-section">
    <div class="container">
      <div class="hero-slider-box">
        <div class="slider-container">
          {heroSlides.map((slide, index) => (
            <div class={`slide ${index === 0 ? 'active' : ''} ${slide.category === 'topluluk-projesi' ? 'community-slide' : ''}`} data-index={index}>
              <div class="slide-bg">
                {slide.image_url ? (
                  <img src={slide.image_url} alt={slide.title_tr} />
                ) : slide.category === 'topluluk-projesi' ? (
                  <div class="community-gradient"></div>
                ) : null}
                <div class="slide-overlay"></div>
              </div>
              <div class="slide-content">
                <div class={`hero-badge ${getCategoryColor(slide.category)}`}>
                  <span class="pulse-dot"></span>
                  <span>{getCategoryLabel(slide.category)}</span>
                  {slide.category === 'topluluk-projesi' && slide.username && (
                    <span class="hero-author">@{slide.username}</span>
                  )}
                </div>
                <h1>{slide.title_tr}</h1>
                <p>{slide.summary_tr}</p>
                <a href={slide.category === 'topluluk-projesi' ? `/topluluk/forum/konu/${slide.slug}` : `/${slide.category}/${slide.slug}`} class="hero-btn">
                  {slide.category === 'topluluk-projesi' ? 'Projeyi G√∂r' : 'Devamƒ±nƒ± Oku'}
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
                </a>
              </div>
            </div>
          ))}

          <!-- Slider Navigation Dots -->
          <div class="slider-dots">
            {heroSlides.map((slide, index) => (
              <button
                class={`dot ${index === 0 ? 'active' : ''} ${getCategoryColor(slide.category)}`}
                data-index={index}
                aria-label={getCategoryLabel(slide.category)}
              >
                <span class="dot-label">{getCategoryLabel(slide.category)}</span>
              </button>
            ))}
          </div>

          <!-- Progress Bar -->
          <div class="slider-progress">
            <div class="progress-bar"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <main class="main-content container">
    {error && (
      <div class="message message-error">
        <p>ƒ∞√ßerikler y√ºklenirken bir hata olu≈ütu: {error}</p>
      </div>
    )}

    <!-- BENTO GRID - 3D Baskƒ± Odaklƒ± -->
    <section class="bento-grid">
      <!-- Rehberler - B√ºy√ºk Kart -->
      <a href="/rehberler" class="bento-card bento-large cyan">
        <div class="bento-glow"></div>
        <div class="bento-content">
          <div class="bento-header">
            <div class="bento-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/><path d="m9 9.5 2 2 4-4"/></svg>
            </div>
            <span class="bento-tag">Adƒ±m Adƒ±m Rehberler</span>
          </div>
          <h3>3D Yazƒ±cƒ± Kurulum & Ayar Rehberleri</h3>
          <p>Klipper kurulumu, slicer ayarlarƒ±, kalibrasyon rehberleri. Ba≈ülangƒ±√ßtan ileri seviyeye t√ºm bilgiler.</p>
        </div>
      </a>

      <!-- Sorun √á√∂z√ºmleri -->
      <a href="/sorun-cozumleri" class="bento-card green">
        <div class="bento-content">
          <div class="bento-header">
            <div class="bento-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
            </div>
            <span class="bento-tag">Sorun Giderme</span>
          </div>
          <h3>Stringing, Warping, Tƒ±kanma...</h3>
          <p>3D baskƒ± sorunlarƒ± ve √ß√∂z√ºmleri. Adƒ±m adƒ±m sorun giderme kƒ±lavuzlarƒ±.</p>
        </div>
      </a>

      <!-- ƒ∞ncelemeler -->
      <a href="/incelemeler" class="bento-card purple">
        <div class="bento-content">
          <div class="bento-header">
            <div class="bento-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
            </div>
            <span class="bento-tag">√úr√ºn ƒ∞ncelemeleri</span>
          </div>
          <h3>Yazƒ±cƒ± & Filament ƒ∞ncelemeleri</h3>
          <p>Detaylƒ± test sonu√ßlarƒ±, kar≈üƒ±la≈ütƒ±rmalar ve satƒ±n alma tavsiyeleri.</p>
        </div>
      </a>

      <!-- Filament Fiyatlarƒ± - Rehberler'e Y√∂nlendir -->
      <a href="/rehberler" class="bento-card filament-promo">
        <div class="bento-glow"></div>
        <div class="bento-content">
          <div class="bento-header">
            <div class="bento-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
            </div>
            <span class="bento-tag">G√ºncel Fiyatlar</span>
          </div>
          <h3>Filament & Re√ßine Fiyatlarƒ±</h3>
          <p>T√ºrkiye'nin en g√ºncel 3D baskƒ± malzeme fiyatlarƒ±. Markalarƒ± kar≈üƒ±la≈ütƒ±r, en uygun fiyatƒ± bul.</p>
          <div class="filament-promo-footer">
            <span class="promo-cta">Fiyatlarƒ± G√∂r ‚Üí</span>
          </div>
        </div>
      </a>

    </section>

    <!-- ANKETLER B√ñL√úM√ú -->
    <section class="polls-section">
      <div class="category-header">
        <div class="category-title-group">
          <span class="category-icon poll-icon">üìä</span>
          <h2>Anketler</h2>
        </div>
        <span class="poll-subtitle">Topluluƒüun tercihleri</span>
      </div>

      <div class="polls-grid">
        <!-- Anket 1: API Anketi -->
        <div class="poll-card poll-gradient-1" id="pollCard">
          <div class="poll-card-header">
            <div class="poll-badge">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>
              Aktif Anket
            </div>
          </div>
          <h3 id="pollQuestion">En √ßok kullandƒ±ƒüƒ±nƒ±z 3D yazƒ±cƒ± markasƒ±?</h3>
          <div class="poll-options" id="pollOptions">
            <div class="poll-option clickable" data-option-id="1" data-poll-id="4">
              <div class="poll-bar" style="width: 35%; background: linear-gradient(90deg, #EAB308 0%, #EAB308cc 100%);"></div>
              <span class="poll-label">Creality</span>
              <span class="poll-percent">%35</span>
            </div>
            <div class="poll-option clickable" data-option-id="2" data-poll-id="4">
              <div class="poll-bar" style="width: 25%; background: linear-gradient(90deg, #3B82F6 0%, #3B82F6cc 100%);"></div>
              <span class="poll-label">Prusa</span>
              <span class="poll-percent">%25</span>
            </div>
            <div class="poll-option clickable" data-option-id="3" data-poll-id="4">
              <div class="poll-bar" style="width: 22%; background: linear-gradient(90deg, #8B5CF6 0%, #8B5CF6cc 100%);"></div>
              <span class="poll-label">Bambu Lab</span>
              <span class="poll-percent">%22</span>
            </div>
            <div class="poll-option clickable" data-option-id="4" data-poll-id="4">
              <div class="poll-bar" style="width: 12%; background: linear-gradient(90deg, #10B981 0%, #10B981cc 100%);"></div>
              <span class="poll-label">Anycubic</span>
              <span class="poll-percent">%12</span>
            </div>
            <div class="poll-option clickable" data-option-id="5" data-poll-id="4">
              <div class="poll-bar" style="width: 8%; background: linear-gradient(90deg, #06B6D4 0%, #06B6D4cc 100%);"></div>
              <span class="poll-label">Diƒüer</span>
              <span class="poll-percent">%6</span>
            </div>
          </div>
          <div class="poll-footer">
            <span class="poll-votes" id="pollVotes">127 Oy</span>
          </div>
        </div>

        <!-- Anket 2: Slicer Anketi -->
        <div class="poll-card poll-gradient-2" id="slicerPollCard">
          <div class="poll-card-header">
            <div class="poll-badge cyan">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
              Slicer Anketi
            </div>
          </div>
          <h3>Hangi Slicer Kullanƒ±yorsunuz?</h3>
          <div class="poll-options" id="slicerOptions">
            <div class="poll-option clickable" data-slicer-id="1">
              <div class="poll-bar" style="width: 33%; background: linear-gradient(90deg, #22C55E 0%, #22C55Edd 100%);"></div>
              <span class="poll-label">Cura</span>
              <span class="poll-percent">%33</span>
            </div>
            <div class="poll-option clickable" data-slicer-id="2">
              <div class="poll-bar" style="width: 27%; background: linear-gradient(90deg, #F97316 0%, #F97316dd 100%);"></div>
              <span class="poll-label">PrusaSlicer</span>
              <span class="poll-percent">%27</span>
            </div>
            <div class="poll-option clickable" data-slicer-id="3">
              <div class="poll-bar" style="width: 22%; background: linear-gradient(90deg, #8B5CF6 0%, #8B5CF6dd 100%);"></div>
              <span class="poll-label">OrcaSlicer</span>
              <span class="poll-percent">%22</span>
            </div>
            <div class="poll-option clickable" data-slicer-id="4">
              <div class="poll-bar" style="width: 13%; background: linear-gradient(90deg, #06B6D4 0%, #06B6D4dd 100%);"></div>
              <span class="poll-label">Bambu Studio</span>
              <span class="poll-percent">%13</span>
            </div>
            <div class="poll-option clickable" data-slicer-id="5">
              <div class="poll-bar" style="width: 8%; background: linear-gradient(90deg, #6B7280 0%, #6B7280dd 100%);"></div>
              <span class="poll-label">Diƒüer</span>
              <span class="poll-percent">%5</span>
            </div>
          </div>
          <div class="poll-footer">
            <span class="poll-votes" id="slicerVotes">700 Oy</span>
          </div>
        </div>
      </div>
    </section>

    <!-- TOPLULUK Vƒ∞TRƒ∞N B√ñL√úM√ú -->
    {communityProjects.length > 0 && (
      <section class="community-showcase">
        <div class="category-header">
          <div class="category-title-group">
            <span class="category-icon showcase-icon">üèÜ</span>
            <h2>Topluluk Vitrini</h2>
          </div>
          <a href="/topluluk/forum/projeler" class="category-link">T√ºm Projeler ‚Üí</a>
        </div>

        <div class="showcase-grid">
          {communityProjects.map((project, index) => (
            <a href={`/topluluk/forum/konu/${project.slug}`} class={`showcase-card ${index === 0 ? 'showcase-featured' : ''}`}>
              <div class="showcase-header">
                <div class="showcase-user">
                  <div class="showcase-avatar">
                    {project.avatar_url ? (
                      <img src={project.avatar_url} alt={project.display_name || project.username} />
                    ) : (
                      <span>{(project.display_name || project.username).charAt(0).toUpperCase()}</span>
                    )}
                  </div>
                  <div class="showcase-user-info">
                    <span class="showcase-username">@{project.username}</span>
                    <span class="showcase-date">{new Date(project.created_at).toLocaleDateString('tr-TR')}</span>
                  </div>
                </div>
                {project.featured_type === 'admin' && (
                  <span class="showcase-badge">‚≠ê Edit√∂r Se√ßimi</span>
                )}
              </div>

              <h3 class="showcase-title">{project.title}</h3>

              <p class="showcase-excerpt">
                {getExcerpt(project.content)}
              </p>

              <div class="showcase-footer">
                <div class="showcase-stats">
                  <span class="stat">üëÅÔ∏è {project.view_count}</span>
                  <span class="stat">üí¨ {project.reply_count}</span>
                  <span class="stat">‚ù§Ô∏è {project.like_count}</span>
                </div>
                <span class="showcase-category">{project.category_icon} {project.category_name}</span>
              </div>
            </a>
          ))}
        </div>

        <div class="showcase-cta">
          <a href="/topluluk/forum/projeler" class="showcase-cta-btn">
            <span>üé®</span>
            <span>Projeni Payla≈ü</span>
          </a>
        </div>
      </section>
    )}

    <!-- KATEGORƒ∞LERE G√ñRE ƒ∞√áERƒ∞KLER -->

    <!-- 3D Baskƒ± Haberleri -->
    {printPosts.length > 1 && (
      <section class="category-section">
        <div class="category-header">
          <div class="category-title-group">
            <span class="category-icon orange">üì∞</span>
            <h2>3D Baskƒ± Haberleri</h2>
          </div>
          <a href="/3d-baski" class="category-link">T√ºm√ºn√º G√∂r ‚Üí</a>
        </div>
        <div class="category-grid">
          {printPosts.slice(1, 5).map((post, i) => (
            <a href={`/${post.category}/${post.slug}`} class={`cat-card ${i === 0 ? 'cat-featured' : ''} orange`}>
              {post.image_url && (
                <div class="cat-image">
                  <img src={post.image_url} alt={post.title_tr} loading="lazy" />
                </div>
              )}
              <div class="cat-content">
                <h3>{post.title_tr}</h3>
                <p>{post.summary_tr}</p>
              </div>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- Rehberler -->
    {rehberPosts.length > 0 && (
      <section class="category-section">
        <div class="category-header">
          <div class="category-title-group">
            <span class="category-icon cyan">üìò</span>
            <h2>Rehberler</h2>
          </div>
          <a href="/rehberler" class="category-link">T√ºm√ºn√º G√∂r ‚Üí</a>
        </div>
        <div class="category-grid">
          {rehberPosts.slice(0, 4).map((post, i) => (
            <a href={`/${post.category}/${post.slug}`} class={`cat-card ${i === 0 ? 'cat-featured' : ''} cyan`}>
              {post.image_url && (
                <div class="cat-image">
                  <img src={post.image_url} alt={post.title_tr} loading="lazy" />
                </div>
              )}
              <div class="cat-content">
                <h3>{post.title_tr}</h3>
                <p>{post.summary_tr}</p>
              </div>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- ƒ∞ncelemeler -->
    {incelemePosts.length > 0 && (
      <section class="category-section">
        <div class="category-header">
          <div class="category-title-group">
            <span class="category-icon purple">‚≠ê</span>
            <h2>ƒ∞ncelemeler</h2>
          </div>
          <a href="/incelemeler" class="category-link">T√ºm√ºn√º G√∂r ‚Üí</a>
        </div>
        <div class="category-grid">
          {incelemePosts.slice(0, 4).map((post, i) => (
            <a href={`/${post.category}/${post.slug}`} class={`cat-card ${i === 0 ? 'cat-featured' : ''} purple`}>
              {post.image_url && (
                <div class="cat-image">
                  <img src={post.image_url} alt={post.title_tr} loading="lazy" />
                </div>
              )}
              <div class="cat-content">
                <h3>{post.title_tr}</h3>
                <p>{post.summary_tr}</p>
              </div>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- Sorun √á√∂z√ºmleri -->
    {sorunPosts.length > 0 && (
      <section class="category-section">
        <div class="category-header">
          <div class="category-title-group">
            <span class="category-icon green">üîß</span>
            <h2>Sorun √á√∂z√ºmleri</h2>
          </div>
          <a href="/sorun-cozumleri" class="category-link">T√ºm√ºn√º G√∂r ‚Üí</a>
        </div>
        <div class="category-grid">
          {sorunPosts.slice(0, 4).map((post, i) => (
            <a href={`/${post.category}/${post.slug}`} class={`cat-card ${i === 0 ? 'cat-featured' : ''} green`}>
              {post.image_url && (
                <div class="cat-image">
                  <img src={post.image_url} alt={post.title_tr} loading="lazy" />
                </div>
              )}
              <div class="cat-content">
                <h3>{post.title_tr}</h3>
                <p>{post.summary_tr}</p>
              </div>
            </a>
          ))}
        </div>
      </section>
    )}
  </main>
</BaseLayout>

<style>
  /* HERO SECTION */
  .hero-section {
    padding: 130px 20px 30px;
  }

  .container { max-width: 1200px; margin: 0 auto; }

  /* HERO SLIDER BOX */
  .hero-slider-box {
    position: relative;
    height: 380px;
    border-radius: 20px;
    overflow: hidden;
    border: 1px solid var(--border-soft);
  }

  .slider-container {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  .slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
  }

  .slide.active {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    clip: auto;
    animation: fadeIn 0.6s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .slide-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .slide-bg img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Topluluk projesi i√ßin gradient arka plan */
  .community-gradient {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg,
      #1a1a2e 0%,
      #16213e 25%,
      #0f3460 50%,
      #1a1a2e 75%,
      #16213e 100%);
    position: relative;
  }

  .community-gradient::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background:
      radial-gradient(circle at 20% 30%, rgba(236, 72, 153, 0.15) 0%, transparent 50%),
      radial-gradient(circle at 80% 70%, rgba(168, 85, 247, 0.15) 0%, transparent 50%),
      radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 60%);
  }

  .community-gradient::after {
    content: 'üèÜ';
    position: absolute;
    top: 50%;
    right: 15%;
    transform: translateY(-50%);
    font-size: 8rem;
    opacity: 0.08;
  }

  .slide.community-slide .slide-overlay {
    background: linear-gradient(90deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.1) 100%);
  }

  .slide-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.6) 40%, rgba(0,0,0,0.4) 100%);
  }

  .slide-content {
    position: relative;
    z-index: 2;
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 30px 40px;
    max-width: 100%;
  }

  .hero-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    color: white;
    margin-bottom: 16px;
    width: fit-content;
  }

  .hero-badge.orange { border-color: rgba(249, 115, 22, 0.5); }
  .hero-badge.cyan { border-color: rgba(6, 182, 212, 0.5); }
  .hero-badge.purple { border-color: rgba(168, 85, 247, 0.5); }
  .hero-badge.green { border-color: rgba(34, 197, 94, 0.5); }
  .hero-badge.pink { border-color: rgba(236, 72, 153, 0.5); }

  .hero-author {
    margin-left: 4px;
    padding-left: 8px;
    border-left: 1px solid rgba(255,255,255,0.3);
    font-weight: 500;
    opacity: 0.9;
  }

  .pulse-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    animation: pulse 2s infinite;
  }

  .hero-badge.orange .pulse-dot { background: #F97316; }
  .hero-badge.cyan .pulse-dot { background: #06B6D4; }
  .hero-badge.purple .pulse-dot { background: #A855F7; }
  .hero-badge.green .pulse-dot { background: #22C55E; }
  .hero-badge.pink .pulse-dot { background: #EC4899; }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .slide-content h1 {
    font-size: 1.6rem;
    font-weight: 700;
    line-height: 1.2;
    margin-bottom: 12px;
    color: white;
    text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 90%;
  }

  .slide-content p {
    font-size: 0.9rem;
    color: rgba(255,255,255,0.85);
    line-height: 1.4;
    margin-bottom: 20px;
    max-width: 700px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: center;
  }

  .hero-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 10px 20px;
    background: var(--accent);
    color: white;
    border-radius: 10px;
    font-weight: 600;
    font-size: 0.9rem;
    text-decoration: none;
    transition: all 0.3s;
    width: fit-content;
  }

  .hero-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
  }

  /* Slider Dots */
  .slider-dots {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    z-index: 10;
  }

  .dot {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .dot:hover {
    background: rgba(255,255,255,0.2);
  }

  .dot.active {
    background: rgba(255,255,255,0.25);
  }

  .dot.active.orange { border-color: #F97316; box-shadow: 0 0 10px rgba(249, 115, 22, 0.4); }
  .dot.active.cyan { border-color: #06B6D4; box-shadow: 0 0 10px rgba(6, 182, 212, 0.4); }
  .dot.active.purple { border-color: #A855F7; box-shadow: 0 0 10px rgba(168, 85, 247, 0.4); }
  .dot.active.green { border-color: #22C55E; box-shadow: 0 0 10px rgba(34, 197, 94, 0.4); }
  .dot.active.pink { border-color: #EC4899; box-shadow: 0 0 10px rgba(236, 72, 153, 0.4); }

  .dot-label {
    font-size: 0.65rem;
    font-weight: 600;
    color: white;
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }

  /* Progress Bar */
  .slider-progress {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: rgba(255,255,255,0.1);
  }

  .progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #F97316, #06B6D4, #A855F7);
    transition: width 0.1s linear;
  }

  @media (max-width: 768px) {
    .hero-section {
      padding: 100px 12px 20px;
    }

    .hero-slider-box {
      height: 260px;
      border-radius: 12px;
      overflow: hidden;
    }

    .slider-container {
      overflow: hidden;
    }

    .slide {
      overflow: hidden;
      display: none;
    }

    .slide.active {
      display: block;
    }

    .slide-content {
      padding: 16px 20px;
      max-width: 100%;
      align-items: center;
      text-align: center;
    }

    .slide-content h1 {
      font-size: 0.95rem;
      line-height: 1.3;
      margin-bottom: 8px;
      white-space: nowrap;
      max-width: 95%;
    }

    .slide-content p {
      font-size: 0.7rem;
      margin-bottom: 12px;
      line-height: 1.4;
      text-align: center;
      white-space: nowrap;
      max-width: 95%;
    }

    .hero-badge {
      padding: 4px 10px;
      font-size: 0.65rem;
      margin-bottom: 10px;
    }

    .hero-btn {
      padding: 8px 16px;
      font-size: 0.8rem;
    }

    .slider-dots {
      flex-wrap: wrap;
      justify-content: center;
      padding: 0 10px;
      gap: 4px;
      bottom: 12px;
    }

    .dot {
      padding: 4px 8px;
    }

    .dot-label {
      font-size: 0.55rem;
    }
  }

  .main-content { padding-bottom: 40px; }

  /* BENTO GRID */
  .bento-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-bottom: 40px;
  }

  @media (max-width: 1024px) { .bento-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 768px) {
    .bento-grid {
      grid-template-columns: 1fr;
      gap: 12px;
    }
  }

  .bento-card {
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 20px;
    padding: 24px;
    text-decoration: none;
    color: inherit;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
    min-height: 200px;
  }

  .bento-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(0,0,0,0.15);
  }

  .bento-large { grid-column: span 2; }

  .bento-glow {
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    opacity: 0.5;
    pointer-events: none;
  }

  .bento-card.orange .bento-glow { background: radial-gradient(circle, rgba(249, 115, 22, 0.1) 0%, transparent 70%); }

  .bento-content { position: relative; z-index: 1; flex: 1; display: flex; flex-direction: column; }

  .bento-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }

  .bento-icon {
    width: 48px;
    height: 48px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .bento-card.orange .bento-icon { background: rgba(249, 115, 22, 0.1); color: #F97316; }
  .bento-card.cyan .bento-icon { background: rgba(6, 182, 212, 0.1); color: #06B6D4; }
  .bento-card.purple .bento-icon { background: rgba(168, 85, 247, 0.1); color: #A855F7; }

  .bento-card.orange:hover { border-color: rgba(249, 115, 22, 0.5); }
  .bento-card.cyan:hover { border-color: rgba(6, 182, 212, 0.5); }
  .bento-card.purple:hover { border-color: rgba(168, 85, 247, 0.5); }

  .bento-tag {
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 4px 10px;
    border-radius: 6px;
    background: var(--border-soft);
    color: var(--text-muted);
  }

  .bento-card.orange .bento-tag { background: rgba(249, 115, 22, 0.1); color: #F97316; }
  .bento-card.cyan .bento-tag { background: rgba(6, 182, 212, 0.1); color: #06B6D4; }
  .bento-card.purple .bento-tag { background: rgba(168, 85, 247, 0.1); color: #A855F7; }
  .bento-card.green .bento-tag { background: rgba(34, 197, 94, 0.1); color: #22C55E; }
  .bento-card.green .bento-icon { background: rgba(34, 197, 94, 0.1); color: #22C55E; }
  .bento-card.green:hover { border-color: rgba(34, 197, 94, 0.5); }
  .bento-card.green .bento-glow { background: radial-gradient(circle, rgba(34, 197, 94, 0.1) 0%, transparent 70%); }

  /* Filament Promo Card */
  .bento-card.filament-promo {
    background: linear-gradient(135deg, rgba(249, 115, 22, 0.15) 0%, rgba(234, 179, 8, 0.1) 50%, var(--bg-card) 100%);
    border-color: rgba(249, 115, 22, 0.3);
  }
  .bento-card.filament-promo .bento-icon { background: linear-gradient(135deg, #F97316, #EAB308); color: white; }
  .bento-card.filament-promo .bento-tag { background: linear-gradient(135deg, rgba(249, 115, 22, 0.2), rgba(234, 179, 8, 0.2)); color: #F97316; }
  .bento-card.filament-promo:hover { border-color: rgba(249, 115, 22, 0.6); box-shadow: 0 0 30px rgba(249, 115, 22, 0.15); transform: translateY(-4px); }
  .bento-card.filament-promo .bento-glow { background: radial-gradient(circle, rgba(249, 115, 22, 0.15) 0%, transparent 70%); }

  .filament-promo-footer {
    margin-top: auto;
    padding-top: 12px;
  }

  .promo-cta {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 0.85rem;
    font-weight: 600;
    color: #F97316;
    transition: all 0.2s;
  }

  .bento-card.filament-promo:hover .promo-cta {
    gap: 10px;
  }

  .bento-card h3 { font-size: 1.25rem; margin: 0 0 8px; line-height: 1.3; color: var(--text-main); }
  .bento-large h3 { font-size: 1.5rem; }
  .bento-card p { font-size: 0.9rem; color: var(--text-muted); line-height: 1.6; margin: 0; flex: 1; }

  @media (max-width: 768px) {
    .bento-card {
      padding: 16px;
      border-radius: 14px;
      min-height: 140px;
    }
    .bento-large { grid-column: span 1; }
    .bento-icon { width: 36px; height: 36px; border-radius: 10px; }
    .bento-icon svg { width: 20px; height: 20px; }
    .bento-header { margin-bottom: 10px; gap: 8px; }
    .bento-tag { font-size: 0.55rem; padding: 3px 7px; }
    .bento-card h3 { font-size: 0.95rem; margin-bottom: 6px; }
    .bento-large h3 { font-size: 1rem; }
    .bento-card p { font-size: 0.8rem; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
  }

  /* POLLS SECTION */
  .polls-section {
    margin-bottom: 48px;
    padding: 28px;
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 20px;
  }

  .polls-section .category-header {
    margin-bottom: 24px;
    border-bottom: none;
    padding-bottom: 0;
  }

  .poll-icon {
    background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(249, 115, 22, 0.15)) !important;
  }

  .poll-subtitle {
    font-size: 0.85rem;
    color: var(--text-muted);
  }

  .polls-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
  }

  @media (max-width: 768px) {
    .polls-grid {
      grid-template-columns: 1fr;
    }
    .polls-section {
      padding: 20px;
    }
  }

  .poll-card {
    background: var(--bg-main);
    border: 1px solid var(--border-soft);
    border-radius: 16px;
    padding: 20px;
    transition: all 0.3s ease;
  }

  .poll-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(0,0,0,0.15);
  }

  .poll-card.poll-gradient-1 {
    background: linear-gradient(135deg, rgba(234, 179, 8, 0.08) 0%, var(--bg-main) 100%);
    border-color: rgba(234, 179, 8, 0.25);
  }

  .poll-card.poll-gradient-1:hover {
    border-color: rgba(234, 179, 8, 0.5);
    box-shadow: 0 8px 30px rgba(234, 179, 8, 0.15);
  }

  .poll-card.poll-gradient-2 {
    background: linear-gradient(135deg, rgba(6, 182, 212, 0.08) 0%, var(--bg-main) 100%);
    border-color: rgba(6, 182, 212, 0.25);
  }

  .poll-card.poll-gradient-2:hover {
    border-color: rgba(6, 182, 212, 0.5);
    box-shadow: 0 8px 30px rgba(6, 182, 212, 0.15);
  }

  .poll-card-header {
    margin-bottom: 14px;
  }

  .poll-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(249, 115, 22, 0.15));
    color: #EAB308;
  }

  .poll-badge.cyan {
    background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(59, 130, 246, 0.15));
    color: #06B6D4;
  }

  .poll-card h3 {
    font-size: 1.05rem;
    margin: 0 0 14px;
    color: var(--text-main);
    line-height: 1.4;
  }

  .poll-footer {
    display: flex;
    justify-content: flex-end;
    margin-top: 12px;
  }

  .poll-options { display: flex; flex-direction: column; gap: 8px; }
  .poll-option { position: relative; height: 38px; background: rgba(100, 100, 100, 0.1); border-radius: 10px; overflow: hidden; border: 1px solid var(--border-soft); transition: all 0.3s ease; cursor: pointer; }
  .poll-option.voted { pointer-events: none; }
  .poll-option.clickable:hover { transform: scale(1.02); }
  .poll-bar { position: absolute !important; left: 0 !important; top: 0 !important; bottom: 0 !important; height: 100% !important; min-height: 38px !important; border-radius: 10px; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); z-index: 0; opacity: 1 !important; display: block !important; }
  .poll-bar.color-1 { background: linear-gradient(90deg, #EAB308 0%, #F59E0B 100%); }
  .poll-bar.color-2 { background: linear-gradient(90deg, #3B82F6 0%, #2563EB 100%); }
  .poll-bar.color-3 { background: linear-gradient(90deg, #8B5CF6 0%, #7C3AED 100%); }
  .poll-bar.color-4 { background: linear-gradient(90deg, #10B981 0%, #059669 100%); }
  .poll-bar.color-5 { background: linear-gradient(90deg, #06B6D4 0%, #0891B2 100%); }
  .poll-bar.gray { background: rgba(156, 163, 175, 0.4); }
  .poll-label { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 0.8rem; font-weight: 600; z-index: 1; }
  .poll-percent { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); font-size: 0.75rem; font-weight: 700; color: var(--text-muted); z-index: 1; }
  .poll-votes { font-size: 0.8rem; color: var(--text-muted); font-weight: 500; }
  .poll-option.selected { border-color: #22C55E; box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.3); }
  .poll-option.selected .poll-label { color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.3); }

  /* COMMUNITY SHOWCASE */
  .community-showcase {
    margin-bottom: 48px;
    padding: 28px;
    background: linear-gradient(135deg, rgba(168, 85, 247, 0.05) 0%, rgba(236, 72, 153, 0.03) 50%, var(--bg-card) 100%);
    border: 1px solid var(--border-soft);
    border-radius: 20px;
    position: relative;
    overflow: hidden;
  }

  .community-showcase::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -20%;
    width: 60%;
    height: 200%;
    background: radial-gradient(circle, rgba(168, 85, 247, 0.08) 0%, transparent 70%);
    pointer-events: none;
  }

  .community-showcase .category-header {
    border-bottom: none;
    padding-bottom: 0;
    margin-bottom: 24px;
    position: relative;
    z-index: 1;
  }

  .showcase-icon {
    background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(236, 72, 153, 0.15)) !important;
  }

  .showcase-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    position: relative;
    z-index: 1;
  }

  @media (max-width: 1024px) {
    .showcase-grid { grid-template-columns: repeat(2, 1fr); }
  }

  @media (max-width: 640px) {
    .showcase-grid { grid-template-columns: 1fr; }
    .community-showcase { padding: 20px; }
  }

  .showcase-card {
    background: var(--bg-main);
    border: 1px solid var(--border-soft);
    border-radius: 16px;
    padding: 18px;
    text-decoration: none;
    color: inherit;
    display: flex;
    flex-direction: column;
    gap: 12px;
    transition: all 0.3s ease;
  }

  .showcase-card:hover {
    transform: translateY(-4px);
    border-color: rgba(168, 85, 247, 0.5);
    box-shadow: 0 12px 40px rgba(168, 85, 247, 0.15);
  }

  .showcase-card.showcase-featured {
    grid-column: span 2;
    background: linear-gradient(135deg, rgba(168, 85, 247, 0.08) 0%, var(--bg-main) 100%);
    border-color: rgba(168, 85, 247, 0.3);
  }

  @media (max-width: 640px) {
    .showcase-card.showcase-featured { grid-column: span 1; }
  }

  .showcase-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 10px;
  }

  .showcase-user {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .showcase-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, #A855F7, #EC4899);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .showcase-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .showcase-avatar span {
    color: white;
    font-weight: 700;
    font-size: 0.9rem;
  }

  .showcase-user-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .showcase-username {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-main);
  }

  .showcase-date {
    font-size: 0.7rem;
    color: var(--text-muted);
  }

  .showcase-badge {
    font-size: 0.65rem;
    font-weight: 700;
    padding: 4px 10px;
    border-radius: 20px;
    background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(249, 115, 22, 0.15));
    color: #EAB308;
    white-space: nowrap;
  }

  .showcase-title {
    font-size: 1rem;
    font-weight: 700;
    color: var(--text-main);
    line-height: 1.4;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .showcase-card.showcase-featured .showcase-title {
    font-size: 1.15rem;
  }

  .showcase-excerpt {
    font-size: 0.8rem;
    color: var(--text-muted);
    line-height: 1.5;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    flex: 1;
  }

  .showcase-card.showcase-featured .showcase-excerpt {
    -webkit-line-clamp: 3;
  }

  .showcase-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: auto;
    padding-top: 12px;
    border-top: 1px solid var(--border-soft);
  }

  .showcase-stats {
    display: flex;
    gap: 12px;
  }

  .showcase-stats .stat {
    font-size: 0.75rem;
    color: var(--text-muted);
  }

  .showcase-category {
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--text-muted);
    background: var(--bg-card);
    padding: 4px 8px;
    border-radius: 6px;
  }

  .showcase-cta {
    display: flex;
    justify-content: center;
    margin-top: 24px;
    position: relative;
    z-index: 1;
  }

  .showcase-cta-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 28px;
    background: linear-gradient(135deg, #A855F7, #EC4899);
    color: white;
    font-weight: 600;
    font-size: 0.95rem;
    border-radius: 12px;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 4px 20px rgba(168, 85, 247, 0.3);
  }

  .showcase-cta-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(168, 85, 247, 0.4);
  }

  /* CATEGORY SECTIONS */
  .category-section {
    margin-bottom: 48px;
  }

  .category-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--border-soft);
  }

  .category-title-group {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .category-icon {
    font-size: 1.5rem;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 12px;
  }

  .category-icon.orange { background: rgba(249, 115, 22, 0.15); }
  .category-icon.cyan { background: rgba(6, 182, 212, 0.15); }
  .category-icon.purple { background: rgba(168, 85, 247, 0.15); }
  .category-icon.green { background: rgba(34, 197, 94, 0.15); }

  .category-header h2 {
    font-size: 1.4rem;
    margin: 0;
    color: var(--text-main);
  }

  .category-link {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--accent);
    text-decoration: none;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .category-link:hover {
    gap: 8px;
  }

  .category-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
  }

  @media (max-width: 1024px) {
    .category-grid { grid-template-columns: repeat(2, 1fr); }
  }

  @media (max-width: 640px) {
    .category-grid { grid-template-columns: 1fr; gap: 12px; }
    .category-header { flex-direction: column; align-items: flex-start; gap: 12px; }
    .category-header h2 { font-size: 1.2rem; }
    .category-icon { width: 36px; height: 36px; font-size: 1.2rem; }
  }

  /* Category Cards */
  .cat-card {
    position: relative;
    border-radius: 16px;
    text-decoration: none;
    color: white;
    transition: all 0.3s;
    overflow: hidden;
    min-height: 220px;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
  }

  .cat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(0,0,0,0.3);
  }

  .cat-card.orange:hover { box-shadow: 0 12px 40px rgba(249, 115, 22, 0.3); }
  .cat-card.cyan:hover { box-shadow: 0 12px 40px rgba(6, 182, 212, 0.3); }
  .cat-card.purple:hover { box-shadow: 0 12px 40px rgba(168, 85, 247, 0.3); }
  .cat-card.green:hover { box-shadow: 0 12px 40px rgba(34, 197, 94, 0.3); }

  /* Featured card - first in each section */
  .cat-card.cat-featured {
    grid-column: span 2;
    min-height: 280px;
  }

  @media (max-width: 640px) {
    .cat-card.cat-featured { grid-column: span 1; min-height: 200px; }
  }

  .cat-image {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
  }

  .cat-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease;
  }

  .cat-card:hover .cat-image img {
    transform: scale(1.08);
  }

  .cat-content {
    position: relative;
    z-index: 2;
    padding: 16px;
    background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.6) 50%, transparent 100%);
    margin-top: auto;
  }

  .cat-card.cat-featured .cat-content {
    padding: 24px;
  }

  .cat-content h3 {
    font-size: 1rem;
    margin: 0 0 6px;
    line-height: 1.3;
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .cat-card.cat-featured .cat-content h3 {
    font-size: 1.3rem;
    -webkit-line-clamp: 3;
  }

  .cat-content p {
    font-size: 0.8rem;
    color: rgba(255,255,255,0.8);
    line-height: 1.5;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .cat-card.cat-featured .cat-content p {
    font-size: 0.9rem;
    -webkit-line-clamp: 2;
  }

  @media (max-width: 768px) {
    .category-section { margin-bottom: 32px; }
    .cat-card { min-height: 180px; border-radius: 12px; }
    .cat-content { padding: 12px; }
    .cat-content h3 { font-size: 0.9rem; }
    .cat-content p { font-size: 0.75rem; -webkit-line-clamp: 2; }
    .cat-card.cat-featured .cat-content h3 { font-size: 1rem; }
  }

</style>

<script is:inline>
  const API_URL = 'https://tech-portal-api.turgut-d01.workers.dev';

  // ========================================
  // HERO SLIDER
  // ========================================
  (function initSlider() {
    const slides = document.querySelectorAll('.slide');
    const dots = document.querySelectorAll('.slider-dots .dot');
    const progressBar = document.querySelector('.progress-bar');

    if (slides.length === 0) return;

    let currentIndex = 0;
    let interval;
    let progress = 0;
    const SLIDE_DURATION = 6000; // 6 saniye
    const PROGRESS_INTERVAL = 50;

    function goToSlide(index) {
      slides.forEach(s => s.classList.remove('active'));
      dots.forEach(d => d.classList.remove('active'));

      slides[index].classList.add('active');
      dots[index].classList.add('active');

      currentIndex = index;
      progress = 0;
    }

    function nextSlide() {
      const next = (currentIndex + 1) % slides.length;
      goToSlide(next);
    }

    function updateProgress() {
      progress += (PROGRESS_INTERVAL / SLIDE_DURATION) * 100;
      if (progressBar) {
        progressBar.style.width = progress + '%';
      }
      if (progress >= 100) {
        nextSlide();
      }
    }

    function startAutoPlay() {
      interval = setInterval(updateProgress, PROGRESS_INTERVAL);
    }

    function stopAutoPlay() {
      clearInterval(interval);
    }

    // Dot click events
    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => {
        stopAutoPlay();
        goToSlide(index);
        startAutoPlay();
      });
    });

    // Pause on hover
    const sliderContainer = document.querySelector('.slider-container');
    if (sliderContainer) {
      sliderContainer.addEventListener('mouseenter', stopAutoPlay);
      sliderContainer.addEventListener('mouseleave', startAutoPlay);
    }

    // Start
    startAutoPlay();
  })();

  // ========================================
  // API POLL (3D Yazƒ±cƒ± Markasƒ±)
  // ========================================
  async function loadPoll() {
    const pollQuestion = document.getElementById('pollQuestion');
    const pollOptions = document.getElementById('pollOptions');
    const pollVotes = document.getElementById('pollVotes');

    if (!pollQuestion || !pollOptions || !pollVotes) return;

    try {
      const res = await fetch(`${API_URL}/api/poll/active`);
      const data = await res.json();

      if (!data.poll) {
        pollQuestion.textContent = 'Aktif anket yok';
        pollOptions.innerHTML = '';
        pollVotes.textContent = '';
        return;
      }

      const poll = data.poll;
      pollQuestion.textContent = poll.question;

      // Renkler inline style olarak - t√ºm stiller inline!
      const barColors = ['#EAB308', '#3B82F6', '#8B5CF6', '#10B981', '#06B6D4'];
      pollOptions.innerHTML = poll.options.map((opt, index) => {
        const isVoted = poll.votedOptionId === opt.id;
        const barColor = barColors[index % 5];
        const barWidth = Math.max(opt.percent, 8);

        return `
          <div class="poll-option ${poll.hasVoted ? 'voted' : 'clickable'} ${isVoted ? 'selected' : ''}"
               data-option-id="${opt.id}" data-poll-id="${poll.id}"
               style="position: relative; height: 38px; background: rgba(100,100,100,0.1); border-radius: 10px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); cursor: pointer;">
            <div class="poll-bar" style="position: absolute; left: 0; top: 0; bottom: 0; height: 100%; width: ${barWidth}%; background: linear-gradient(90deg, ${barColor} 0%, ${barColor}cc 100%); border-radius: 10px; z-index: 0;"></div>
            <span class="poll-label" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 0.8rem; font-weight: 600; z-index: 1;">${opt.text}</span>
            <span class="poll-percent" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); font-size: 0.75rem; font-weight: 700; color: var(--text-muted); z-index: 1;">%${opt.percent}</span>
          </div>
        `;
      }).join('');

      const totalFormatted = poll.totalVotes >= 1000
        ? `${(poll.totalVotes / 1000).toFixed(1)}k`
        : poll.totalVotes;
      pollVotes.textContent = `${totalFormatted} Oy`;

      if (!poll.hasVoted) {
        document.querySelectorAll('#pollOptions .poll-option.clickable').forEach(opt => {
          opt.addEventListener('click', handleVote);
        });
      }
    } catch (err) {
      console.error('Poll load error:', err);
      pollQuestion.textContent = 'Anket y√ºklenemedi';
    }
  }

  async function handleVote(e) {
    const target = e.currentTarget;
    const optionId = target.dataset.optionId;
    const pollId = target.dataset.pollId;

    if (!optionId || !pollId) return;

    document.querySelectorAll('#pollOptions .poll-option').forEach(opt => {
      opt.classList.remove('clickable');
      opt.classList.add('voted');
    });

    try {
      const res = await fetch(`${API_URL}/api/poll/vote`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ pollId: parseInt(pollId), optionId: parseInt(optionId) })
      });

      const data = await res.json();

      if (data.success) {
        window.showToast('Oyunuz kaydedildi!', 'success');
        loadPoll();
      } else {
        window.showToast(data.error || 'Oy verilemedi', 'warning');
        loadPoll();
      }
    } catch (err) {
      console.error('Vote error:', err);
      window.showToast('Baƒülantƒ± hatasƒ±', 'error');
      loadPoll();
    }
  }

  loadPoll();
  document.addEventListener('astro:after-swap', loadPoll);

  // ========================================
  // SLICER POLL (localStorage)
  // ========================================
  const SLICER_STORAGE_KEY = 'slicerPollData';
  const SLICER_VOTED_KEY = 'slicerPollVoted';

  const slicerOptions = [
    { id: 1, text: 'Cura', color: '#22C55E' },
    { id: 2, text: 'PrusaSlicer', color: '#F97316' },
    { id: 3, text: 'OrcaSlicer', color: '#8B5CF6' },
    { id: 4, text: 'Bambu Studio', color: '#06B6D4' },
    { id: 5, text: 'Diƒüer', color: '#6B7280' }
  ];

  function getSlicerData() {
    try {
      const data = localStorage.getItem(SLICER_STORAGE_KEY);
      if (data) return JSON.parse(data);
    } catch (e) {}
    return { 1: 234, 2: 187, 3: 156, 4: 89, 5: 34 };
  }

  function saveSlicerData(data) {
    localStorage.setItem(SLICER_STORAGE_KEY, JSON.stringify(data));
  }

  function hasVotedSlicer() {
    return localStorage.getItem(SLICER_VOTED_KEY) !== null;
  }

  function setVotedSlicer(optionId) {
    localStorage.setItem(SLICER_VOTED_KEY, optionId.toString());
  }

  function getVotedSlicerOption() {
    return parseInt(localStorage.getItem(SLICER_VOTED_KEY) || '0');
  }

  function loadSlicerPoll() {
    const slicerOptionsEl = document.getElementById('slicerOptions');
    const slicerVotesEl = document.getElementById('slicerVotes');

    if (!slicerOptionsEl || !slicerVotesEl) return;

    const data = getSlicerData();
    const totalVotes = Object.values(data).reduce((a, b) => a + b, 0);
    const voted = hasVotedSlicer();
    const votedOptionId = getVotedSlicerOption();

    slicerOptionsEl.innerHTML = slicerOptions.map((opt) => {
      const votes = data[opt.id] || 0;
      const percent = totalVotes > 0 ? Math.round((votes / totalVotes) * 100) : 0;
      const isVoted = votedOptionId === opt.id;

      return `
        <div class="poll-option ${voted ? 'voted' : 'clickable'} ${isVoted ? 'selected' : ''}"
             data-slicer-id="${opt.id}"
             style="position: relative; height: 38px; background: rgba(100,100,100,0.1); border-radius: 10px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); cursor: pointer;">
          <div class="poll-bar" style="position: absolute; left: 0; top: 0; bottom: 0; height: 100%; width: ${Math.max(percent, 8)}%; background: linear-gradient(90deg, ${opt.color} 0%, ${opt.color}dd 100%); border-radius: 10px; z-index: 0;"></div>
          <span class="poll-label" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 0.8rem; font-weight: 600; z-index: 1;">${opt.text}</span>
          <span class="poll-percent" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); font-size: 0.75rem; font-weight: 700; color: var(--text-muted); z-index: 1;">%${percent}</span>
        </div>
      `;
    }).join('');

    const totalFormatted = totalVotes >= 1000 ? `${(totalVotes / 1000).toFixed(1)}k` : totalVotes;
    slicerVotesEl.textContent = `${totalFormatted} Oy`;

    if (!voted) {
      document.querySelectorAll('#slicerOptions [data-slicer-id]').forEach(opt => {
        opt.addEventListener('click', handleSlicerVote);
      });
    }
  }

  function handleSlicerVote(e) {
    const target = e.currentTarget;
    const optionId = parseInt(target.dataset.slicerId || '0');

    if (!optionId || hasVotedSlicer()) return;

    const data = getSlicerData();
    data[optionId] = (data[optionId] || 0) + 1;
    saveSlicerData(data);
    setVotedSlicer(optionId);

    loadSlicerPoll();
  }

  loadSlicerPoll();
  document.addEventListener('astro:after-swap', loadSlicerPoll);
</script>
