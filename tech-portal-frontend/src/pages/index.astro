---
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/Header.astro";
import { getApiBase, getLanguage, dateLocales, type Language } from "../lib/api";
import { translations } from "../lib/translations";

export const prerender = false;

// Get language from subdomain
const lang = getLanguage(Astro.request);
const t = translations[lang];
const dateLocale = dateLocales[lang];

type Post = {
  id: number;
  title_tr: string;
  summary_tr: string;
  slug: string;
  slug_tr?: string;
  category: string;
  image_url?: string;
  is_featured: number;
};

type CommunityProject = {
  id: number;
  title: string;
  slug: string;
  content: string;
  view_count: number;
  reply_count: number;
  like_count: number;
  created_at: string;
  username: string;
  display_name: string;
  avatar_url?: string;
  category_name: string;
  category_slug: string;
  category_icon: string;
  featured_type: 'admin' | 'auto';
};

const API_BASE = getApiBase(Astro.request);
const langParam = lang !== "tr" ? `?lang=${lang}` : "";
const langParamAmp = lang !== "tr" ? `&lang=${lang}` : "";

let data: Record<string, Post[]> = {};
let communityProjects: CommunityProject[] = [];
let error: string | null = null;

try {
  const [homeRes, communityRes] = await Promise.all([
    fetch(`${API_BASE}/api/home${langParam}`, { headers: { "Accept": "application/json" } }),
    fetch(`${API_BASE}/api/community/featured?limit=4${langParamAmp}`, { headers: { "Accept": "application/json" } })
  ]);

  if (!homeRes.ok) {
    throw new Error(`API error: ${homeRes.status}`);
  }

  data = await homeRes.json();

  if (communityRes.ok) {
    const communityData = await communityRes.json();
    communityProjects = communityData.projects || [];
  }
} catch (e) {
  error = e instanceof Error ? e.message : "Unknown error";
  console.error("Homepage error:", error);
}

const printPosts = data["3d-baski"] || [];
const rehberPosts = data["rehberler"] || [];
const incelemePosts = data["incelemeler"] || [];
const sorunPosts = data["sorun-cozumleri"] || [];

// Hero slider i√ßin 3D Baskƒ±, Rehberler, Sorun √á√∂z√ºmleri ve Topluluk Projesi
const communityHeroSlide = communityProjects[0] ? {
  id: communityProjects[0].id,
  title_tr: communityProjects[0].title,
  summary_tr: getExcerpt(communityProjects[0].content, 150),
  slug: communityProjects[0].slug,
  category: 'topluluk-projesi',
  image_url: null, // Topluluk projelerinde g√∂rsel yok, gradient kullanacaƒüƒ±z
  is_featured: 1,
  username: communityProjects[0].username,
  display_name: communityProjects[0].display_name
} : null;

const heroSlides = [
  printPosts[0],        // 3D Baskƒ±
  rehberPosts[0],       // Rehberler
  communityHeroSlide,   // Topluluk Projesi
  sorunPosts[0],        // Sorun √á√∂z√ºmleri
].filter(Boolean);

// Category labels based on language
const categoryLabels: Record<Language, Record<string, string>> = {
  tr: {
    "3d-baski": "3D Baskƒ±",
    "rehberler": "Rehber",
    "incelemeler": "ƒ∞nceleme",
    "sorun-cozumleri": "Sorun √á√∂z√ºm√º",
    "topluluk-projesi": "Topluluk Projesi"
  },
  en: {
    "3d-baski": "3D Printing",
    "rehberler": "Guide",
    "incelemeler": "Review",
    "sorun-cozumleri": "Troubleshooting",
    "topluluk-projesi": "Community Project"
  },
  de: {
    "3d-baski": "3D-Druck",
    "rehberler": "Anleitung",
    "incelemeler": "Bewertung",
    "sorun-cozumleri": "Fehlerbehebung",
    "topluluk-projesi": "Community Projekt"
  }
};

// URL kategori slug'larƒ± (SEO i√ßin dile g√∂re)
const categoryUrls: Record<Language, Record<string, string>> = {
  tr: {
    "3d-baski": "3d-baski",
    "rehberler": "rehberler",
    "incelemeler": "incelemeler",
    "sorun-cozumleri": "sorun-cozumleri",
    "topluluk": "topluluk",
    "teknoloji": "teknoloji",
    "yapay-zeka": "yapay-zeka"
  },
  en: {
    "3d-baski": "3d-printing",
    "rehberler": "guides",
    "incelemeler": "reviews",
    "sorun-cozumleri": "troubleshooting",
    "topluluk": "community",
    "teknoloji": "technology",
    "yapay-zeka": "ai"
  },
  de: {
    "3d-baski": "3d-druck",
    "rehberler": "anleitungen",
    "incelemeler": "bewertungen",
    "sorun-cozumleri": "fehlerbehebung",
    "topluluk": "community",
    "teknoloji": "technologie",
    "yapay-zeka": "ki"
  }
};

function getCategoryUrl(cat: string) {
  return categoryUrls[lang][cat] || cat;
}

function getCategoryLabel(cat: string) {
  return categoryLabels[lang][cat] || categoryLabels[lang]["3d-baski"];
}

function getCategoryColor(cat: string) {
  if (cat === "3d-baski") return "orange";
  if (cat === "rehberler") return "cyan";
  if (cat === "incelemeler") return "purple";
  if (cat === "sorun-cozumleri") return "green";
  if (cat === "topluluk-projesi") return "pink";
  return "orange";
}

function getExcerpt(content: string, length: number = 120): string {
  return content.replace(/[#*|\[\]`\n]/g, ' ').replace(/\s+/g, ' ').trim().substring(0, length) + '...';
}
---

<BaseLayout
  title={t.homepage.title}
  description={t.homepage.description}
  lang={lang}
>
  <Header />

  <!-- HERO SLIDER SECTION -->
  <section class="hero-section" aria-label={t.homepage.featuredContent || "√ñne √ßƒ±kan i√ßerikler"}>
    <div class="container">
      <div class="hero-slider-box" role="region" aria-roledescription="carousel" aria-label={t.homepage.featuredSlider || "√ñne √ßƒ±kan i√ßerik slider"}>
        <div class="slider-container" tabindex="0">
          {heroSlides.map((slide, index) => (
            <div class={`slide ${index === 0 ? 'active' : ''} ${slide.category === 'topluluk-projesi' ? 'community-slide' : ''}`} data-index={index} role="group" aria-roledescription="slide" aria-label={`${index + 1} / ${heroSlides.length}`}>
              <div class="slide-bg">
                {slide.image_url ? (
                  <img src={slide.image_url} alt={slide.title_tr} loading={index === 0 ? "eager" : "lazy"} decoding="async" width="1200" height="380" style="object-fit:cover;width:100%;height:100%;" />
                ) : slide.category === 'topluluk-projesi' ? (
                  <div class="community-gradient"></div>
                ) : null}
                <div class="slide-overlay"></div>
              </div>
              <div class="slide-content">
                <div class={`hero-badge ${getCategoryColor(slide.category)}`}>
                  <span class="pulse-dot"></span>
                  <span>{getCategoryLabel(slide.category)}</span>
                  {slide.category === 'topluluk-projesi' && slide.username && (
                    <span class="hero-author">@{slide.username}</span>
                  )}
                </div>
                <h1>{slide.title || slide.title_tr}</h1>
                <p>{slide.summary || slide.summary_tr}</p>
                <a href={slide.category === 'topluluk-projesi' ? `/topluluk/forum/konu/${slide.slug}` : `/${slide.category}/${slide.slug}`} class="hero-btn">
                  {slide.category === 'topluluk-projesi' ? t.homepage.viewProject : t.homepage.readMore}
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
                </a>
              </div>
            </div>
          ))}

          <!-- Slider Navigation Dots -->
          <div class="slider-dots">
            {heroSlides.map((slide, index) => (
              <button
                class={`dot ${index === 0 ? 'active' : ''} ${getCategoryColor(slide.category)}`}
                data-index={index}
                aria-label={getCategoryLabel(slide.category)}
              >
                <span class="dot-label">{getCategoryLabel(slide.category)}</span>
              </button>
            ))}
          </div>

          <!-- Progress Bar -->
          <div class="slider-progress">
            <div class="progress-bar"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- QUICK ACCESS BAND -->
  <section class="quick-access-band">
    <div class="container">
      <div class="quick-access-grid">
        <a href="/sorun-cozumleri" class="quick-card">
          <div class="quick-icon">üîß</div>
          <div class="quick-text">
            <span class="quick-title">{t.homepage.haveProblem}</span>
            <span class="quick-desc">{t.homepage.findSolution}</span>
          </div>
          <svg class="quick-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
        </a>
        <a href="/rehberler" class="quick-card">
          <div class="quick-icon">üìö</div>
          <div class="quick-text">
            <span class="quick-title">{t.homepage.newbie}</span>
            <span class="quick-desc">{t.homepage.checkGuides}</span>
          </div>
          <svg class="quick-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
        </a>
        <a href="/filamentler" class="quick-card">
          <div class="quick-icon">üßµ</div>
          <div class="quick-text">
            <span class="quick-title">{t.homepage.lookingFilament}</span>
            <span class="quick-desc">{t.homepage.comparePrices}</span>
          </div>
          <svg class="quick-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
        </a>
        <a href="/topluluk" class="quick-card highlight">
          <div class="quick-icon">üë•</div>
          <div class="quick-text">
            <span class="quick-title">{t.homepage.joinCommunity}</span>
            <span class="quick-desc">{t.homepage.askShare}</span>
          </div>
          <svg class="quick-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
        </a>
      </div>
    </div>
  </section>

  <main class="main-content container">
    {error && (
      <div class="message message-error">
        <p>{t.homepage.errorLoading}: {error}</p>
      </div>
    )}

    <!-- 1. TROUBLESHOOTING - Most searched content (6 cards) -->
    {sorunPosts.length > 0 && (
      <section class="category-section priority-section">
        <div class="category-header">
          <div class="category-title-group">
            <span class="category-icon green">üîß</span>
            <h2>{t.homepage.troubleshootingSection}</h2>
            <span class="priority-badge">{t.homepage.mostSearched}</span>
          </div>
          <a href="/sorun-cozumleri" class="category-link">{t.homepage.viewAll} ‚Üí</a>
        </div>
        <div class="category-grid six-cols">
          {sorunPosts.slice(0, 6).map((post, i) => (
            <a href={`/sorun-cozumleri/${post.slug}`} class={`cat-card ${i === 0 ? 'cat-featured' : ''} green`}>
              {post.image_url && (
                <div class="cat-image">
                  <img src={post.image_url} alt={post.title || post.title_tr} loading="lazy" decoding="async" />
                </div>
              )}
              <div class="cat-content">
                <h3>{post.title || post.title_tr}</h3>
                <p>{post.summary || post.summary_tr}</p>
              </div>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- 2. INTERACTIVE GUIDES - Featured -->
    <section class="interactive-guides-section">
      <div class="section-intro">
        <div class="section-intro-left">
          <span class="section-badge">{t.homepage.interactiveBadge}</span>
          <h2>{t.homepage.slicerGuides}</h2>
          <p>{t.homepage.slicerGuidesDesc}</p>
        </div>
        <a href="/rehberler" class="section-cta">
          {t.homepage.allGuides}
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
        </a>
      </div>
      <div class="interactive-guides-grid">
        <a href="/rehberler/cura-slicer-interaktif-rehber" class="interactive-guide-card" style="--guide-color: #0077C8">
          <div class="guide-glow"></div>
          <img src="/slicer-logos/cura.svg" alt="Cura" class="guide-logo" />
          <div class="guide-info">
            <h3>Cura Slicer</h3>
            <p>{t.homepage.flowCalcs}</p>
            <div class="guide-features">
              <span>Volumetric Flow</span>
              <span>{t.homepage.zOffset}</span>
            </div>
          </div>
          <span class="guide-badge">{t.homepage.start} ‚Üí</span>
        </a>
        <a href="/rehberler/orca-slicer-rehberi" class="interactive-guide-card" style="--guide-color: #10b981">
          <div class="guide-glow"></div>
          <img src="/slicer-logos/orca.svg" alt="Orca" class="guide-logo" />
          <div class="guide-info">
            <h3>Orca Slicer</h3>
            <p>{t.homepage.calibration}</p>
            <div class="guide-features">
              <span>{t.homepage.paCalibration}</span>
              <span>{t.homepage.flowTest}</span>
            </div>
          </div>
          <span class="guide-badge">{t.homepage.start} ‚Üí</span>
        </a>
        <a href="/rehberler/bambu-slicer-rehberi" class="interactive-guide-card" style="--guide-color: #00AE42">
          <div class="guide-glow"></div>
          <img src="/slicer-logos/bambu.svg" alt="Bambu" class="guide-logo" />
          <div class="guide-info">
            <h3>Bambu Lab</h3>
            <p>X1C, P1P, P1S, A1 {t.homepage.expertGuide}</p>
            <div class="guide-features">
              <span>{t.homepage.troubleshoot}</span>
              <span>{t.homepage.flowRate}</span>
            </div>
          </div>
          <span class="guide-badge">{t.homepage.start} ‚Üí</span>
        </a>
        <a href="/rehberler/prusaslicer-rehberi" class="interactive-guide-card" style="--guide-color: #ea580c">
          <div class="guide-glow"></div>
          <img src="/slicer-logos/prusa.svg" alt="Prusa" class="guide-logo" />
          <div class="guide-info">
            <h3>PrusaSlicer</h3>
            <p>{t.homepage.layerSettings}</p>
            <div class="guide-features">
              <span>{t.homepage.organicSupport}</span>
              <span>{t.homepage.seamPaint}</span>
            </div>
          </div>
          <span class="guide-badge">{t.homepage.start} ‚Üí</span>
        </a>
      </div>
    </section>

    <!-- 3. GUIDES - Blog Content -->
    {rehberPosts.length > 0 && (
      <section class="category-section">
        <div class="category-header">
          <div class="category-title-group">
            <span class="category-icon cyan">üìò</span>
            <h2>{t.homepage.guidesSection}</h2>
          </div>
          <a href="/rehberler" class="category-link">{t.homepage.viewAll} ‚Üí</a>
        </div>
        <div class="category-grid six-cols">
          {rehberPosts.slice(0, 6).map((post, i) => (
            <a href={`/rehberler/${post.slug}`} class={`cat-card ${i === 0 ? 'cat-featured' : ''} cyan`}>
              {post.image_url && (
                <div class="cat-image">
                  <img src={post.image_url} alt={post.title || post.title_tr} loading="lazy" decoding="async" />
                </div>
              )}
              <div class="cat-content">
                <h3>{post.title || post.title_tr}</h3>
                <p>{post.summary || post.summary_tr}</p>
              </div>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- 4. 3D PRINTING NEWS - Current content -->
    {printPosts.length > 1 && (
      <section class="category-section">
        <div class="category-header">
          <div class="category-title-group">
            <span class="category-icon orange">üì∞</span>
            <h2>{t.homepage.newsSection}</h2>
          </div>
          <a href="/3d-baski" class="category-link">{t.homepage.viewAll} ‚Üí</a>
        </div>
        <div class="category-grid six-cols">
          {printPosts.slice(1, 7).map((post, i) => (
            <a href={`/3d-baski/${post.slug}`} class={`cat-card ${i === 0 ? 'cat-featured' : ''} orange`}>
              {post.image_url && (
                <div class="cat-image">
                  <img src={post.image_url} alt={post.title || post.title_tr} loading="lazy" decoding="async" />
                </div>
              )}
              <div class="cat-content">
                <h3>{post.title || post.title_tr}</h3>
                <p>{post.summary || post.summary_tr}</p>
              </div>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- 4. COMMUNITY SHOWCASE -->
    {communityProjects.length > 0 && (
      <section class="community-showcase">
        <div class="category-header">
          <div class="category-title-group">
            <span class="category-icon showcase-icon">üèÜ</span>
            <h2>{t.homepage.communityShowcase}</h2>
          </div>
          <a href="/topluluk/projeler" class="category-link">{t.homepage.allProjects} ‚Üí</a>
        </div>

        <div class="showcase-grid">
          {communityProjects.map((project, index) => (
            <a href={`/topluluk/forum/konu/${project.slug}`} class={`showcase-card ${index === 0 ? 'showcase-featured' : ''}`}>
              <div class="showcase-header">
                <div class="showcase-user">
                  <div class="showcase-avatar">
                    {project.avatar_url ? (
                      <img src={project.avatar_url} alt={project.display_name || project.username} />
                    ) : (
                      <span>{(project.display_name || project.username).charAt(0).toUpperCase()}</span>
                    )}
                  </div>
                  <div class="showcase-user-info">
                    <span class="showcase-username">@{project.username}</span>
                    <span class="showcase-date">{new Date(project.created_at).toLocaleDateString(dateLocale)}</span>
                  </div>
                </div>
                {project.featured_type === 'admin' && (
                  <span class="showcase-badge">‚≠ê {t.homepage.editorsChoice}</span>
                )}
              </div>

              <h3 class="showcase-title">{project.title}</h3>

              <p class="showcase-excerpt">
                {getExcerpt(project.content)}
              </p>

              <div class="showcase-footer">
                <div class="showcase-stats">
                  <span class="stat">üëÅÔ∏è {project.view_count}</span>
                  <span class="stat">üí¨ {project.reply_count}</span>
                  <span class="stat">‚ù§Ô∏è {project.like_count}</span>
                </div>
                <span class="showcase-category">{project.category_icon} {project.category_name}</span>
              </div>
            </a>
          ))}
        </div>

        <div class="showcase-cta">
          <a href="/topluluk/projeler/paylas" class="showcase-cta-btn">
            <span>üé®</span>
            <span>{t.homepage.shareProject}</span>
          </a>
        </div>
      </section>
    )}

    <!-- 6. REVIEWS -->
    {incelemePosts.length > 0 && (
      <section class="category-section">
        <div class="category-header">
          <div class="category-title-group">
            <span class="category-icon purple">‚≠ê</span>
            <h2>{t.homepage.reviewsSection}</h2>
          </div>
          <a href="/incelemeler" class="category-link">{t.homepage.viewAll} ‚Üí</a>
        </div>
        <div class="category-grid six-cols">
          {incelemePosts.slice(0, 6).map((post, i) => (
            <a href={`/incelemeler/${post.slug}`} class={`cat-card ${i === 0 ? 'cat-featured' : ''} purple`}>
              {post.image_url && (
                <div class="cat-image">
                  <img src={post.image_url} alt={post.title || post.title_tr} loading="lazy" decoding="async" />
                </div>
              )}
              <div class="cat-content">
                <h3>{post.title || post.title_tr}</h3>
                <p>{post.summary || post.summary_tr}</p>
              </div>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- MEMBERSHIP CTA SECTION -->
    <section class="membership-cta-section">
      <div class="membership-cta-box">
        <div class="membership-glow"></div>
        <div class="membership-content">
          <div class="membership-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
          </div>
          <div class="membership-text">
            <h2>T√ºrkiye'nin En B√ºy√ºk 3D Baskƒ± Topluluƒüuna Katƒ±l! üöÄ</h2>
            <p>√úcretsiz √ºye ol, deneyimlerini payla≈ü, sorularƒ±nƒ± sor ve binlerce maker ile tanƒ±≈ü.</p>
          </div>
          <div class="membership-benefits">
            <div class="benefit-item">
              <span class="benefit-icon">üí¨</span>
              <span>Forum & Yorum</span>
            </div>
            <div class="benefit-item">
              <span class="benefit-icon">üé®</span>
              <span>Proje Payla≈ü</span>
            </div>
            <div class="benefit-item">
              <span class="benefit-icon">üß™</span>
              <span>Filament Test</span>
            </div>
            <div class="benefit-item">
              <span class="benefit-icon">üìç</span>
              <span>Maker Harita</span>
            </div>
          </div>
          <div class="membership-actions">
            <a href="/auth/kayit" class="membership-btn primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/></svg>
              Hemen √úye Ol
            </a>
            <a href="/auth/giris" class="membership-btn secondary">
              Zaten √ºyeyim
            </a>
          </div>
        </div>
        <div class="membership-stats">
          <div class="stat-item">
            <span class="stat-number">1,200+</span>
            <span class="stat-label">√úye</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">500+</span>
            <span class="stat-label">Proje</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">2,000+</span>
            <span class="stat-label">Yorum</span>
          </div>
        </div>
      </div>
    </section>

    <!-- 6. POLLS - Engagement at bottom -->
    <section class="polls-section">
      <div class="category-header">
        <div class="category-title-group">
          <span class="category-icon poll-icon">üìä</span>
          <h2>{t.homepage.pollsSection}</h2>
        </div>
        <span class="poll-subtitle">{t.homepage.communityPreferences}</span>
      </div>

      <div class="polls-grid">
        <div class="poll-card poll-gradient-1" id="pollCard">
          <div class="poll-card-header">
            <div class="poll-badge">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>
              {t.homepage.activePoll}
            </div>
          </div>
          <h3 id="pollQuestion">{t.homepage.printerBrandQuestion}</h3>
          <div class="poll-options" id="pollOptions">
            <div class="poll-option clickable" data-option-id="1" data-poll-id="4">
              <div class="poll-bar" style="width: 35%; background: linear-gradient(90deg, #EAB308 0%, #EAB308cc 100%);"></div>
              <span class="poll-label">Creality</span>
              <span class="poll-percent">%35</span>
            </div>
            <div class="poll-option clickable" data-option-id="2" data-poll-id="4">
              <div class="poll-bar" style="width: 25%; background: linear-gradient(90deg, #3B82F6 0%, #3B82F6cc 100%);"></div>
              <span class="poll-label">Prusa</span>
              <span class="poll-percent">%25</span>
            </div>
            <div class="poll-option clickable" data-option-id="3" data-poll-id="4">
              <div class="poll-bar" style="width: 22%; background: linear-gradient(90deg, #8B5CF6 0%, #8B5CF6cc 100%);"></div>
              <span class="poll-label">Bambu Lab</span>
              <span class="poll-percent">%22</span>
            </div>
            <div class="poll-option clickable" data-option-id="4" data-poll-id="4">
              <div class="poll-bar" style="width: 12%; background: linear-gradient(90deg, #10B981 0%, #10B981cc 100%);"></div>
              <span class="poll-label">Anycubic</span>
              <span class="poll-percent">%12</span>
            </div>
            <div class="poll-option clickable" data-option-id="5" data-poll-id="4">
              <div class="poll-bar" style="width: 8%; background: linear-gradient(90deg, #06B6D4 0%, #06B6D4cc 100%);"></div>
              <span class="poll-label">{t.homepage.other}</span>
              <span class="poll-percent">%6</span>
            </div>
          </div>
          <div class="poll-footer">
            <span class="poll-votes" id="pollVotes">127 {t.homepage.votes}</span>
          </div>
        </div>

        <div class="poll-card poll-gradient-2" id="slicerPollCard">
          <div class="poll-card-header">
            <div class="poll-badge cyan">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
              {t.homepage.slicerPoll}
            </div>
          </div>
          <h3>{t.homepage.slicerQuestion}</h3>
          <div class="poll-options" id="slicerOptions">
            <div class="poll-option clickable" data-slicer-id="1">
              <div class="poll-bar" style="width: 33%; background: linear-gradient(90deg, #22C55E 0%, #22C55Edd 100%);"></div>
              <span class="poll-label">Cura</span>
              <span class="poll-percent">%33</span>
            </div>
            <div class="poll-option clickable" data-slicer-id="2">
              <div class="poll-bar" style="width: 27%; background: linear-gradient(90deg, #F97316 0%, #F97316dd 100%);"></div>
              <span class="poll-label">PrusaSlicer</span>
              <span class="poll-percent">%27</span>
            </div>
            <div class="poll-option clickable" data-slicer-id="3">
              <div class="poll-bar" style="width: 22%; background: linear-gradient(90deg, #8B5CF6 0%, #8B5CF6dd 100%);"></div>
              <span class="poll-label">OrcaSlicer</span>
              <span class="poll-percent">%22</span>
            </div>
            <div class="poll-option clickable" data-slicer-id="4">
              <div class="poll-bar" style="width: 13%; background: linear-gradient(90deg, #06B6D4 0%, #06B6D4dd 100%);"></div>
              <span class="poll-label">Bambu Studio</span>
              <span class="poll-percent">%13</span>
            </div>
            <div class="poll-option clickable" data-slicer-id="5">
              <div class="poll-bar" style="width: 8%; background: linear-gradient(90deg, #6B7280 0%, #6B7280dd 100%);"></div>
              <span class="poll-label">{t.homepage.other}</span>
              <span class="poll-percent">%5</span>
            </div>
          </div>
          <div class="poll-footer">
            <span class="poll-votes" id="slicerVotes">700 {t.homepage.votes}</span>
          </div>
        </div>
      </div>
    </section>
  </main>
</BaseLayout>

<style>
  /* HERO SECTION */
  .hero-section {
    padding: 150px 20px 30px;
  }

  .container { max-width: 1200px; margin: 0 auto; }

  /* HERO SLIDER BOX */
  .hero-slider-box {
    position: relative;
    height: 380px;
    border-radius: 20px;
    overflow: hidden;
    border: 1px solid var(--border-soft);
  }

  .slider-container {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  .slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
  }

  .slide.active {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    clip: auto;
    animation: fadeIn 0.6s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .slide-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .slide-bg img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Topluluk projesi i√ßin gradient arka plan */
  .community-gradient {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg,
      #1a1a2e 0%,
      #16213e 25%,
      #0f3460 50%,
      #1a1a2e 75%,
      #16213e 100%);
    position: relative;
  }

  .community-gradient::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background:
      radial-gradient(circle at 20% 30%, rgba(236, 72, 153, 0.15) 0%, transparent 50%),
      radial-gradient(circle at 80% 70%, rgba(168, 85, 247, 0.15) 0%, transparent 50%),
      radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 60%);
  }

  .community-gradient::after {
    content: 'üèÜ';
    position: absolute;
    top: 50%;
    right: 15%;
    transform: translateY(-50%);
    font-size: 8rem;
    opacity: 0.08;
  }

  .slide.community-slide .slide-overlay {
    background: linear-gradient(90deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.1) 100%);
  }

  .slide-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.6) 40%, rgba(0,0,0,0.4) 100%);
  }

  .slide-content {
    position: relative;
    z-index: 2;
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 30px 40px;
    max-width: 100%;
  }

  .hero-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    color: white;
    margin-bottom: 16px;
    width: fit-content;
  }

  .hero-badge.orange { border-color: rgba(249, 115, 22, 0.5); }
  .hero-badge.cyan { border-color: rgba(6, 182, 212, 0.5); }
  .hero-badge.purple { border-color: rgba(168, 85, 247, 0.5); }
  .hero-badge.green { border-color: rgba(34, 197, 94, 0.5); }
  .hero-badge.pink { border-color: rgba(236, 72, 153, 0.5); }

  .hero-author {
    margin-left: 4px;
    padding-left: 8px;
    border-left: 1px solid rgba(255,255,255,0.3);
    font-weight: 500;
    opacity: 0.9;
  }

  .pulse-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    animation: pulse 2s infinite;
  }

  .hero-badge.orange .pulse-dot { background: #F97316; }
  .hero-badge.cyan .pulse-dot { background: #06B6D4; }
  .hero-badge.purple .pulse-dot { background: #A855F7; }
  .hero-badge.green .pulse-dot { background: #22C55E; }
  .hero-badge.pink .pulse-dot { background: #EC4899; }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .slide-content h1 {
    font-size: 1.6rem;
    font-weight: 700;
    line-height: 1.3;
    margin-bottom: 12px;
    color: white;
    text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    max-width: 90%;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: normal;
    text-align: center;
  }

  .slide-content p {
    font-size: 0.9rem;
    color: rgba(255,255,255,0.85);
    line-height: 1.5;
    margin-bottom: 20px;
    max-width: 700px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: normal;
    text-align: center;
  }

  .hero-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 10px 20px;
    background: var(--accent);
    color: white;
    border-radius: 10px;
    font-weight: 600;
    font-size: 0.9rem;
    text-decoration: none;
    transition: all 0.3s;
    width: fit-content;
  }

  .hero-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
  }

  /* Slider Dots */
  .slider-dots {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    z-index: 10;
  }

  .dot {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .dot:hover {
    background: rgba(255,255,255,0.2);
  }

  .dot.active {
    background: rgba(255,255,255,0.25);
  }

  .dot.active.orange { border-color: #F97316; box-shadow: 0 0 10px rgba(249, 115, 22, 0.4); }
  .dot.active.cyan { border-color: #06B6D4; box-shadow: 0 0 10px rgba(6, 182, 212, 0.4); }
  .dot.active.purple { border-color: #A855F7; box-shadow: 0 0 10px rgba(168, 85, 247, 0.4); }
  .dot.active.green { border-color: #22C55E; box-shadow: 0 0 10px rgba(34, 197, 94, 0.4); }
  .dot.active.pink { border-color: #EC4899; box-shadow: 0 0 10px rgba(236, 72, 153, 0.4); }

  .dot-label {
    font-size: 0.65rem;
    font-weight: 600;
    color: white;
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }

  /* Progress Bar */
  .slider-progress {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: rgba(255,255,255,0.1);
  }

  .progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #F97316, #06B6D4, #A855F7);
    transition: width 0.1s linear;
  }

  @media (max-width: 768px) {
    .hero-section {
      padding: 100px 12px 20px;
    }

    .hero-slider-box {
      height: 260px;
      border-radius: 12px;
      overflow: hidden;
    }

    .slider-container {
      overflow: hidden;
    }

    .slide {
      overflow: hidden;
      display: none;
    }

    .slide.active {
      display: block;
    }

    .slide-content {
      padding: 16px 20px;
      max-width: 100%;
      align-items: center;
      text-align: center;
    }

    .slide-content h1 {
      font-size: 1rem;
      line-height: 1.3;
      margin-bottom: 8px;
      -webkit-line-clamp: 2;
      max-width: 95%;
    }

    .slide-content p {
      font-size: 0.75rem;
      margin-bottom: 12px;
      line-height: 1.4;
      text-align: center;
      -webkit-line-clamp: 2;
      max-width: 95%;
    }

    .hero-badge {
      padding: 4px 10px;
      font-size: 0.65rem;
      margin-bottom: 10px;
    }

    .hero-btn {
      padding: 8px 16px;
      font-size: 0.8rem;
    }

    .slider-dots {
      flex-wrap: wrap;
      justify-content: center;
      padding: 0 8px;
      gap: 6px;
      bottom: 10px;
    }

    .dot {
      padding: 6px 10px;
      min-height: 28px;
    }

    .dot-label {
      font-size: 0.6rem;
    }
  }

  .main-content { padding-bottom: 40px; }

  /* BENTO GRID */
  .bento-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-bottom: 40px;
  }

  @media (max-width: 1024px) { .bento-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 768px) {
    .bento-grid {
      grid-template-columns: 1fr;
      gap: 12px;
    }
  }

  .bento-card {
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 20px;
    padding: 24px;
    text-decoration: none;
    color: inherit;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
    min-height: 200px;
  }

  .bento-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(0,0,0,0.15);
  }

  .bento-large { grid-column: span 2; }

  .bento-glow {
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    opacity: 0.5;
    pointer-events: none;
  }

  .bento-card.orange .bento-glow { background: radial-gradient(circle, rgba(249, 115, 22, 0.1) 0%, transparent 70%); }

  .bento-content { position: relative; z-index: 1; flex: 1; display: flex; flex-direction: column; }

  .bento-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }

  .bento-icon {
    width: 48px;
    height: 48px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .bento-card.orange .bento-icon { background: rgba(249, 115, 22, 0.1); color: #F97316; }
  .bento-card.cyan .bento-icon { background: rgba(6, 182, 212, 0.1); color: #06B6D4; }
  .bento-card.purple .bento-icon { background: rgba(168, 85, 247, 0.1); color: #A855F7; }

  .bento-card.orange:hover { border-color: rgba(249, 115, 22, 0.5); }
  .bento-card.cyan:hover { border-color: rgba(6, 182, 212, 0.5); }
  .bento-card.purple:hover { border-color: rgba(168, 85, 247, 0.5); }

  .bento-tag {
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 4px 10px;
    border-radius: 6px;
    background: var(--border-soft);
    color: var(--text-muted);
  }

  .bento-card.orange .bento-tag { background: rgba(249, 115, 22, 0.1); color: #F97316; }
  .bento-card.cyan .bento-tag { background: rgba(6, 182, 212, 0.1); color: #06B6D4; }
  .bento-card.purple .bento-tag { background: rgba(168, 85, 247, 0.1); color: #A855F7; }
  .bento-card.green .bento-tag { background: rgba(34, 197, 94, 0.1); color: #22C55E; }
  .bento-card.green .bento-icon { background: rgba(34, 197, 94, 0.1); color: #22C55E; }
  .bento-card.green:hover { border-color: rgba(34, 197, 94, 0.5); }
  .bento-card.green .bento-glow { background: radial-gradient(circle, rgba(34, 197, 94, 0.1) 0%, transparent 70%); }

  /* Filament Promo Card */
  .bento-card.filament-promo {
    background: linear-gradient(135deg, rgba(249, 115, 22, 0.15) 0%, rgba(234, 179, 8, 0.1) 50%, var(--bg-card) 100%);
    border-color: rgba(249, 115, 22, 0.3);
  }
  .bento-card.filament-promo .bento-icon { background: linear-gradient(135deg, #F97316, #EAB308); color: white; }
  .bento-card.filament-promo .bento-tag { background: linear-gradient(135deg, rgba(249, 115, 22, 0.2), rgba(234, 179, 8, 0.2)); color: #F97316; }
  .bento-card.filament-promo:hover { border-color: rgba(249, 115, 22, 0.6); box-shadow: 0 0 30px rgba(249, 115, 22, 0.15); transform: translateY(-4px); }
  .bento-card.filament-promo .bento-glow { background: radial-gradient(circle, rgba(249, 115, 22, 0.15) 0%, transparent 70%); }

  .filament-promo-footer {
    margin-top: auto;
    padding-top: 12px;
  }

  .promo-cta {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 0.85rem;
    font-weight: 600;
    color: #F97316;
    transition: all 0.2s;
  }

  .bento-card.filament-promo:hover .promo-cta {
    gap: 10px;
  }

  .bento-card h3 { font-size: 1.25rem; margin: 0 0 8px; line-height: 1.3; color: var(--text-main); }
  .bento-large h3 { font-size: 1.5rem; }
  .bento-card p { font-size: 0.9rem; color: var(--text-muted); line-height: 1.6; margin: 0; flex: 1; }

  @media (max-width: 768px) {
    .bento-card {
      padding: 16px;
      border-radius: 14px;
      min-height: 140px;
    }
    .bento-large { grid-column: span 1; }
    .bento-icon { width: 36px; height: 36px; border-radius: 10px; }
    .bento-icon svg { width: 20px; height: 20px; }
    .bento-header { margin-bottom: 10px; gap: 8px; }
    .bento-tag { font-size: 0.55rem; padding: 3px 7px; }
    .bento-card h3 { font-size: 0.95rem; margin-bottom: 6px; }
    .bento-large h3 { font-size: 1rem; }
    .bento-card p { font-size: 0.8rem; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
  }

  /* MEMBERSHIP CTA SECTION */
  .membership-cta-section {
    margin-bottom: 48px;
  }

  .membership-cta-box {
    position: relative;
    padding: 40px;
    background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(139, 92, 246, 0.1) 50%, rgba(236, 72, 153, 0.1) 100%);
    border: 1px solid rgba(99, 102, 241, 0.3);
    border-radius: 24px;
    overflow: hidden;
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 32px;
    align-items: center;
  }

  .membership-glow {
    position: absolute;
    top: -50%;
    right: -20%;
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(99, 102, 241, 0.15) 0%, transparent 70%);
    pointer-events: none;
  }

  .membership-content {
    position: relative;
    z-index: 1;
  }

  .membership-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 72px;
    height: 72px;
    background: linear-gradient(135deg, #2563EB 0%, #7C3AED 100%);
    border-radius: 20px;
    color: white;
    margin-bottom: 20px;
    box-shadow: 0 8px 32px rgba(99, 102, 241, 0.3);
  }

  .membership-text h2 {
    font-size: 1.75rem;
    font-weight: 800;
    color: var(--text-main);
    margin-bottom: 8px;
    line-height: 1.3;
  }

  .membership-text p {
    font-size: 1.1rem;
    color: var(--text-muted);
    margin-bottom: 24px;
  }

  .membership-benefits {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 28px;
  }

  .benefit-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 12px;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-main);
    transition: all 0.2s ease;
  }

  .benefit-item:hover {
    border-color: rgba(99, 102, 241, 0.5);
    transform: translateY(-2px);
  }

  .benefit-icon {
    font-size: 1.2rem;
  }

  .membership-actions {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }

  .membership-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 14px 28px;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 700;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .membership-btn.primary {
    background: linear-gradient(135deg, #2563EB 0%, #7C3AED 100%);
    color: white;
    box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
  }

  .membership-btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(99, 102, 241, 0.5);
  }

  .membership-btn.secondary {
    background: var(--bg-card);
    color: var(--text-main);
    border: 1px solid var(--border-soft);
  }

  .membership-btn.secondary:hover {
    border-color: rgba(99, 102, 241, 0.5);
    background: rgba(99, 102, 241, 0.1);
  }

  .membership-stats {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    gap: 16px;
    padding: 24px;
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 16px;
  }

  .stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  .stat-number {
    font-size: 1.5rem;
    font-weight: 800;
    background: linear-gradient(135deg, #2563EB 0%, #7C3AED 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .stat-label {
    font-size: 0.85rem;
    color: var(--text-muted);
    font-weight: 500;
  }

  @media (max-width: 768px) {
    .membership-cta-box {
      grid-template-columns: 1fr;
      padding: 28px 20px;
      text-align: center;
    }

    .membership-icon {
      margin: 0 auto 20px;
    }

    .membership-text h2 {
      font-size: 1.4rem;
    }

    .membership-benefits {
      justify-content: center;
    }

    .membership-actions {
      justify-content: center;
    }

    .membership-stats {
      flex-direction: row;
      justify-content: center;
      gap: 32px;
    }
  }

  /* POLLS SECTION */
  .polls-section {
    margin-bottom: 48px;
    padding: 28px;
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 20px;
  }

  .polls-section .category-header {
    margin-bottom: 24px;
    border-bottom: none;
    padding-bottom: 0;
  }

  .poll-icon {
    background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(249, 115, 22, 0.15)) !important;
  }

  .poll-subtitle {
    font-size: 0.85rem;
    color: var(--text-muted);
  }

  .polls-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
  }

  @media (max-width: 768px) {
    .polls-grid {
      grid-template-columns: 1fr;
    }
    .polls-section {
      padding: 20px;
    }
  }

  .poll-card {
    background: var(--bg-main);
    border: 1px solid var(--border-soft);
    border-radius: 16px;
    padding: 20px;
    transition: all 0.3s ease;
  }

  .poll-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(0,0,0,0.15);
  }

  .poll-card.poll-gradient-1 {
    background: linear-gradient(135deg, rgba(234, 179, 8, 0.08) 0%, var(--bg-main) 100%);
    border-color: rgba(234, 179, 8, 0.25);
  }

  .poll-card.poll-gradient-1:hover {
    border-color: rgba(234, 179, 8, 0.5);
    box-shadow: 0 8px 30px rgba(234, 179, 8, 0.15);
  }

  .poll-card.poll-gradient-2 {
    background: linear-gradient(135deg, rgba(6, 182, 212, 0.08) 0%, var(--bg-main) 100%);
    border-color: rgba(6, 182, 212, 0.25);
  }

  .poll-card.poll-gradient-2:hover {
    border-color: rgba(6, 182, 212, 0.5);
    box-shadow: 0 8px 30px rgba(6, 182, 212, 0.15);
  }

  .poll-card-header {
    margin-bottom: 14px;
  }

  .poll-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(249, 115, 22, 0.15));
    color: #EAB308;
  }

  .poll-badge.cyan {
    background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(59, 130, 246, 0.15));
    color: #06B6D4;
  }

  .poll-card h3 {
    font-size: 1.05rem;
    margin: 0 0 14px;
    color: #f59e0b;
    line-height: 1.4;
  }

  .poll-footer {
    display: flex;
    justify-content: flex-end;
    margin-top: 12px;
  }

  .poll-options { display: flex; flex-direction: column; gap: 8px; }
  .poll-option { position: relative; height: 38px; background: rgba(100, 100, 100, 0.1); border-radius: 10px; overflow: hidden; border: 1px solid var(--border-soft); transition: all 0.3s ease; cursor: pointer; }
  .poll-option.voted { pointer-events: none; }
  .poll-option.clickable:hover { transform: scale(1.02); }
  .poll-bar { position: absolute !important; left: 0 !important; top: 0 !important; bottom: 0 !important; height: 100% !important; min-height: 38px !important; border-radius: 10px; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); z-index: 0; opacity: 1 !important; display: block !important; }
  .poll-bar.color-1 { background: linear-gradient(90deg, #EAB308 0%, #F59E0B 100%); }
  .poll-bar.color-2 { background: linear-gradient(90deg, #3B82F6 0%, #2563EB 100%); }
  .poll-bar.color-3 { background: linear-gradient(90deg, #8B5CF6 0%, #7C3AED 100%); }
  .poll-bar.color-4 { background: linear-gradient(90deg, #10B981 0%, #059669 100%); }
  .poll-bar.color-5 { background: linear-gradient(90deg, #06B6D4 0%, #0891B2 100%); }
  .poll-bar.gray { background: rgba(156, 163, 175, 0.4); }
  .poll-label { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 0.8rem; font-weight: 600; z-index: 1; }
  .poll-percent { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); font-size: 0.75rem; font-weight: 700; color: var(--text-muted); z-index: 1; }
  .poll-votes { font-size: 0.8rem; color: var(--text-muted); font-weight: 500; }
  .poll-option.selected { border-color: #22C55E; box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.3); }
  .poll-option.selected .poll-label { color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.3); }

  /* COMMUNITY SHOWCASE */
  .community-showcase {
    margin-bottom: 48px;
    padding: 28px;
    background: linear-gradient(135deg, rgba(168, 85, 247, 0.05) 0%, rgba(236, 72, 153, 0.03) 50%, var(--bg-card) 100%);
    border: 1px solid var(--border-soft);
    border-radius: 20px;
    position: relative;
    overflow: hidden;
  }

  .community-showcase::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -20%;
    width: 60%;
    height: 200%;
    background: radial-gradient(circle, rgba(168, 85, 247, 0.08) 0%, transparent 70%);
    pointer-events: none;
  }

  .community-showcase .category-header {
    border-bottom: none;
    padding-bottom: 0;
    margin-bottom: 24px;
    position: relative;
    z-index: 1;
  }

  .showcase-icon {
    background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(236, 72, 153, 0.15)) !important;
  }

  .showcase-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    position: relative;
    z-index: 1;
  }

  /* Tek proje varsa tam geni≈ülik */
  .showcase-card:only-child {
    grid-column: 1 / -1;
    max-width: 600px;
    margin: 0 auto;
  }

  @media (max-width: 1024px) {
    .showcase-grid { grid-template-columns: repeat(2, 1fr); }
  }

  @media (max-width: 640px) {
    .showcase-grid { grid-template-columns: 1fr; }
    .community-showcase { padding: 20px; }
  }

  .showcase-card {
    background: var(--bg-main);
    border: 1px solid var(--border-soft);
    border-radius: 16px;
    padding: 18px;
    text-decoration: none;
    color: inherit;
    display: flex;
    flex-direction: column;
    gap: 12px;
    transition: all 0.3s ease;
  }

  .showcase-card:hover {
    transform: translateY(-4px);
    border-color: rgba(168, 85, 247, 0.5);
    box-shadow: 0 12px 40px rgba(168, 85, 247, 0.15);
  }

  .showcase-card.showcase-featured {
    grid-column: span 2;
    background: linear-gradient(135deg, rgba(168, 85, 247, 0.08) 0%, var(--bg-main) 100%);
    border-color: rgba(168, 85, 247, 0.3);
  }

  @media (max-width: 640px) {
    .showcase-card.showcase-featured { grid-column: span 1; }
  }

  .showcase-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 10px;
  }

  .showcase-user {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .showcase-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, #A855F7, #EC4899);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .showcase-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .showcase-avatar span {
    color: white;
    font-weight: 700;
    font-size: 0.9rem;
  }

  .showcase-user-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .showcase-username {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-main);
  }

  .showcase-date {
    font-size: 0.7rem;
    color: var(--text-muted);
  }

  .showcase-badge {
    font-size: 0.65rem;
    font-weight: 700;
    padding: 4px 10px;
    border-radius: 20px;
    background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(249, 115, 22, 0.15));
    color: #EAB308;
    white-space: nowrap;
  }

  .showcase-title {
    font-size: 1rem;
    font-weight: 700;
    color: #f59e0b;
    line-height: 1.4;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .showcase-card.showcase-featured .showcase-title {
    font-size: 1.15rem;
  }

  .showcase-excerpt {
    font-size: 0.8rem;
    color: var(--text-muted);
    line-height: 1.5;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    flex: 1;
  }

  .showcase-card.showcase-featured .showcase-excerpt {
    -webkit-line-clamp: 3;
  }

  .showcase-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: auto;
    padding-top: 12px;
    border-top: 1px solid var(--border-soft);
  }

  .showcase-stats {
    display: flex;
    gap: 12px;
  }

  .showcase-stats .stat {
    font-size: 0.75rem;
    color: var(--text-muted);
  }

  .showcase-category {
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--text-muted);
    background: var(--bg-card);
    padding: 4px 8px;
    border-radius: 6px;
  }

  .showcase-cta {
    display: flex;
    justify-content: center;
    margin-top: 24px;
    position: relative;
    z-index: 1;
  }

  .showcase-cta-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 28px;
    background: linear-gradient(135deg, #A855F7, #EC4899);
    color: white;
    font-weight: 600;
    font-size: 0.95rem;
    border-radius: 12px;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 4px 20px rgba(168, 85, 247, 0.3);
  }

  .showcase-cta-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(168, 85, 247, 0.4);
  }

  /* CATEGORY SECTIONS */
  .category-section {
    margin-bottom: 48px;
  }

  .category-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid #f59e0b;
  }

  .category-title-group {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .category-icon {
    font-size: 1.5rem;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 12px;
  }

  .category-icon.orange { background: rgba(249, 115, 22, 0.15); }
  .category-icon.cyan { background: rgba(6, 182, 212, 0.15); }
  .category-icon.purple { background: rgba(168, 85, 247, 0.15); }
  .category-icon.green { background: rgba(34, 197, 94, 0.15); }

  .priority-badge {
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 4px 10px;
    border-radius: 20px;
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(16, 185, 129, 0.15));
    color: #22C55E;
    border: 1px solid rgba(34, 197, 94, 0.3);
  }

  .category-header h2 {
    font-size: 1.4rem;
    margin: 0;
    color: #f59e0b;
  }

  .category-link {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--accent);
    text-decoration: none;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .category-link:hover {
    gap: 8px;
  }

  .category-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
  }

  .category-grid.six-cols {
    grid-template-columns: repeat(3, 1fr);
  }

  .category-grid.six-cols .cat-card.cat-featured {
    grid-column: span 1;
  }

  @media (max-width: 1024px) {
    .category-grid { grid-template-columns: repeat(2, 1fr); }
    .category-grid.six-cols { grid-template-columns: repeat(2, 1fr); }
  }

  @media (max-width: 640px) {
    .category-grid { grid-template-columns: 1fr; gap: 12px; }
    .category-grid.six-cols { grid-template-columns: 1fr; }
    .category-header { flex-direction: column; align-items: flex-start; gap: 12px; }
    .category-header h2 { font-size: 1.2rem; }
    .category-icon { width: 36px; height: 36px; font-size: 1.2rem; }
  }

  /* Hƒ±zlƒ± Eri≈üim Bandƒ± */
  .quick-access-band {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
    border-bottom: 1px solid var(--border-soft);
    padding: 24px 20px;
  }

  .quick-access-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
  }

  .quick-card {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 16px 20px;
    background: var(--bg-card);
    border: 1px solid var(--border-soft);
    border-radius: 14px;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .quick-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
    border-color: var(--accent);
  }

  .quick-card.highlight {
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);
    border-color: rgba(139, 92, 246, 0.3);
  }

  .quick-card.highlight:hover {
    border-color: #8B5CF6;
  }

  .quick-icon {
    font-size: 1.8rem;
    flex-shrink: 0;
  }

  .quick-text {
    flex: 1;
    min-width: 0;
  }

  .quick-title {
    display: block;
    font-size: 0.95rem;
    font-weight: 700;
    color: #f59e0b;
    margin-bottom: 2px;
  }

  .quick-desc {
    display: block;
    font-size: 0.8rem;
    color: var(--text-muted);
  }

  .quick-arrow {
    width: 18px;
    height: 18px;
    color: var(--text-muted);
    flex-shrink: 0;
    transition: transform 0.2s;
  }

  .quick-card:hover .quick-arrow {
    transform: translateX(4px);
    color: var(--accent);
  }

  /* ƒ∞nteraktif Rehberler */
  .interactive-guides-section {
    padding: 50px 20px;
    background: linear-gradient(180deg, transparent 0%, rgba(16, 185, 129, 0.03) 100%);
    border-radius: 24px;
    margin-bottom: 20px;
  }

  .section-intro {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    margin-bottom: 28px;
    gap: 24px;
  }

  .section-intro-left {
    flex: 1;
  }

  .section-badge {
    display: inline-block;
    padding: 6px 12px;
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    margin-bottom: 12px;
  }

  .section-intro h2 {
    font-size: 1.8rem;
    font-weight: 800;
    color: #f59e0b;
    margin-bottom: 8px;
  }

  .section-intro p {
    font-size: 1rem;
    color: var(--text-muted);
    max-width: 500px;
    line-height: 1.5;
  }

  .section-cta {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    background: var(--bg-card);
    border: 2px solid var(--border-soft);
    border-radius: 12px;
    color: var(--text-main);
    font-size: 0.9rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .section-cta:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  .section-cta svg {
    width: 16px;
    height: 16px;
    transition: transform 0.2s;
  }

  .section-cta:hover svg {
    transform: translateX(4px);
  }

  .interactive-guides-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
  }

  .interactive-guide-card {
    display: flex;
    align-items: center;
    gap: 24px;
    padding: 28px;
    background: var(--bg-card);
    border: 2px solid var(--border-soft);
    border-radius: 20px;
    text-decoration: none;
    transition: all 0.3s ease;
    min-height: 140px;
    position: relative;
    overflow: hidden;
  }

  .guide-glow {
    position: absolute;
    top: -50%;
    right: -50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, var(--guide-color) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
  }

  .interactive-guide-card:hover .guide-glow {
    opacity: 0.08;
  }

  .interactive-guide-card:hover {
    border-color: var(--guide-color);
    transform: translateY(-6px);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.15);
  }

  .guide-logo {
    width: 80px;
    height: 80px;
    object-fit: contain;
    flex-shrink: 0;
    background: var(--bg-soft);
    border-radius: 16px;
    padding: 12px;
  }

  .guide-info {
    flex: 1;
    min-width: 0;
  }

  .guide-info h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: #f59e0b;
    margin-bottom: 6px;
  }

  .guide-info p {
    font-size: 0.9rem;
    color: var(--text-muted);
    line-height: 1.5;
    margin-bottom: 12px;
  }

  .guide-features {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .guide-features span {
    padding: 6px 12px;
    background: var(--bg-soft);
    border-radius: 8px;
    font-size: 0.75rem;
    color: var(--text-muted);
    font-weight: 600;
  }

  .guide-badge {
    position: absolute;
    top: 50%;
    right: 24px;
    transform: translateY(-50%);
    padding: 10px 18px;
    background: var(--guide-color);
    color: white;
    border-radius: 10px;
    font-size: 0.85rem;
    font-weight: 700;
    opacity: 0.9;
    transition: all 0.3s;
  }

  .interactive-guide-card:hover .guide-badge {
    opacity: 1;
    transform: translateY(-50%) scale(1.05);
  }

  @media (max-width: 1024px) {
    .quick-access-grid {
      grid-template-columns: repeat(2, 1fr);
    }
    .interactive-guides-grid {
      grid-template-columns: 1fr;
    }
    .section-intro {
      flex-direction: column;
      align-items: flex-start;
    }
  }

  @media (max-width: 640px) {
    .quick-access-band {
      padding: 16px;
    }
    .quick-access-grid {
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .quick-card {
      padding: 14px 16px;
    }
    .interactive-guides-section {
      padding: 30px 16px;
    }
    .interactive-guides-grid {
      grid-template-columns: 1fr;
    }
    .interactive-guide-card {
      padding: 20px;
      flex-direction: column;
      text-align: center;
      min-height: auto;
    }
    .guide-logo {
      width: 64px;
      height: 64px;
    }
    .guide-badge {
      position: static;
      transform: none;
      margin-top: 12px;
    }
    .interactive-guide-card:hover .guide-badge {
      transform: none;
    }
    .section-intro h2 {
      font-size: 1.4rem;
    }
  }

  /* Category Cards */
  .cat-card {
    position: relative;
    border-radius: 16px;
    text-decoration: none;
    color: white;
    transition: all 0.3s;
    overflow: hidden;
    min-height: 220px;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
  }

  .cat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(0,0,0,0.3);
  }

  .cat-card.orange:hover { box-shadow: 0 12px 40px rgba(249, 115, 22, 0.3); }
  .cat-card.cyan:hover { box-shadow: 0 12px 40px rgba(6, 182, 212, 0.3); }
  .cat-card.purple:hover { box-shadow: 0 12px 40px rgba(168, 85, 247, 0.3); }
  .cat-card.green:hover { box-shadow: 0 12px 40px rgba(34, 197, 94, 0.3); }

  /* Featured card - first in each section */
  .cat-card.cat-featured {
    grid-column: span 2;
    min-height: 280px;
  }

  @media (max-width: 640px) {
    .cat-card.cat-featured { grid-column: span 1; min-height: 200px; }
  }

  .cat-image {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
  }

  .cat-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease;
  }

  .cat-image img[src=""],
  .cat-image img:not([src]) {
    display: none;
  }

  .cat-card:hover .cat-image img {
    transform: scale(1.08);
  }

  .cat-content {
    position: relative;
    z-index: 2;
    padding: 16px;
    background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.6) 50%, transparent 100%);
    margin-top: auto;
  }

  .cat-card.cat-featured .cat-content {
    padding: 24px;
  }

  .cat-content h3 {
    font-size: 1rem;
    margin: 0 0 6px;
    line-height: 1.3;
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .cat-card.cat-featured .cat-content h3 {
    font-size: 1.3rem;
    -webkit-line-clamp: 3;
  }

  .cat-content p {
    font-size: 0.8rem;
    color: rgba(255,255,255,0.8);
    line-height: 1.5;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .cat-card.cat-featured .cat-content p {
    font-size: 0.9rem;
    -webkit-line-clamp: 2;
  }

  @media (max-width: 768px) {
    .category-section { margin-bottom: 32px; }
    .cat-card { min-height: 180px; border-radius: 12px; }
    .cat-content { padding: 12px; }
    .cat-content h3 { font-size: 0.9rem; }
    .cat-content p { font-size: 0.75rem; -webkit-line-clamp: 2; }
    .cat-card.cat-featured .cat-content h3 { font-size: 1rem; }
  }

</style>

<script is:inline define:vars={{ langStr: lang, pollTranslations: {
  votes: t.homepage.votes,
  voteRecorded: t.homepage.voteRecorded,
  voteFailed: t.homepage.voteFailed,
  connectionError: t.homepage.connectionError,
  noPoll: t.homepage.noPoll,
  pollLoadError: t.homepage.pollLoadError,
  other: t.homepage.other,
  printerBrandQuestion: t.homepage.printerBrandQuestion,
  slicerQuestion: t.homepage.slicerQuestion
} }}>
  const API_URL = 'https://tech-portal-api.turgut-d01.workers.dev';
  const currentLang = langStr;
  const pt = pollTranslations;

  // ========================================
  // HERO SLIDER
  // ========================================
  (function initSlider() {
    const slides = document.querySelectorAll('.slide');
    const dots = document.querySelectorAll('.slider-dots .dot');
    const progressBar = document.querySelector('.progress-bar');

    if (slides.length === 0) return;

    let currentIndex = 0;
    let interval;
    let progress = 0;
    const SLIDE_DURATION = 6000; // 6 saniye
    const PROGRESS_INTERVAL = 50;

    function goToSlide(index) {
      slides.forEach(s => s.classList.remove('active'));
      dots.forEach(d => d.classList.remove('active'));

      slides[index].classList.add('active');
      dots[index].classList.add('active');

      currentIndex = index;
      progress = 0;
    }

    function nextSlide() {
      const next = (currentIndex + 1) % slides.length;
      goToSlide(next);
    }

    function updateProgress() {
      progress += (PROGRESS_INTERVAL / SLIDE_DURATION) * 100;
      if (progressBar) {
        progressBar.style.width = progress + '%';
      }
      if (progress >= 100) {
        nextSlide();
      }
    }

    function startAutoPlay() {
      interval = setInterval(updateProgress, PROGRESS_INTERVAL);
    }

    function stopAutoPlay() {
      clearInterval(interval);
    }

    // Dot click events
    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => {
        stopAutoPlay();
        goToSlide(index);
        startAutoPlay();
      });
    });

    // Pause on hover
    const sliderContainer = document.querySelector('.slider-container');
    if (sliderContainer) {
      sliderContainer.addEventListener('mouseenter', stopAutoPlay);
      sliderContainer.addEventListener('mouseleave', startAutoPlay);

      // Keyboard navigation for accessibility
      sliderContainer.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
          e.preventDefault();
          const prev = (current - 1 + total) % total;
          goToSlide(prev);
        } else if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
          e.preventDefault();
          const next = (current + 1) % total;
          goToSlide(next);
        } else if (e.key === 'Home') {
          e.preventDefault();
          goToSlide(0);
        } else if (e.key === 'End') {
          e.preventDefault();
          goToSlide(total - 1);
        }
      });
    }

    // Start
    startAutoPlay();
  })();

  // ========================================
  // API POLL (3D Yazƒ±cƒ± Markasƒ±)
  // ========================================
  async function loadPoll() {
    const pollQuestion = document.getElementById('pollQuestion');
    const pollOptions = document.getElementById('pollOptions');
    const pollVotes = document.getElementById('pollVotes');

    if (!pollQuestion || !pollOptions || !pollVotes) return;

    try {
      const langParam = currentLang !== 'tr' ? `?lang=${currentLang}` : '';
      const res = await fetch(`${API_URL}/api/poll/active${langParam}`);
      const data = await res.json();

      if (!data.poll) {
        pollQuestion.textContent = pt.noPoll;
        pollOptions.innerHTML = '';
        pollVotes.textContent = '';
        return;
      }

      const poll = data.poll;
      // Soru metnini √ßeviri sisteminden al
      pollQuestion.textContent = pt.printerBrandQuestion || poll.question;

      // Renkler inline style olarak - t√ºm stiller inline!
      const barColors = ['#EAB308', '#3B82F6', '#8B5CF6', '#10B981', '#06B6D4'];
      pollOptions.innerHTML = poll.options.map((opt, index) => {
        const isVoted = poll.votedOptionId === opt.id;
        const barColor = barColors[index % 5];
        const barWidth = Math.max(opt.percent, 8);
        // "Diƒüer" kelimesini dile g√∂re √ßevir
        const optText = opt.text === 'Diƒüer' ? pt.other : opt.text;

        return `
          <div class="poll-option ${poll.hasVoted ? 'voted' : 'clickable'} ${isVoted ? 'selected' : ''}"
               data-option-id="${opt.id}" data-poll-id="${poll.id}"
               style="position: relative; height: 38px; background: rgba(100,100,100,0.1); border-radius: 10px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); cursor: pointer;">
            <div class="poll-bar" style="position: absolute; left: 0; top: 0; bottom: 0; height: 100%; width: ${barWidth}%; background: linear-gradient(90deg, ${barColor} 0%, ${barColor}cc 100%); border-radius: 10px; z-index: 0;"></div>
            <span class="poll-label" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 0.8rem; font-weight: 600; z-index: 1;">${optText}</span>
            <span class="poll-percent" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); font-size: 0.75rem; font-weight: 700; color: var(--text-muted); z-index: 1;">%${opt.percent}</span>
          </div>
        `;
      }).join('');

      const totalFormatted = poll.totalVotes >= 1000
        ? `${(poll.totalVotes / 1000).toFixed(1)}k`
        : poll.totalVotes;
      pollVotes.textContent = `${totalFormatted} ${pt.votes}`;

      if (!poll.hasVoted) {
        document.querySelectorAll('#pollOptions .poll-option.clickable').forEach(opt => {
          opt.addEventListener('click', handleVote);
        });
      }
    } catch (err) {
      console.error('Poll load error:', err);
      pollQuestion.textContent = pt.pollLoadError;
    }
  }

  async function handleVote(e) {
    const target = e.currentTarget;
    const optionId = target.dataset.optionId;
    const pollId = target.dataset.pollId;

    if (!optionId || !pollId) return;

    document.querySelectorAll('#pollOptions .poll-option').forEach(opt => {
      opt.classList.remove('clickable');
      opt.classList.add('voted');
    });

    try {
      const res = await fetch(`${API_URL}/api/poll/vote`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ pollId: parseInt(pollId), optionId: parseInt(optionId) })
      });

      const data = await res.json();

      if (data.success) {
        window.showToast(pt.voteRecorded, 'success');
        loadPoll();
      } else {
        window.showToast(data.error || pt.voteFailed, 'warning');
        loadPoll();
      }
    } catch (err) {
      console.error('Vote error:', err);
      window.showToast(pt.connectionError, 'error');
      loadPoll();
    }
  }

  loadPoll();
  document.addEventListener('astro:after-swap', loadPoll);

  // ========================================
  // SLICER POLL (API - Canlƒ± Anket)
  // ========================================
  const slicerColors = ['#22C55E', '#F97316', '#8B5CF6', '#06B6D4', '#6B7280'];

  async function loadSlicerPoll() {
    const slicerOptionsEl = document.getElementById('slicerOptions');
    const slicerVotesEl = document.getElementById('slicerVotes');

    if (!slicerOptionsEl || !slicerVotesEl) return;

    try {
      const langParam = currentLang !== 'tr' ? `?lang=${currentLang}` : '';
      const res = await fetch(`${API_URL}/api/poll/slicer${langParam}`);
      const data = await res.json();

      if (!data.poll) {
        slicerOptionsEl.innerHTML = `<p style="color: var(--text-muted);">${pt.pollLoadError}</p>`;
        return;
      }

      const poll = data.poll;

      slicerOptionsEl.innerHTML = poll.options.map((opt, index) => {
        const isVoted = poll.votedOptionId === opt.id;
        const barColor = slicerColors[index % 5];
        const barWidth = Math.max(opt.percent, 8);
        // "Diƒüer" kelimesini dile g√∂re √ßevir
        const optText = opt.text === 'Diƒüer' ? pt.other : opt.text;

        return `
          <div class="poll-option ${poll.hasVoted ? 'voted' : 'clickable'} ${isVoted ? 'selected' : ''}"
               data-option-id="${opt.id}" data-poll-id="7"
               style="position: relative; height: 38px; background: rgba(100,100,100,0.1); border-radius: 10px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); cursor: pointer;">
            <div class="poll-bar" style="position: absolute; left: 0; top: 0; bottom: 0; height: 100%; width: ${barWidth}%; background: linear-gradient(90deg, ${barColor} 0%, ${barColor}cc 100%); border-radius: 10px; z-index: 0;"></div>
            <span class="poll-label" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 0.8rem; font-weight: 600; z-index: 1;">${optText}</span>
            <span class="poll-percent" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); font-size: 0.75rem; font-weight: 700; color: var(--text-muted); z-index: 1;">%${opt.percent}</span>
          </div>
        `;
      }).join('');

      const totalFormatted = poll.totalVotes >= 1000
        ? `${(poll.totalVotes / 1000).toFixed(1)}k`
        : poll.totalVotes;
      slicerVotesEl.textContent = `${totalFormatted} ${pt.votes}`;

      if (!poll.hasVoted) {
        document.querySelectorAll('#slicerOptions .poll-option.clickable').forEach(opt => {
          opt.addEventListener('click', handleSlicerVote);
        });
      }
    } catch (err) {
      console.error('Slicer poll load error:', err);
    }
  }

  async function handleSlicerVote(e) {
    const target = e.currentTarget;
    const optionId = target.dataset.optionId;
    const pollId = target.dataset.pollId;

    if (!optionId || !pollId) return;

    document.querySelectorAll('#slicerOptions .poll-option').forEach(opt => {
      opt.classList.remove('clickable');
      opt.classList.add('voted');
    });

    try {
      const res = await fetch(`${API_URL}/api/poll/vote`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ pollId: parseInt(pollId), optionId: parseInt(optionId) })
      });

      const data = await res.json();

      if (data.success) {
        window.showToast(pt.voteRecorded, 'success');
        loadSlicerPoll();
      } else {
        window.showToast(data.error || pt.voteFailed, 'warning');
        loadSlicerPoll();
      }
    } catch (err) {
      console.error('Vote error:', err);
      window.showToast(pt.connectionError, 'error');
    }
  }

  loadSlicerPoll();
  document.addEventListener('astro:after-swap', loadSlicerPoll);
</script>
