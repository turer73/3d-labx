---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Header from "../../components/Header.astro";
import { getApiBase, getLanguage, getApiUrlWithLang, dateLocales } from "../../lib/api";
import { getTranslations } from "../../lib/translations";
import type { Language } from "../../lib/api";

type Post = {
  id: number;
  title: string;
  title_en?: string;
  title_de?: string;
  summary: string;
  summary_en?: string;
  summary_de?: string;
  slug: string;
  category: string;
  image_url?: string;
  is_featured: number;
  created_at?: string;
};

type Pagination = {
  page: number;
  limit: number;
  total: number;
  totalPages: number;
  hasNext: boolean;
  hasPrev: boolean;
};

type ApiResponse = {
  posts: Post[];
  pagination: Pagination;
};

const lang: Language = getLanguage(Astro.request);
const t = getTranslations(lang);
const tp = t.troubleshootingPage;
const dateLocale = dateLocales[lang];

const API_BASE = getApiBase(Astro.request);
const POSTS_PER_PAGE = 12;

let posts: Post[] = [];
let pagination: Pagination | null = null;
let error: string | null = null;

// Helper: get localized title
function getTitle(post: Post): string {
  if (lang === "en" && post.title_en) return post.title_en;
  if (lang === "de" && post.title_de) return post.title_de;
  return post.title;
}

// Helper: get localized summary
function getSummary(post: Post): string {
  if (lang === "en" && post.summary_en) return post.summary_en;
  if (lang === "de" && post.summary_de) return post.summary_de;
  return post.summary;
}

try {
  const apiUrl = `${API_BASE}/api/posts?category=sorun-cozumleri&page=1&limit=${POSTS_PER_PAGE}`;
  const res = await fetch(apiUrl, { headers: { "Accept": "application/json" } });

  if (!res.ok) {
    throw new Error(`API Error: ${res.status}`);
  }

  const data: ApiResponse = await res.json();
  posts = data.posts;
  pagination = data.pagination;
} catch (e) {
  error = e instanceof Error ? e.message : "Unknown error";
  console.error("Troubleshooting page error:", error);
}

const pageTitle = tp.pageTitle;
const pageDescription = tp.pageDesc;

// Schema.org
const schemaData = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": tp.heroTitle,
  "description": pageDescription,
  "url": "https://3d-labx.com/sorun-cozumleri",
  "publisher": {
    "@type": "Organization",
    "name": "3D-labX",
    "url": "https://3d-labx.com"
  },
  "mainEntity": {
    "@type": "ItemList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Bambu Lab Troubleshooting Guide", "url": "https://3d-labx.com/sorun-cozumleri/bambu-lab-sorun-giderme" },
      { "@type": "ListItem", "position": 2, "name": "Creality Troubleshooting Guide", "url": "https://3d-labx.com/sorun-cozumleri/creality-sorun-giderme" },
      { "@type": "ListItem", "position": 3, "name": "Elegoo Troubleshooting Guide", "url": "https://3d-labx.com/sorun-cozumleri/elegoo-sorun-giderme" },
      { "@type": "ListItem", "position": 4, "name": "Anycubic Troubleshooting Guide", "url": "https://3d-labx.com/sorun-cozumleri/anycubic-sorun-giderme" },
      { "@type": "ListItem", "position": 5, "name": "FlashForge Troubleshooting Guide", "url": "https://3d-labx.com/sorun-cozumleri/flashforge-sorun-giderme" }
    ]
  }
};

// Brand data with localized descriptions
const brands = [
  {
    name: "Bambu Lab",
    slug: "bambu-lab-sorun-giderme",
    logo: "/brand-logos/bambu-lab-logo.webp",
    color: "#00AE42",
    description: lang === "en" ? "Comprehensive troubleshooting for X1, P1, A1 series" : lang === "de" ? "Umfassende Fehlerbehebung f√ºr X1, P1, A1 Serie" : "X1, P1, A1 serisi i√ßin kapsamlƒ± sorun giderme",
    problems: lang === "en" ? ["Bed Adhesion", "Nozzle Clog", "AMS Issues"] : lang === "de" ? ["Bett-Haftung", "D√ºsenverstopfung", "AMS-Probleme"] : ["Tabla Yapƒ±≈üma", "Nozzle Tƒ±kanƒ±klƒ±ƒüƒ±", "AMS Sorunlarƒ±"]
  },
  {
    name: "Creality",
    slug: "creality-sorun-giderme",
    logo: "/brand-logos/creality-logo.png",
    color: "#22c55e",
    description: lang === "en" ? "Solutions for Ender 3, CR-10 series" : lang === "de" ? "L√∂sungen f√ºr Ender 3, CR-10 Serie" : "Ender 3, CR-10 serisi i√ßin √ß√∂z√ºmler",
    problems: lang === "en" ? ["First Layer", "Extrusion", "Leveling"] : lang === "de" ? ["Erste Schicht", "Extrusion", "Nivellierung"] : ["ƒ∞lk Katman", "Ekstr√ºzyon", "Seviyeleme"]
  },
  {
    name: "Elegoo",
    slug: "elegoo-sorun-giderme",
    logo: "/brand-logos/elegoo-logo.webp",
    color: "#3B82F6",
    description: lang === "en" ? "Neptune FDM and Mars/Saturn Resin guide" : lang === "de" ? "Neptune FDM und Mars/Saturn Resin Anleitung" : "Neptune FDM ve Mars/Saturn Re√ßine rehberi",
    problems: lang === "en" ? ["LCD Failure", "FEP Film", "Adhesion"] : lang === "de" ? ["LCD-Fehler", "FEP-Folie", "Haftung"] : ["LCD Arƒ±zasƒ±", "FEP Film", "Yapƒ±≈üma"]
  },
  {
    name: "Anycubic",
    slug: "anycubic-sorun-giderme",
    logo: "/brand-logos/anycubic-logo.webp",
    color: "#f59e0b",
    description: lang === "en" ? "Guide for Kobra, Vyper, Mega series" : lang === "de" ? "Anleitung f√ºr Kobra, Vyper, Mega Serie" : "Kobra, Vyper, Mega serisi i√ßin rehber",
    problems: lang === "en" ? ["Leveling", "Extrusion", "Layer Shift"] : lang === "de" ? ["Nivellierung", "Extrusion", "Schichtversatz"] : ["Seviyeleme", "Ekstr√ºzyon", "Katman Kaymasƒ±"]
  },
  {
    name: "FlashForge",
    slug: "flashforge-sorun-giderme",
    logo: "/brand-logos/flashforge-logo.svg",
    color: "#E84D1A",
    description: lang === "en" ? "Guide for Adventurer 5X, 5M, Creator series" : lang === "de" ? "Anleitung f√ºr Adventurer 5X, 5M, Creator Serie" : "Adventurer 5X, 5M, Creator serisi i√ßin rehber",
    problems: lang === "en" ? ["Nozzle Clog", "Leveling", "Wi-Fi Issues"] : lang === "de" ? ["D√ºsenverstopfung", "Nivellierung", "WLAN-Probleme"] : ["Noz√ºl Tƒ±kanƒ±klƒ±ƒüƒ±", "Seviyeleme", "Wi-Fi Sorunlarƒ±"]
  }
];
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <Header />

  <script type="application/ld+json" set:html={JSON.stringify(schemaData)} />

  <main class="troubleshooting-page" itemscope itemtype="https://schema.org/CollectionPage">
    <div class="container">

      <!-- Hero Section -->
      <header class="page-hero">
        <div class="hero-content">
          <nav class="breadcrumb" aria-label="Breadcrumb">
            <ol itemscope itemtype="https://schema.org/BreadcrumbList">
              <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                <a href="/" itemprop="item"><span itemprop="name">{tp.breadcrumbHome}</span></a>
                <meta itemprop="position" content="1" />
              </li>
              <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                <span itemprop="name" aria-current="page">{tp.breadcrumbTroubleshooting}</span>
                <meta itemprop="position" content="2" />
              </li>
            </ol>
          </nav>
          <h1 itemprop="name">{tp.heroTitle}</h1>
          <p class="hero-desc" itemprop="description">{tp.heroDesc}</p>
          <div class="hero-stats">
            <div class="stat">
              <span class="stat-number">4</span>
              <span class="stat-label">{tp.brandGuides}</span>
            </div>
            <div class="stat">
              <span class="stat-number">{(pagination?.total || 0) + 24}</span>
              <span class="stat-label">{tp.solutions}</span>
            </div>
            <div class="stat">
              <span class="stat-number">6</span>
              <span class="stat-label">{tp.categories}</span>
            </div>
          </div>
        </div>
        <div class="hero-visual">
          <div class="hero-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
            </svg>
          </div>
        </div>
      </header>

      <!-- Brand Guides -->
      <section class="bento-section" aria-labelledby="brand-guides-title">
        <h2 id="brand-guides-title" class="section-title">
          <span class="title-icon">üè≠</span>
          {tp.brandGuidesSection}
        </h2>
        <div class="bento-grid">
          {brands.map((brand, index) => (
            <article class={`bento-card brand-card ${index === 0 ? 'featured' : ''}`} style={`--brand-color: ${brand.color}`} itemscope itemtype="https://schema.org/HowTo">
              <a href={`/sorun-cozumleri/${brand.slug}`} class="card-link">
                <div class="card-header">
                  <div class="brand-logo">
                    <img src={brand.logo} alt={`${brand.name} Logo`} loading="lazy" width="120" height="60" />
                  </div>
                  <span class="card-badge" style={`background: ${brand.color}`}>{tp.viewGuide.split(' ')[0]}</span>
                </div>
                <div class="card-body">
                  <h3 itemprop="name">{brand.name} {tp.troubleshootingGuide}</h3>
                  <p itemprop="description">{brand.description}</p>
                  <div class="problem-tags">
                    {brand.problems.map(problem => (
                      <span class="tag">{problem}</span>
                    ))}
                  </div>
                </div>
                <div class="card-footer">
                  <span class="view-link">
                    {tp.viewGuide}
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
                  </span>
                </div>
              </a>
            </article>
          ))}
        </div>
      </section>

      <!-- Common Problems Quick Links -->
      <section class="quick-links-section" aria-labelledby="popular-problems-title">
        <h2 id="popular-problems-title" class="section-title">
          <span class="title-icon">üî•</span>
          {tp.commonProblems}
        </h2>
        <div class="quick-links-grid">
          <a href="/sorun-cozumleri/3d-yazici-nozzle-tikanikligi-kabustan-kurtulmanin-kesin-yollari-2026-rehberi-mkyiw0om" class="quick-link">
            <span class="quick-icon">üîß</span>
            <span class="quick-text">{tp.nozzleClog}</span>
          </a>
          <a href="/sorun-cozumleri/3d-baskida-i-lk-katman-yapisma-sorununa-kokten-cozum-rehberi-mkxazxot" class="quick-link">
            <span class="quick-icon">üìê</span>
            <span class="quick-text">{tp.firstLayerAdhesion}</span>
          </a>
          <a href="/sorun-cozumleri/3d-baskida-i-pliklenme-stringing-sorununa-kesin-cozum-rehberi-mkx4vmgl" class="quick-link">
            <span class="quick-icon">üï∏Ô∏è</span>
            <span class="quick-text">{tp.stringing}</span>
          </a>
          <a href="/sorun-cozumleri/3d-yazicida-abs-filament-ile-baskida-catlama-ve-warping-sorunlarina-cozum-mkxazkpg" class="quick-link">
            <span class="quick-icon">üå°Ô∏è</span>
            <span class="quick-text">{tp.warping}</span>
          </a>
        </div>
      </section>

      <!-- All Guides - Infinite Scroll Container -->
      <section class="posts-section" aria-labelledby="all-guides-title">
        <h2 id="all-guides-title" class="section-title">
          <span class="title-icon">üìö</span>
          {tp.allGuides}
        </h2>

        <div class="posts-bento-grid" id="posts-grid">
          {posts.map((post, index) => (
            <article class={`post-card ${index === 0 ? 'large' : ''}`} itemscope itemtype="https://schema.org/Article">
              <a href={`/sorun-cozumleri/${post.slug}`} class="post-image-link">
                <div class="post-image">
                  {post.image_url ? (
                    <img src={post.image_url} alt={getTitle(post)} loading="lazy" itemprop="image" />
                  ) : (
                    <div class="post-image-placeholder"></div>
                  )}
                  <div class="post-image-overlay">
                    <h3 class="post-image-title" itemprop="headline">{getTitle(post)}</h3>
                    {post.created_at && (
                      <time class="post-image-date" datetime={post.created_at} itemprop="datePublished">
                        {new Date(post.created_at).toLocaleDateString(dateLocale, { year: "numeric", month: "long", day: "numeric" })}
                      </time>
                    )}
                  </div>
                </div>
              </a>
            </article>
          ))}
        </div>

        <!-- Infinite Scroll Loading Indicator -->
        <div id="scroll-loader" class="scroll-loader" style="display: none;">
          <div class="loader-spinner"></div>
          <span>{tp.loading}</span>
        </div>

        <div id="scroll-end" class="scroll-end" style="display: none;">
          <span>‚úÖ {tp.noMorePosts}</span>
        </div>
      </section>

      {error && (
        <div class="message message-error" role="alert">
          <p><strong>{tp.errorLoading}</strong></p>
          <p class="text-sm">{error}</p>
        </div>
      )}

      <!-- CTA Section -->
      <section class="cta-section">
        <div class="cta-content">
          <h2>{tp.forumCta}</h2>
          <p>{tp.forumCtaDesc}</p>
          <div class="cta-buttons">
            <a href="/topluluk/forum" class="btn btn-primary">{tp.goToForum}</a>
            <a href="/iletisim" class="btn btn-outline">{tp.contactUs}</a>
          </div>
        </div>
      </section>

    </div>
  </main>
</BaseLayout>

<!-- Infinite Scroll Script -->
<script define:vars={{ API_BASE, POSTS_PER_PAGE, lang, totalPages: pagination?.totalPages || 1 }}>
  let currentPage = 1;
  let isLoading = false;
  let allLoaded = currentPage >= totalPages;

  const grid = document.getElementById('posts-grid');
  const loader = document.getElementById('scroll-loader');
  const endMsg = document.getElementById('scroll-end');

  function getLocalizedField(post, field) {
    if (lang === 'en' && post[field + '_en']) return post[field + '_en'];
    if (lang === 'de' && post[field + '_de']) return post[field + '_de'];
    return post[field];
  }

  function formatDate(dateStr) {
    const localeMap = { tr: 'tr-TR', en: 'en-US', de: 'de-DE' };
    return new Date(dateStr).toLocaleDateString(localeMap[lang] || 'tr-TR', {
      year: 'numeric', month: 'long', day: 'numeric'
    });
  }

  function createPostCard(post) {
    const title = getLocalizedField(post, 'title');
    const article = document.createElement('article');
    article.className = 'post-card';
    article.setAttribute('itemscope', '');
    article.setAttribute('itemtype', 'https://schema.org/Article');

    const imgSrc = post.image_url || '';
    const imgHtml = imgSrc
      ? `<img src="${imgSrc}" alt="${title}" loading="lazy" itemprop="image" />`
      : `<div class="post-image-placeholder"></div>`;

    const dateHtml = post.created_at
      ? `<time class="post-image-date" datetime="${post.created_at}" itemprop="datePublished">${formatDate(post.created_at)}</time>`
      : '';

    article.innerHTML = `
      <a href="/sorun-cozumleri/${post.slug}" class="post-image-link">
        <div class="post-image">
          ${imgHtml}
          <div class="post-image-overlay">
            <h3 class="post-image-title" itemprop="headline">${title}</h3>
            ${dateHtml}
          </div>
        </div>
      </a>
    `;

    return article;
  }

  async function loadMorePosts() {
    if (isLoading || allLoaded) return;
    isLoading = true;
    loader.style.display = 'flex';

    try {
      currentPage++;
      const res = await fetch(`${API_BASE}/api/posts?category=sorun-cozumleri&page=${currentPage}&limit=${POSTS_PER_PAGE}`, {
        headers: { 'Accept': 'application/json' }
      });

      if (!res.ok) throw new Error('API error');

      const data = await res.json();

      if (data.posts && data.posts.length > 0) {
        data.posts.forEach(post => {
          grid.appendChild(createPostCard(post));
        });
      }

      if (!data.pagination.hasNext) {
        allLoaded = true;
        endMsg.style.display = 'flex';
      }
    } catch (e) {
      console.error('Load more error:', e);
      currentPage--;
    } finally {
      isLoading = false;
      loader.style.display = 'none';
    }
  }

  // Intersection Observer for infinite scroll
  if (!allLoaded) {
    const sentinel = document.createElement('div');
    sentinel.id = 'scroll-sentinel';
    sentinel.style.height = '1px';
    grid.parentElement.insertBefore(sentinel, loader);

    const observer = new IntersectionObserver((entries) => {
      if (entries[0].isIntersecting && !isLoading && !allLoaded) {
        loadMorePosts();
      }
    }, { rootMargin: '400px' });

    observer.observe(sentinel);
  } else {
    if (endMsg) endMsg.style.display = 'flex';
  }
</script>

<style is:global>
  .troubleshooting-page {
    padding-top: 120px;
    padding-bottom: 64px;
    min-height: 100vh;
  }

  /* Hero Section */
  .troubleshooting-page .page-hero {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 48px;
    align-items: center;
    padding: 48px;
    background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
    border-radius: 24px;
    margin-bottom: 48px;
    border: 1px solid var(--border-soft);
  }

  .troubleshooting-page .breadcrumb ol {
    display: flex;
    gap: 8px;
    list-style: none;
    padding: 0;
    margin: 0 0 16px 0;
    font-size: 0.875rem;
  }

  .troubleshooting-page .breadcrumb li {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-muted);
  }

  .troubleshooting-page .breadcrumb li::after { content: '/'; color: var(--text-light); }
  .troubleshooting-page .breadcrumb li:last-child::after { display: none; }
  .troubleshooting-page .breadcrumb a { color: var(--text-muted); text-decoration: none; }
  .troubleshooting-page .breadcrumb a:hover { color: var(--accent); }

  .troubleshooting-page .page-hero h1 {
    font-size: 2.5rem;
    font-weight: 800;
    margin: 0 0 16px 0;
    background: linear-gradient(135deg, var(--text-main) 0%, var(--accent) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .troubleshooting-page .hero-desc {
    font-size: 1.125rem;
    color: var(--text-muted);
    margin: 0 0 24px 0;
    max-width: 500px;
    line-height: 1.6;
  }

  .troubleshooting-page .hero-stats { display: flex; gap: 32px; }
  .troubleshooting-page .stat { display: flex; flex-direction: column; }
  .troubleshooting-page .stat-number { font-size: 2rem; font-weight: 800; color: var(--accent); }
  .troubleshooting-page .stat-label { font-size: 0.875rem; color: var(--text-muted); }

  .troubleshooting-page .hero-visual { display: flex; align-items: center; justify-content: center; }
  .troubleshooting-page .hero-icon {
    width: 120px; height: 120px;
    background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%);
    border-radius: 24px;
    display: flex; align-items: center; justify-content: center;
    color: white;
  }
  .troubleshooting-page .hero-icon svg { width: 64px; height: 64px; }

  /* Section Titles */
  .troubleshooting-page .section-title {
    display: flex; align-items: center; gap: 12px;
    font-size: 1.5rem; font-weight: 700;
    color: var(--text-main); margin-bottom: 24px;
  }
  .troubleshooting-page .title-icon { font-size: 1.25rem; }

  /* Bento Grid */
  .troubleshooting-page .bento-section { margin-bottom: 48px; }
  .troubleshooting-page .bento-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }

  .troubleshooting-page .bento-card {
    background: var(--bg-card);
    border: 2px solid var(--border-soft);
    border-radius: 20px;
    overflow: hidden;
    transition: all 0.3s ease;
    position: relative;
  }
  .troubleshooting-page .bento-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0;
    height: 4px; background: var(--brand-color); opacity: 0; transition: opacity 0.3s;
  }
  .troubleshooting-page .bento-card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.15); border-color: var(--brand-color); }
  .troubleshooting-page .bento-card:hover::before { opacity: 1; }
  .troubleshooting-page .bento-card.featured { grid-column: span 2; }

  .troubleshooting-page .card-link { display: flex; flex-direction: column; height: 100%; text-decoration: none; color: inherit; }
  .troubleshooting-page .card-header { display: flex; flex-direction: column; align-items: center; padding: 0; border-bottom: 1px solid var(--border-soft); position: relative; }
  .troubleshooting-page .card-badge { position: absolute; top: 12px; right: 12px; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; color: white; z-index: 2; }

  .troubleshooting-page .brand-logo { height: 140px; width: 100%; display: flex; align-items: center; justify-content: center; padding: 24px; background: #ffffff; border-radius: 18px 18px 0 0; }
  .troubleshooting-page .brand-logo img { max-height: 100%; max-width: 80%; width: auto; height: auto; object-fit: contain; }
  .troubleshooting-page .bento-card.featured .brand-logo { height: 160px; padding: 28px; }
  .troubleshooting-page .bento-card.featured .brand-logo img { max-width: 70%; }

  .troubleshooting-page .card-body { flex: 1; padding: 16px 20px; }
  .troubleshooting-page .card-body h3 { font-size: 1.125rem; font-weight: 700; color: var(--text-main); margin: 0 0 8px 0; }
  .troubleshooting-page .card-body p { font-size: 0.875rem; color: var(--text-muted); margin: 0 0 12px 0; line-height: 1.5; }

  .troubleshooting-page .problem-tags { display: flex; flex-wrap: wrap; gap: 6px; }
  .troubleshooting-page .tag { padding: 4px 10px; background: var(--bg-secondary); border-radius: 6px; font-size: 0.75rem; color: var(--text-muted); }

  .troubleshooting-page .card-footer { padding: 16px 20px; border-top: 1px solid var(--border-soft); }
  .troubleshooting-page .view-link { display: flex; align-items: center; gap: 8px; font-size: 0.875rem; font-weight: 600; color: var(--brand-color); }
  .troubleshooting-page .view-link svg { width: 16px; height: 16px; transition: transform 0.3s; }
  .troubleshooting-page .bento-card:hover .view-link svg { transform: translateX(4px); }

  /* Quick Links */
  .troubleshooting-page .quick-links-section { margin-bottom: 48px; }
  .troubleshooting-page .quick-links-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
  .troubleshooting-page .quick-link {
    display: flex; align-items: center; gap: 12px;
    padding: 16px 20px; background: var(--bg-card);
    border: 1px solid var(--border-soft); border-radius: 12px;
    text-decoration: none; color: var(--text-main); transition: all 0.2s;
  }
  .troubleshooting-page .quick-link:hover { border-color: var(--accent); background: rgba(168, 85, 247, 0.05); transform: translateY(-2px); }
  .troubleshooting-page .quick-icon { font-size: 1.25rem; }
  .troubleshooting-page .quick-text { font-size: 0.9rem; font-weight: 500; }

  /* Posts Grid with Image Overlay */
  .troubleshooting-page .posts-section { margin-bottom: 48px; }

  .troubleshooting-page .posts-bento-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
  }

  .troubleshooting-page .post-card {
    background: var(--bg-card);
    border: 2px solid #f59e0b !important;
    border-radius: 16px;
    overflow: hidden;
    transition: all 0.3s;
  }
  .troubleshooting-page .post-card:hover { transform: translateY(-4px); box-shadow: 0 12px 32px rgba(245, 158, 11, 0.15); }

  .troubleshooting-page .post-card.large { grid-column: span 2; }
  .troubleshooting-page .post-card.large .post-image { aspect-ratio: 21/9; }

  .troubleshooting-page .post-image-link { display: block; text-decoration: none; color: inherit; }

  .troubleshooting-page .post-image {
    position: relative;
    aspect-ratio: 16/9;
    overflow: hidden;
  }

  .troubleshooting-page .post-image img {
    width: 100%; height: 100%;
    object-fit: cover;
    transition: transform 0.4s;
  }

  .troubleshooting-page .post-card:hover .post-image img { transform: scale(1.05); }

  .troubleshooting-page .post-image-placeholder {
    width: 100%; height: 100%;
    background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
  }

  /* Image Overlay with Title */
  .troubleshooting-page .post-image-overlay {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    padding: 24px 20px 16px;
    background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 60%, transparent 100%);
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    pointer-events: none;
  }

  .troubleshooting-page .post-image-title {
    font-size: 1rem !important;
    font-weight: 700;
    color: #ffffff;
    margin: 0 !important;
    line-height: 1.35 !important;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
  }

  .troubleshooting-page .post-card.large .post-image-title {
    font-size: 1.25rem !important;
    -webkit-line-clamp: 3;
  }

  .troubleshooting-page .post-image-date {
    display: block;
    margin-top: 6px;
    font-size: 0.75rem;
    color: rgba(255,255,255,0.7);
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
  }

  /* Infinite Scroll Indicators */
  .troubleshooting-page .scroll-loader {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 32px;
    color: var(--text-muted);
    font-size: 0.9rem;
  }

  .troubleshooting-page .loader-spinner {
    width: 24px; height: 24px;
    border: 3px solid var(--border-soft);
    border-top-color: #f59e0b;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  .troubleshooting-page .scroll-end {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
    color: var(--text-muted);
    font-size: 0.9rem;
  }

  /* CTA Section */
  .troubleshooting-page .cta-section {
    background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%);
    border-radius: 20px; padding: 48px; text-align: center; color: white;
  }
  .troubleshooting-page .cta-content h2 { font-size: 1.75rem; font-weight: 700; margin: 0 0 12px 0; }
  .troubleshooting-page .cta-content p { font-size: 1.1rem; opacity: 0.9; margin: 0 0 24px 0; }
  .troubleshooting-page .cta-buttons { display: flex; justify-content: center; gap: 16px; }
  .troubleshooting-page .cta-buttons .btn { padding: 12px 28px; border-radius: 10px; font-weight: 600; text-decoration: none; transition: all 0.2s; }
  .troubleshooting-page .cta-buttons .btn-primary { background: white; color: var(--accent); }
  .troubleshooting-page .cta-buttons .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
  .troubleshooting-page .cta-buttons .btn-outline { background: transparent; border: 2px solid white; color: white; }
  .troubleshooting-page .cta-buttons .btn-outline:hover { background: white; color: var(--accent); }

  /* Error */
  .troubleshooting-page .message-error {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 48px;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .troubleshooting-page .bento-grid { grid-template-columns: repeat(2, 1fr); }
    .troubleshooting-page .bento-card.featured { grid-column: span 2; }
    .troubleshooting-page .posts-bento-grid { grid-template-columns: repeat(2, 1fr); }
    .troubleshooting-page .post-card.large { grid-column: span 2; }
    .troubleshooting-page .quick-links-grid { grid-template-columns: repeat(2, 1fr); }
  }

  @media (max-width: 768px) {
    .troubleshooting-page { padding-top: 100px; }
    .troubleshooting-page .page-hero { grid-template-columns: 1fr; padding: 32px 24px; text-align: center; }
    .troubleshooting-page .page-hero h1 { font-size: 1.75rem; }
    .troubleshooting-page .hero-desc { max-width: none; }
    .troubleshooting-page .hero-stats { justify-content: center; }
    .troubleshooting-page .hero-visual { display: none; }
    .troubleshooting-page .bento-grid { grid-template-columns: 1fr; }
    .troubleshooting-page .bento-card.featured { grid-column: span 1; }
    .troubleshooting-page .quick-links-grid { grid-template-columns: 1fr; }
    .troubleshooting-page .posts-bento-grid { grid-template-columns: 1fr; }
    .troubleshooting-page .post-card.large { grid-column: span 1; }
    .troubleshooting-page .post-card.large .post-image { aspect-ratio: 16/9; }
    .troubleshooting-page .cta-section { padding: 32px 24px; }
    .troubleshooting-page .cta-buttons { flex-direction: column; }
  }
</style>
