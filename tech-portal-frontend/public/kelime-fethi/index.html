<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#16a34a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Kelime Fethi">
    <link rel="icon" type="image/png" href="assets/icon-192.png">
    <link rel="icon" type="image/svg+xml" href="assets/icon-192.svg">
    <link rel="shortcut icon" type="image/png" href="assets/icon-192.png">
    <meta name="description" content="TÃ¼rkiye haritasÄ±nÄ± kelime bulmacalarÄ±yla fethet! GÃ¼nlÃ¼k bulmaca, 81 ÅŸehir, TÃ¼rkÃ§e kelime oyunu.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://3d-labx.com/kelime-fethi/">
    <meta property="og:title" content="Kelime Fethi â€” TÃ¼rkiye'yi Kelimelerle Fethet!">
    <meta property="og:description" content="Wordle tarzÄ± TÃ¼rkÃ§e kelime oyunu. 81 ÅŸehir, gÃ¼nlÃ¼k bulmaca, harita fethi. Serini koru, ÅŸehirleri fethet!">
    <meta property="og:image" content="https://3d-labx.com/kelime-fethi/assets/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="tr_TR">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Kelime Fethi â€” TÃ¼rkiye'yi Kelimelerle Fethet!">
    <meta name="twitter:description" content="Wordle tarzÄ± TÃ¼rkÃ§e kelime oyunu. 81 ÅŸehir, gÃ¼nlÃ¼k bulmaca, harita fethi.">
    <meta name="twitter:image" content="https://3d-labx.com/kelime-fethi/assets/og-image.png">

    <title>Kelime Fethi</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="assets/icon-192.png">
    <link rel="stylesheet" href="style.css?v=6">
</head>
<body>
    <!-- ===== SPLASH SCREEN ===== -->
    <div id="splash-screen">
        <div class="splash-map-icon">ğŸ—ºï¸</div>
        <div class="splash-logo">Kelime Fethi</div>
        <div class="splash-subtitle">TÃ¼rkiye'yi Fethet</div>
        <div class="splash-loader">
            <div class="splash-loader-bar" id="splash-progress"></div>
        </div>
    </div>

    <!-- ===== TOP BAR ===== -->
    <header id="top-bar">
        <div class="top-left">
            <span id="streak-indicator">ğŸ”¥ 0</span>
            <span id="score-display">â­ 0</span>
        </div>
        <h1 id="game-title">Kelime Fethi</h1>
        <div class="top-right">
            <button id="btn-cloud" class="icon-btn" title="Bulut KayÄ±t" aria-label="Bulut kayÄ±t">â˜ï¸</button>
            <button id="btn-sound" class="icon-btn" title="Ses" aria-label="Ses aÃ§/kapat">ğŸ”Š</button>
        </div>
    </header>

    <!-- ===== MAIN GAME AREA ===== -->
    <main id="game-area" role="main">

        <!-- VIEW 1: MAP -->
        <section id="map-view" class="view active">
            <div class="map-header">
                <div class="progress-info">
                    <span id="city-count">0/81</span>
                    <span class="progress-label">ÅŸehir fethedildi</span>
                </div>
                <div class="progress-bar-wrap">
                    <div class="progress-bar" id="map-progress" role="progressbar" aria-valuemin="0" aria-valuemax="81" style="width:0%"></div>
                </div>
            </div>

            <!-- Daily Puzzle Banner -->
            <div id="daily-banner" class="daily-banner">
                <div class="daily-left">
                    <span class="daily-icon">ğŸ“…</span>
                    <div>
                        <strong>GÃ¼nlÃ¼k Bulmaca</strong>
                        <span id="daily-countdown" class="daily-timer">--:--:--</span>
                    </div>
                </div>
                <button id="btn-daily" class="daily-btn" aria-label="GÃ¼nlÃ¼k bulmacayÄ± oyna">Oyna</button>
            </div>

            <!-- Turkey Map Container -->
            <div id="map-container">
                <svg id="turkey-map" viewBox="0 0 900 600" xmlns="http://www.w3.org/2000/svg">
                    <!-- Map paths will be injected by game.js -->
                </svg>
            </div>

            <!-- Region Selector -->
            <div class="region-selector">
                <button class="region-btn active" data-region="all">TÃ¼mÃ¼</button>
                <button class="region-btn" data-region="marmara">Marmara</button>
                <button class="region-btn" data-region="ege">Ege</button>
                <button class="region-btn" data-region="akdeniz">Akdeniz</button>
                <button class="region-btn" data-region="ic-anadolu">Ä°Ã§ Anadolu</button>
                <button class="region-btn" data-region="karadeniz">Karadeniz</button>
                <button class="region-btn" data-region="dogu">DoÄŸu A.</button>
                <button class="region-btn" data-region="guneydogu">G.DoÄŸu A.</button>
            </div>
        </section>

        <!-- VIEW 2: PUZZLE -->
        <section id="puzzle-view" class="view">
            <div class="puzzle-header">
                <button id="btn-back" class="back-btn" aria-label="Haritaya dÃ¶n">â† Harita</button>
                <div class="puzzle-city-info">
                    <span id="puzzle-city-name">Ä°stanbul</span>
                    <span id="puzzle-region-name" class="region-tag">Marmara</span>
                    <span id="puzzle-word-length" class="word-length-badge">5 harf</span>
                </div>
                <button id="btn-hint" class="hint-btn" title="Ä°pucu" aria-label="Ä°pucu kullan">ğŸ’¡ <span id="hint-count">3</span></button>
            </div>

            <!-- Guess Timer Bar (easy mode) -->
            <div id="guess-timer" class="guess-timer" style="display:none">
                <div id="guess-timer-bar" class="guess-timer-bar"></div>
            </div>

            <!-- Guess Grid -->
            <div id="guess-grid" class="guess-grid" role="grid" aria-label="Tahmin tablosu">
                <!-- 6 rows x 5 tiles rendered by JS -->
            </div>

            <!-- Message area -->
            <div id="message-area" class="message-area" aria-live="polite"></div>

            <!-- Virtual Keyboard -->
            <div id="keyboard" class="keyboard" role="group" aria-label="Klavye">
                <div class="keyboard-row">
                    <button class="key" data-key="E">E</button>
                    <button class="key" data-key="R">R</button>
                    <button class="key" data-key="T">T</button>
                    <button class="key" data-key="Y">Y</button>
                    <button class="key" data-key="U">U</button>
                    <button class="key" data-key="I">I</button>
                    <button class="key" data-key="O">O</button>
                    <button class="key" data-key="P">P</button>
                    <button class="key" data-key="Ä">Ä</button>
                    <button class="key" data-key="Ãœ">Ãœ</button>
                </div>
                <div class="keyboard-row">
                    <button class="key" data-key="A">A</button>
                    <button class="key" data-key="S">S</button>
                    <button class="key" data-key="D">D</button>
                    <button class="key" data-key="F">F</button>
                    <button class="key" data-key="G">G</button>
                    <button class="key" data-key="H">H</button>
                    <button class="key" data-key="J">J</button>
                    <button class="key" data-key="K">K</button>
                    <button class="key" data-key="L">L</button>
                    <button class="key" data-key="Å">Å</button>
                    <button class="key" data-key="Ä°">Ä°</button>
                </div>
                <div class="keyboard-row">
                    <button class="key wide" data-key="ENTER">GÄ°R</button>
                    <button class="key" data-key="Z">Z</button>
                    <button class="key" data-key="C">C</button>
                    <button class="key" data-key="V">V</button>
                    <button class="key" data-key="B">B</button>
                    <button class="key" data-key="N">N</button>
                    <button class="key" data-key="M">M</button>
                    <button class="key" data-key="Ã–">Ã–</button>
                    <button class="key" data-key="Ã‡">Ã‡</button>
                    <button class="key wide" data-key="BACKSPACE">âŒ«</button>
                </div>
            </div>
        </section>

        <!-- VIEW 3: STATS -->
        <section id="stats-view" class="view">
            <div class="stats-container">
                <div class="stats-tabs">
                    <button class="stats-tab active" data-stab="my">Benim</button>
                    <button class="stats-tab" data-stab="daily">GÃ¼nlÃ¼k ğŸ†</button>
                    <button class="stats-tab" data-stab="alltime">TÃ¼m Zamanlar</button>
                </div>
                <div id="stats-panel-my" class="stats-panel active">
                <h2>Ä°statistikler</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <span class="stat-num" id="stat-played">0</span>
                        <span class="stat-label">Oyun</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-num" id="stat-win-pct">0</span>
                        <span class="stat-label">Kazanma %</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-num" id="stat-streak">0</span>
                        <span class="stat-label">Seri</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-num" id="stat-max-streak">0</span>
                        <span class="stat-label">En Ä°yi</span>
                    </div>
                </div>
                <h3>Tahmin DaÄŸÄ±lÄ±mÄ±</h3>
                <div id="guess-distribution" class="guess-dist">
                    <!-- 6 bars rendered by JS -->
                </div>
                <h3>BaÅŸarÄ±mlar ğŸ…</h3>
                <div id="achievements-list" class="achievements-list">
                    <!-- Rendered by JS -->
                </div>
                <h3>BÃ¶lge Ä°lerlemesi</h3>
                <div id="region-progress" class="region-progress-list">
                    <!-- Rendered by JS -->
                </div>
                </div><!-- /stats-panel-my -->
                <div id="stats-panel-daily" class="stats-panel">
                    <div id="leaderboard-daily" class="leaderboard-container">
                        <div class="lb-loading">YÃ¼kleniyor...</div>
                    </div>
                </div>
                <div id="stats-panel-alltime" class="stats-panel">
                    <div id="leaderboard-alltime" class="leaderboard-container">
                        <div class="lb-loading">YÃ¼kleniyor...</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW 4: SETTINGS -->
        <section id="settings-view" class="view">
            <div class="settings-container">
                <h2>Ayarlar</h2>
                <div class="setting-row">
                    <span>Zorluk Seviyesi</span>
                    <div class="difficulty-selector" id="difficulty-selector">
                        <button class="diff-btn active" data-diff="easy">Kolay (4 harf)</button>
                        <button class="diff-btn" data-diff="normal">Normal (5 harf)</button>
                        <button class="diff-btn" data-diff="hard">Zor (6 harf)</button>
                    </div>
                </div>
                <div id="difficulty-info" class="difficulty-info">
                    4 harf, 6 deneme, 1 harf aÃ§Ä±k, klavye daraltÄ±lÄ±r
                </div>
                <div class="setting-row" id="hard-mode-row">
                    <span>Zor Mod (Manuel)</span>
                    <label class="toggle">
                        <input type="checkbox" id="setting-hard-mode">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <span>Ses Efektleri</span>
                    <label class="toggle">
                        <input type="checkbox" id="setting-sound" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <span>TitreÅŸim</span>
                    <label class="toggle">
                        <input type="checkbox" id="setting-haptic" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <h3 class="settings-section-title">ğŸ† Sosyal</h3>
                <div class="setting-row">
                    <span>Rumuz</span>
                    <div class="nickname-input-wrap">
                        <input type="text" id="nickname-input" maxlength="16" placeholder="Rumuzun" class="nickname-input">
                        <button id="btn-save-nickname" class="nick-save-btn">Kaydet</button>
                    </div>
                </div>
                <div class="setting-row">
                    <span>Avatar</span>
                    <div id="avatar-selector" class="avatar-selector"></div>
                </div>
                <div class="setting-row">
                    <span>Liderboard'a KatÄ±l</span>
                    <label class="toggle">
                        <input type="checkbox" id="setting-leaderboard">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <h3 class="settings-section-title">âš™ï¸ Tercihler</h3>
                <div class="setting-row">
                    <span>Renk KÃ¶rÃ¼ Modu ğŸ¨</span>
                    <label class="toggle">
                        <input type="checkbox" id="setting-colorblind">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <span>Seri Dondurma â„ï¸</span>
                    <div class="streak-freeze-info">
                        <span id="freeze-count">0</span> hak
                    </div>
                </div>
                <div class="setting-row danger">
                    <span>Oyunu SÄ±fÄ±rla</span>
                    <button id="btn-reset" class="reset-btn" aria-label="Oyunu sÄ±fÄ±rla">SÄ±fÄ±rla</button>
                </div>
                <div class="about-section">
                    <p>Kelime Fethi v4.0</p>
                    <p>3D-labX tarafÄ±ndan geliÅŸtirildi</p>
                    <a href="/" class="back-to-site">â† 3D-labX'e dÃ¶n</a>
                </div>
            </div>
        </section>
    </main>

    <!-- ===== BOTTOM NAV ===== -->
    <nav id="bottom-nav" role="navigation" aria-label="Ana menÃ¼">
        <button class="nav-btn active" data-tab="map">
            <span class="nav-icon">ğŸ—ºï¸</span>
            <span class="nav-label">Harita</span>
        </button>
        <button class="nav-btn" data-tab="daily">
            <span class="nav-icon">ğŸ“…</span>
            <span class="nav-label">GÃ¼nlÃ¼k</span>
            <span id="daily-dot" class="notif-dot"></span>
        </button>
        <button class="nav-btn" data-tab="stats">
            <span class="nav-icon">ğŸ“Š</span>
            <span class="nav-label">Ä°statistik</span>
        </button>
        <button class="nav-btn" data-tab="settings">
            <span class="nav-icon">âš™ï¸</span>
            <span class="nav-label">Ayarlar</span>
        </button>
    </nav>

    <!-- ===== OVERLAYS ===== -->

    <!-- Result Overlay -->
    <div id="result-overlay" class="overlay hidden" role="dialog" aria-modal="true" aria-label="SonuÃ§">
        <div class="overlay-content result-content">
            <div id="result-icon" class="result-icon">ğŸ†</div>
            <h2 id="result-title">Tebrikler!</h2>
            <p id="result-message">Ä°stanbul fethedildi!</p>
            <div id="result-score" class="result-score">+300 â­</div>
            <div id="result-grid-share" class="share-grid"></div>
            <div id="result-daily-rank" class="result-rank" style="display:none;"></div>
            <div class="result-actions">
                <button id="btn-share" class="share-btn" aria-label="Sonucu paylaÅŸ">ğŸ“‹ Kopyala</button>
                <button id="btn-share-whatsapp" class="share-btn whatsapp-btn" aria-label="WhatsApp'ta paylaÅŸ">ğŸ’¬ WhatsApp</button>
            </div>
            <div class="result-actions-secondary">
                <button id="btn-challenge" class="challenge-btn" aria-label="Meydan oku">âš”ï¸ Meydan Oku</button>
                <button id="btn-next-city" class="next-btn" aria-label="Sonraki ÅŸehir">Tamam âœ“</button>
            </div>
        </div>
    </div>

    <!-- Cloud Save Overlay -->
    <div id="cloud-overlay" class="overlay hidden" role="dialog" aria-modal="true" aria-label="Bulut kayÄ±t">
        <div class="overlay-content cloud-content">
            <h2>â˜ï¸ Bulut KayÄ±t</h2>
            <div id="cloud-status" class="cloud-status"></div>
            <div class="cloud-id">
                <span>Oyuncu ID:</span>
                <code id="player-id-display">-</code>
            </div>
            <div class="cloud-pin">
                <label>4 Haneli PIN:</label>
                <input type="tel" id="cloud-pin" maxlength="4" pattern="[0-9]{4}" placeholder="1234">
            </div>
            <div class="cloud-actions">
                <button id="btn-cloud-save" class="cloud-action-btn save">ğŸ’¾ Kaydet</button>
                <button id="btn-cloud-load" class="cloud-action-btn load">ğŸ“¥ YÃ¼kle</button>
            </div>
            <div id="cloud-msg" class="cloud-msg"></div>
            <button id="btn-cloud-close" class="close-btn">Kapat</button>
        </div>
    </div>

    <!-- Tutorial Overlay -->
    <div id="tutorial-overlay" class="overlay hidden" role="dialog" aria-modal="true" aria-label="EÄŸitim">
        <div class="overlay-content tutorial-content">
            <div id="tutorial-step" class="tutorial-step">
                <!-- Steps rendered by JS -->
            </div>
            <div class="tutorial-actions">
                <button id="btn-tutorial-next" class="tutorial-btn">Devam â†’</button>
            </div>
            <div class="tutorial-dots" id="tutorial-dots"></div>
        </div>
    </div>

    <!-- Toast Messages -->
    <div id="toast-container" class="toast-container" aria-live="polite"></div>

    <!-- Floating text container -->
    <div id="float-container"></div>

    <!-- Particle canvas -->
    <canvas id="particle-canvas"></canvas>

    <!-- Scripts -->
    <!-- Global Error Boundary -->
    <script>
    (function(){
        var shown = false;
        function showError(msg) {
            if (shown) return;
            shown = true;
            console.error('[ErrorBoundary]', msg);
            var el = document.createElement('div');
            el.id = 'error-boundary';
            el.style.cssText = 'position:fixed;inset:0;z-index:99999;background:rgba(0,0,0,0.85);' +
                'display:flex;align-items:center;justify-content:center;flex-direction:column;' +
                'color:#fff;font-family:system-ui,sans-serif;text-align:center;padding:24px;';
            el.innerHTML =
                '<div style="font-size:48px;margin-bottom:16px;">âš ï¸</div>' +
                '<h2 style="margin:0 0 8px;font-size:20px;">Bir hata oluÅŸtu</h2>' +
                '<p style="margin:0 0 20px;font-size:14px;color:#ccc;max-width:320px;">' +
                    'Oyun beklenmeyen bir sorunla karÅŸÄ±laÅŸtÄ±. SayfayÄ± yenileyerek tekrar deneyin.</p>' +
                '<button onclick="location.reload()" style="padding:12px 32px;font-size:16px;' +
                    'border:none;border-radius:8px;background:#16a34a;color:#fff;cursor:pointer;' +
                    'font-weight:600;">Yenile</button>';
            document.body.appendChild(el);
        }
        window.addEventListener('error', function(e) {
            if (e.error) showError(e.message || 'Unknown error');
        });
        window.addEventListener('unhandledrejection', function(e) {
            var msg = e.reason ? (e.reason.message || String(e.reason)) : 'Unhandled rejection';
            showError(msg);
        });
    })();
    </script>
    <script src="assets/icons.js?v=3"></script>
    <script type="module" src="js/app.js?v=9"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => {
                        console.log('[PWA] SW registered:', reg.scope);
                        // Check for updates periodically
                        reg.addEventListener('updatefound', () => {
                            const newWorker = reg.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New version available â€” auto-activate
                                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                                    console.log('[PWA] Yeni sÃ¼rÃ¼m yÃ¼klendi, yenileniyor...');
                                }
                            });
                        });
                    })
                    .catch(err => console.log('[PWA] SW failed:', err));
            });
            // Reload on controller change
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (!window._swReloading) {
                    window._swReloading = true;
                    window.location.reload();
                }
            });
        }
    </script>
</body>
</html>
